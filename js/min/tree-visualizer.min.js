!function(t){t.fn.treeVisualizer=function(e,a){function n(){var t=[],a=[],n=[];k.normalView&&(g=P.children("#tree-visualizer"),C=g.find(".tv-tree"),C.css("fontSize",k.nvFontSize),S=C.children(".tv-tooltip"),n.push(g),t.push(C),a.push(S)),m=P.children("#tree-visualizer-fs"),w=m.find(".tv-tree"),w.css("fontSize",k.fsFontSize),b=w.children(".tv-tooltip"),y=m.find(".tv-zoom-opts"),y.prev("a").attr("href",e),n.push(m),t.push(w),a.push(b),""!=k.sentence&&w.find(".tv-sentence-wrapper").addClass("has-sentence").children("span").text(decodeURI(k.sentence)),z=v(t),x=v(a),anyView=v(n),errorContainer=anyView.children(".tv-error")}function i(e){N.removeClass("tv-active, tv-success, tv-fail"),t.ajax({type:"GET",url:e,dataType:"xml",cache:!1}).done(function(t){N.addClass("tv-success"),null==t?h("Your XML appears to be empty or not in a compatible format."):s(t)}).fail(function(t,e,a){N.addClass("tv-fail");var n="";0===t.status?n="Not connected to the Internet.<br>Verify your network connection.":404==t.status?n="Requested XML file not found.<br>Try again with another query.":500==t.status?n="Internal Server Error.<br>If the problem persists, contact us.":(n="Something went wrong.<br>Please try again at another time.<br>",n+=t.status+" "+e+" "+a),h(n)}).always(function(){k.normalView&&N.addClass("tv-active"),k.initFSOnClick&&(t(".loading-wrapper.tv").removeClass("active"),m.fadeIn(250,function(){I=null,c()}))})}function s(e){var a=t(e);u(),z.prepend(o(a.find("node").first())),x.children("ul").empty(),d()}function o(e){var a=t("<ol/>");return e.each(function(e,n){for(var i=t('<li><a href="#"></a></li>'),s=0,d=n.attributes.length,r=null;d>s;s++)r=n.attributes[s],"highlight"==r.nodeName?i.addClass("highlight"):"not"==r.nodeName?i.addClass("excluded"):"begin"!=r.nodeName&&"end"!=r.nodeName&&i.attr("data-"+r.nodeName,r.value.replace(/^\s(.+)/,"$1"));t(this).children("node").length&&i.append(o(t(this).children("node"))),a.append(i)}),a}function d(){z.find("a").each(function(){var e=t(this),a=e.parent("li");if(N.hasClass("matrix")&&a.data("word")&&(a.data("caseinsensitive")?(a.data("word",a.data("word").toLowerCase()),a.data("lemma",a.data("lemma").toLowerCase())):e.addClass("cs")),a.data("rel")&&(e.append("<span class='rel'>"+a.data("rel")+"</span>"),a.data("index")&&e.append("<span class='index'>"+a.data("index")+"</span>")),a.data("postag")&&k.extendedPOS?e.append("<span class='postag'>"+a.data("postag")+"</span>"):a.data("pt")?a.data("index")?e.children("span:last-child").append(":"+a.data("pt")):e.append("<span class='pt'>"+a.data("pt")+"</span>"):a.data("cat")&&(" "==a.data("cat")?(a.removeAttr("data-cat"),a.removeData("cat"),e.addClass("ignored").text("?").attr("title","Top node's properties will be ignored")):a.data("index")?e.children("span:last-child").append(":"+a.data("cat")):e.append("<span class='cat'>"+a.data("cat")+"</span>")),e.is(":only-child")){if(a.data("lemma")&&a.append("<span class='lemma'>"+a.data("lemma")+"</span>"),a.data("word")){var n=N.hasClass("matrix")&&!a.data("caseinsensitive")?' title="Case sensitive word"':"";a.append("<span class='word'><em"+n+">"+a.data("word")+"</em></span>")}e.addClass("only-child")}a.data("caseinsensitive")&&(a.removeAttr("data-caseinsensitive"),a.removeData("caseinsensitive"))}),z.find("li:only-child").addClass("only-child"),z.find("li:first-child").addClass("first-child"),z.find("li:last-child").addClass("last-child")}function r(){var t=parseInt(w.css("fontSize"),10);4>=t?(y.find("button.zoom-out").prop("disabled",!0),w.css("fontSize","4px")):t>=20?y.find("button.zoom-in").prop("disabled",!0):(y.find("button").prop("disabled",!1),w.removeClass("small x-small")),8>=t&&(w.addClass("small"),4>=t&&w.addClass("x-small"))}function l(t){if("zoom-default"==t){var e=P.find(".tv-fs-toggled");e.length&&e.data("tv-fontsize")>0?w.css("fontSize",e.data("tv-fontsize")+"px"):(I=null,c())}else{var a=parseInt(w.css("fontSize"),10);"zoom-in"==t?w.css("fontSize",a+2+"px"):"zoom-out"==t&&w.css("fontSize",a-2+"px")}r()}function c(){f();var t=parseInt(w.css("fontSize"),10),e=w[0];(e.scrollHeight>w.outerHeight()||e.scrollWidth>w.outerWidth())&&t>4?(null==I&&(I="large"),w.css("fontSize",t-1+"px"),f(),"large"==I&&c()):"large"!=I&&(null==I&&(I="small"),w.css("fontSize",t+1+"px"),f(),c()),P.find(".tv-fs-toggled").attr("data-tv-fontsize",parseInt(w.css("fontSize"),10)),r()}function p(t){var e;if("undefined"!=typeof w&&w.is(":visible")?e=w:"undefined"!=typeof C&&C.is(":visible")&&(e=C),"undefined"!=typeof e){var a=e.find("a.hovered");if(a.length){var n=e.next(".tv-tooltip"),i=a[0].getBoundingClientRect(),s=e[0].getBoundingClientRect(),o={top:i.top,right:i.left+s.width,bottom:i.top+s.height,left:i.left,w:i.width,h:i.height},d={top:s.top,right:s.left+s.width,bottom:s.top+s.height,left:s.left,w:s.width,h:s.height};t?n.stop(!0).animate({left:parseInt(o.left+o.w/2-n.outerWidth()/2+7.5,10),top:parseInt(o.top-n.outerHeight()-24,10)},250):n.css({left:parseInt(o.left+o.w/2-n.outerWidth()/2+7.5,10),top:parseInt(o.top-n.outerHeight()-24,10)}),o.left+o.w/2<d.left||o.right+o.w/2<d.right||o.top+o.h/2<d.top||o.bottom+o.h<d.bottom?n.fadeOut(400):n.fadeIn(250)}}}function f(){var t=w.children("ol")[0].getBoundingClientRect();w.css({width:t.width+FSTreePadding.right+FSTreePadding.left,height:t.height+FSTreePadding.top+FSTreePadding.bottom,"max-width":V.width()-FSPadding.right-FSPadding.left,"max-height":V.height()-FSPadding.top-FSPadding.bottom}),k.tv-sentence!=""&&(w.css("max-height",V.height()-FSPadding.top-FSPadding.bottom-2*F[0].getBoundingClientRect().height),F.css("max-width",w[0].getBoundingClientRect().width))}function h(t){errorContainer.children("p").html(t).parent().fadeIn(250),k.normalView&&(C.hide(),g.children(".tv-show-fs").prop("disabled",!0).hide()),w.hide()}function u(){errorContainer.hide(),w.show(),k.normalView&&g.children(".tv-show-fs").prop("disabled",!1).show()}function v(e){return t(t.map(e,function(t){return t.get()}))}var m,g,w,C,b,S,z,x,y,F,I,O,T={normalView:!0,nvFontSize:12,fsFontSize:14,sentence:"",initFSOnClick:!1,extendedPOS:!1,pathToHTML:""},k=t.extend({},T,a),P=this,V=t(window),N=t("body");n(),i(e),k.initFSOnClick||P.find(".tv-show-fs").click(function(t){x.css("top","-100%").children("ul").empty(),"undefined"!=typeof C&&C.find("a").removeClass("hovered"),N.addClass("tv-fs-open"),m.fadeIn(250,function(){I=null,c()}),t.preventDefault()}),z.add(V).scroll(function(){p()}),m.click(function(e){var a=t(e.target);a.closest(".tv-error, .tv-tree, .tv-tooltip, .tv-zoom-wrapper, .tv-sentence").length||(N.removeClass("tv-fs-open"),m.fadeOut(250,function(){w.find("a").removeClass("hovered"),u()}),k.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search))}),y.find("button").click(function(){var e=t(this);if(e.is(".tv-close-fs"))m.fadeOut(250,function(){w.find("a").removeClass("hovered"),u()}),k.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search);else{clearTimeout(O),l(e.attr("class").match(/\b(zoom-[^\s]+)\b/)[0]),f();var a=w.find("a.hovered").css("transition-duration")||200;a=String(a).indexOf("ms")>-1?parseFloat(a):1e3*parseFloat(a),a+=50,O=setTimeout(function(){p(!0)},a)}}),V.on("resize",t.debounce(250,function(){w.is(":visible")&&f()})),z.on("click","a",function(e){if(!t(this).hasClass("ignored")){var a,n=t(this),i=n.parent("li").data(),s=n.tv-closest(".tv-tree"),o=s.next(".tv-tooltip").children("ul");o.empty(),s.find("a").removeClass("hovered"),n.addClass("hovered");for(a in i)i.hasOwnProperty(a)&&t("<li>",{html:"<strong>"+a+"</strong>: "+i[a]}).prependTo(o);p()}e.preventDefault()}),z.on("mouseout","a.hovered",function(){t(this).tv-closest(".tv-tree").hasClass("small")&&t(this).on("transitionend",function(){p(!0)})}),x.find("button").click(function(){var e=t(this).parent(".tv-tooltip");e.fadeOut(250),e.prev(".tv-tree").find("a").removeClass("hovered")})}}(jQuery);
