!function(V){V.fn.treeVisualizer=function(t,e){function a(){z.initFSOnClick||S.find(".tv-show-fs").on("click",function(t){g.css("top","-100%").children("ul").empty(),void 0!==f&&f.find("a").removeClass("hovered"),O.addClass("tv-fs-open"),c.fadeIn(250,function(){c.children("ol").is("[data-tv-fontsize]")||s()}),t.preventDefault()}),m.on("scroll",function(){o()}),c.on("click",function(t){V(t.target).closest(".tv-error, .tv-content-wrapper").length||(O.removeClass("tv-fs-open"),c.fadeOut(250,function(){h.find("a").removeClass("hovered"),r()}),z.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search))}),w.find("button").on("click",function(){var t=V(this);if(t.is(".tv-close-fs"))O.removeClass("tv-fs-open"),c.fadeOut(250,function(){h.find("a").removeClass("hovered"),r()}),z.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search);else{clearTimeout(C),function(t){if("zoom-default"==t)h.children("ol").is("[data-tv-fontsize]")?h.children("ol").css("fontSize",h.children("ol").attr("data-tv-fontsize")+"px"):s();else{var e=parseInt(h.children("ol").css("fontSize"),10);"zoom-in"==t?h.children("ol").css("fontSize",e+2+"px"):"zoom-out"==t&&h.children("ol").css("fontSize",e-2+"px")}i()}(t.attr("class").match(/\b(zoom-[^\s]+)\b/)[0]);var e=h.find("a.hovered").css("transition-duration")||200;e=-1<String(e).indexOf("ms")?parseFloat(e):1e3*parseFloat(e),e+=50,C=setTimeout(function(){o(!0)},e)}}),c.find(".tv-navigation-wrapper button").on("click",function(){var t=c.attr("data-tv-active-index"),e=V(".results-ajax-wrapper tbody:not(.empty)");h.find("a").removeClass("hovered"),v.hide(),V(this).is(".tv-prev-tree")?0<t&&t--:t<e.find("tr").length-1&&t++,n(),e.find("tr").eq(t).find("a").click()}),m.on("click","a",function(t){if(!V(this).hasClass("ignored")){var e,a=V(this),n=a.parent("li").data(),i=a.closest(".tv-tree"),s=i.next(".tv-tooltip").children("ul");for(e in s.empty(),i.find("a").removeClass("hovered"),a.addClass("hovered"),n)n.hasOwnProperty(e)&&V("<li>",{html:"<strong>"+e+"</strong>: "+n[e]}).prependTo(s);o()}t.preventDefault()}),m.on("mouseout","a.hovered",function(){V(this).closest(".tv-tree").hasClass("small")&&V(this).on("transitionend",function(){o(!0)})}),g.children("button").on("click",function(){var t=V(this).parent(".tv-tooltip");t.fadeOut(250),t.prev(".tv-tree").find("a").removeClass("hovered")})}function n(){c.find(".tv-navigation-wrapper button").prop("disabled",!1);var t=c.attr("data-tv-active-index");t<=0?c.find(".tv-navigation-wrapper .tv-prev-tree").prop("disabled",!0):t>=V(".results-ajax-wrapper tbody:not(.empty)").find("tr").length-1&&c.find(".tv-navigation-wrapper .tv-next-tree").prop("disabled",!0)}function i(){var t=parseInt(h.children("ol").css("fontSize"),10),e=h.children("ol").attr("data-tv-fontsize");w.find("button").prop("disabled",!1),h.removeClass("tv-small tv-x-small"),t<=4?(w.find("button.tv-zoom-out").prop("disabled",!0),h.children("ol").css("fontSize","4px")):16<=t&&w.find("button.tv-zoom-in").prop("disabled",!0),t==e&&w.find("button.tv-zoom-default").prop("disabled",!0),t<=8&&(h.addClass("tv-small"),t<=4&&h.addClass("tv-x-small"))}function s(){for(var t=parseInt(h.children("ol").css("fontSize"),10),e=h[0];4<t&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth);)t--,h.children("ol").css("fontSize",t+"px");for(;t<16&&e.scrollHeight<=e.clientHeight&&e.scrollWidth<=e.clientWidth;)if(t++,h.children("ol").css("fontSize",t+"px"),e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth){t--,h.children("ol").css("fontSize",t+"px");break}h.children("ol").attr("data-tv-fontsize",t),i()}function o(t){var e;if(void 0!==h&&O.hasClass("tv-fs-open")?e=h:void 0!==f&&O.hasClass("tv-ns-open")&&(e=f),void 0!==e){var a=e.find("a.hovered");if(a.length){var n=e.next(".tv-tooltip"),i=a[0].getBoundingClientRect(),s=e[0].getBoundingClientRect(),o=k.outerWidth()-i.right,d=k.outerHeight()-i.bottom,r=k.outerWidth()-s.right,l=k.outerHeight()-s.bottom,c={left:parseInt(i.left+i.width/2-n.outerWidth()/2+8,10)+"px",top:parseInt(i.top-n.outerHeight()-24,10)};t?n.stop(!0).animate({left:c.left,top:c.top},250):n.css({left:c.left,top:c.top}),i.left+i.width/2<s.left||o+i.width/2<r||i.top+i.height/2<s.top||d+i.height<l?n.fadeOut(400):n.fadeIn(250)}}}function d(t){errorContainer.children("p").html(t),z.normalView&&p.children(".tv-show-fs").prop("disabled",!0)}function r(){z.normalView&&p.children(".tv-show-fs").prop("disabled",!1)}function l(t){return V(V.map(t,function(t){return t.get()}))}var c,p,h,f,v,u,m,g,w,C,b,x,y,z=V.extend({},{normalView:!0,sentence:"",initFSOnClick:!1,extendedPOS:!1,hasNavigation:!1},e),S=this,k=V(window),O=V("body"),I=0;b=[],x=[],y=[],z.normalView&&(p=S.children("#tree-visualizer"),f=p.find(".tv-tree"),u=f.next(".tv-tooltip"),y.push(p),b.push(f),x.push(u)),c=S.children("#tree-visualizer-fs"),h=c.find(".tv-tree"),v=h.next(".tv-tooltip"),(w=c.find(".tv-zoom-opts")).prev("a").attr("href",t),y.push(c),b.push(h),x.push(v),m=l(b),g=l(x),anyView=l(y),errorContainer=anyView.children(".tv-error"),""!=z.sentence&&anyView.find(".tv-sentence-wrapper").addClass("has-sentence").children("span").html(z.sentence),z.hasNavigation||c.find(".tv-navigation-wrapper").hide(),anyView.find("*").off(),a(),function(t){O.addClass("tv-is-loading"),z.initFSOnClick&&O.addClass("tv-fs-open");var a=++I;V.ajax({type:"GET",url:t,dataType:"xml",cache:!1}).done(function(t){var e;null==t||null==t?(O.addClass("tv-fail").removeClass("tv-success"),d("Your XML appears to be empty or not in a compatible format.")):(O.addClass("tv-success").removeClass("tv-fail"),a==I&&(e=V(t),r(),m.html(function o(t){var d=V("<ol/>");return t.each(function(t,e){for(var a=V('<li><a href="#"></a></li>'),n=0,i=e.attributes.length,s=null;n<i;n++)"highlight"==(s=e.attributes[n]).nodeName?a.addClass("highlight"):"not"==s.nodeName?a.addClass("excluded"):"begin"!=s.nodeName&&"end"!=s.nodeName&&a.attr("data-"+s.nodeName,s.value.replace(/^\s(.+)/,"$1"));V(this).children("node").length&&a.append(o(V(this).children("node"))),d.append(a)}),d}(e.find("node").first())),g.children("ul").empty(),m.find("a").each(function(){var t=V(this),e=t.parent("li");if(O.hasClass("matrix")&&e.data("word")&&(e.data("caseinsensitive")?(e.data("word",e.data("word").toLowerCase()),e.data("lemma",e.data("lemma").toLowerCase())):t.addClass("cs")),e.data("rel")&&(t.append("<span class='rel'>"+e.data("rel")+"</span>"),e.data("index")&&t.append("<span class='index'>"+e.data("index")+"</span>")),e.data("postag")&&z.extendedPOS?t.append("<span class='postag'>"+e.data("postag")+"</span>"):e.data("pt")?e.data("index")?t.children("span:last-child").append(":"+e.data("pt")):t.append("<span class='pt'>"+e.data("pt")+"</span>"):e.data("cat")&&(" "==e.data("cat")?(e.removeAttr("data-cat"),e.removeData("cat"),t.addClass("ignored").text("?").attr("title","Top node's properties will be ignored")):e.data("index")?t.children("span:last-child").append(":"+e.data("cat")):t.append("<span class='cat'>"+e.data("cat")+"</span>")),t.is(":only-child")){if(e.data("lemma")&&e.append("<span class='lemma'>"+e.data("lemma")+"</span>"),e.data("word")){var a=O.hasClass("matrix")&&!e.data("caseinsensitive")?' title="Case sensitive word"':"";e.append("<span class='word'><em"+a+">"+e.data("word")+"</em></span>")}t.addClass("only-child")}e.data("caseinsensitive")&&(e.removeAttr("data-caseinsensitive"),e.removeData("caseinsensitive"))}),m.find("li:only-child").addClass("only-child"),m.find("li:first-child").addClass("first-child"),m.find("li:last-child").addClass("last-child")))}).fail(function(t,e,a){O.addClass("tv-fail").removeClass("tv-success");var n="";0===t.status?n="Not connected to the Internet.<br>Verify your network connection.":404==t.status?n="Requested XML file not found.<br>Try again with another query.":500==t.status?n="Internal Server Error.<br>If the problem persists, contact us.":(n="Something went wrong.<br>Please try again at another time.<br>",n+=t.status+" "+e+" "+a),d(n)}).always(function(){a==I&&O.removeClass("tv-is-loading"),O.hasClass("tv-fail")?V(".continue-btn-wrapper [type='submit']").prop("disabled",!0):V(".continue-btn-wrapper [type='submit']").prop("disabled",!1),z.normalView&&O.addClass("tv-ns-open"),z.initFSOnClick&&c.fadeIn(250,function(){s()})})}(t),n(),k.on("scroll",function(){o()})}}(jQuery);