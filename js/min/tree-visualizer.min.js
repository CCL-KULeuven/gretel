!function(t){t.fn.treeVisualizer=function(e,a){function n(){var t=[],e=[],a=[];if(z.normalView){S.append('<div class="tree-visualizer"></div>'),v=S.children(".tree-visualizer");var n='<div class="tv-error" style="display: none"><p></p></div><div class="tree" style="font-size: '+z.nvFontSize+'px;"></div><aside class="tooltip" style="display: none"><ul></ul><button><i class="fa fa-times"></i></button></aside>';z.fsView&&(n+='<button class="tv-show-fs"><i class="fa fa-arrows-alt"></i></button>'),v.append(n),g=v.children(".tree"),b=v.children(".tooltip"),a.push(v),t.push(g),e.push(b)}if(z.fsView){S.append('<div class="tree-visualizer-fs" style="display: none"></div>'),m=S.children(".tree-visualizer-fs");var o="";z.normalView||(o+='<div class="tv-error" style="display: none"><p></p></div>'),o+='<div class="tree" style="font-size: '+z.fsFontSize+'px;"></div><aside class="tooltip" style="display: none"><ul></ul><button><i class="fa fa-times"></i></button></aside><div class="zoom-opts"><button class="zoom-out">-</button><button class="zoom-default">Default</button><button class="zoom-in">+</button><button class="close"><i class="fa fa-times"></i></button></div>',m.append(o),$=m.children(".tree"),w=m.children(".tooltip"),k=m.children(".zoom-opts"),""!=z.sentence&&($.before('<div class="sentence">'+decodeURI(z.sentence)+"</div>"),V=m.children(".sentence")),a.push(m),t.push($),e.push(w)}y=f(t),C=f(e),anyView=f(a),errorContainer=anyView.children(".tv-error")}function o(e){t.ajax({type:"GET",url:e,dataType:"xml"}).done(function(t){null==t?u("Your XML appears to be empty or not in a compatible format."):s(t)}).fail(function(t){var e="";e=0===t.status?"Not connect to the Internet.<br>Verify your network connection.":404==t.status?"Requested XML file not found.<br>Try again with another query.":500==t.status?"Internal Server Error.<br>If the problem persists, contact us.":"Uncaught Error.<br>Please try again at another time.",u(e)}).always(function(){z.normalView&&S.addClass("active"),z.initFSOnClick&&(t(".loading-wrapper.tv").removeClass("active"),m.fadeIn(250),p())})}function s(e){var a=t(e);h(),y.html(i(a.find("node").first())),C.children("ul").empty(),r()}function i(e){var a=t("<ol/>");return e.each(function(e,n){for(var o=t('<li><a href="#"></a></li>'),s=0,r=n.attributes.length,l=null;r>s;s++)l=n.attributes[s],"highlight"==l.nodeName?o.addClass("highlight"):"begin"!=l.nodeName&&"end"!=l.nodeName&&o.attr("data-"+l.nodeName,l.value.replace(/^\s(.+)/g,"$1"));t(this).children("node").length&&o.append(i(t(this).children("node"))),a.append(o)}),a}function r(){y.find("a").each(function(){var e=t(this),a=e.parent("li");a.data("rel")&&(e.append("<span>"+a.data("rel")+"<span>"),a.data("index")&&e.append("<span>"+a.data("index")+"</span>")),a.data("postag")&&z.extendedPOS?e.append("<span>"+a.data("postag")+"</span>"):a.data("pt")?a.data("index")?e.children("span:last-child").append(":"+a.data("pt")):e.append("<span>"+a.data("pt")+"</span>"):a.data("cat")&&(a.data("index")?e.children("span:last-child").append(":"+a.data("cat")):e.append("<span>"+a.data("cat")+"</span>")),e.is(":only-child")&&(a.data("lemma")&&a.append("<span>"+a.data("lemma")+"</span>"),a.data("word")&&a.append("<span><em>"+a.data("word")+"</em></span>"),e.addClass("only-child"))}),y.find("li:only-child").addClass("only-child"),y.find("li:first-child").addClass("first-child"),y.find("li:last-child").addClass("last-child")}function l(){var t=parseInt($.css("fontSize"),10);4>=t?k.find("button.zoom-out").prop("disabled",!0):t>=32?k.find("button.zoom-in").prop("disabled",!0):(k.find("button").prop("disabled",!1),$.removeClass("small x-small")),8>=t&&($.addClass("small"),4>=t&&$.addClass("x-small"))}function d(t){if($.is(":visible")){if("zoom-default"==t)$.css("fontSize",z.fsFontSize+"px");else{var e=parseInt($.css("fontSize"),10);"zoom-in"==t?$.css("fontSize",e+2+"px"):"zoom-out"==t&&$.css("fontSize",e-2+"px")}l()}}function c(t){var e;if("undefined"!=typeof $&&$.is(":visible")?e=$:"undefined"!=typeof g&&g.is(":visible")&&(e=g),"undefined"!=typeof e){var a=e.find("a.hovered");if(a.length){var n=e.next(".tooltip"),o=a[0].getBoundingClientRect(),s=e[0].getBoundingClientRect(),i={top:o.top,right:o.left+s.width,bottom:o.top+s.height,left:o.left,w:o.width,h:o.height},r={top:s.top,right:s.left+s.width,bottom:s.top+s.height,left:s.left,w:s.width,h:s.height};t?n.animate({left:parseInt(i.left+i.w/2-n.outerWidth()/2+7.5,10),top:parseInt(i.top-n.outerHeight()-24,10)},250):n.css({left:parseInt(i.left+i.w/2-n.outerWidth()/2+7.5,10),top:parseInt(i.top-n.outerHeight()-24,10)}),i.left+i.w/2<r.left||i.right+i.w/2<r.right||i.top+i.h/2<r.top||i.bottom+i.h<r.bottom?n.fadeOut(400):n.fadeIn(250)}}}function p(){if($.is(":visible")){var t=parseInt($.css("paddingRight"),10)||0,e=parseInt($.css("paddingLeft"),10)||0,a=parseInt($.css("paddingTop"),10)||0,n=parseInt($.css("paddingBottom"),10)||0,o=parseInt(m.css("paddingRight"),10)||0,s=parseInt(m.css("paddingLeft"),10)||0,i=parseInt(m.css("paddingTop"),10)||0,r=parseInt(m.css("paddingBottom"),10)||0,l=$.children("ol"),d=I;$.css({width:l[0].getBoundingClientRect().width+t+e,width:l[0].getBoundingClientRect().width+t+e,height:l[0].getBoundingClientRect().height+a+n,"max-width":d.width()-o-s,"max-height":d.height()-i-r}),""!=z.sentence&&($.css("max-height",d.height()-i-r-2*V[0].getBoundingClientRect().height),V.css("max-width",$[0].getBoundingClientRect().width))}}function u(t){errorContainer.children("p").html(t).parent().fadeIn(250),z.normalView&&(g.hide(),v.children(".tv-show-fs").prop("disabled",!0).hide()),z.fsView&&$.hide()}function h(){errorContainer.hide(),$.show(),z.normalView&&v.children(".tv-show-fs").prop("disabled",!1).show()}function f(e){return t(t.map(e,function(t){return t.get()}))}var m,v,$,g,w,b,y,C,k,V,x={normalView:!0,nvFontSize:12,fsView:!0,fsFontSize:14,sentence:"",initFSOnClick:!1,extendedPOS:!1},z=t.extend({},x,a),S=this,I=t(window);z.normalView||z.fsView?(S.children(".tree-visualizer, .tree-visualizer-fs").remove(),n(),o(e)):console.error("Cannot initialize Tree Visualizer: either the container does not exist, or you have set both normal and fullscreen view to false, which does not make sense."),z.initFSOnClick||S.find(".tv-show-fs").click(function(t){C.css("top","-100%").children("ul").empty(),"undefined"!=typeof g&&g.find("a").removeClass("hovered"),m.fadeIn(250),p(),t.preventDefault()}),y.add(I).scroll(function(){c()}),m.click(function(e){var a=t(e.target);a.closest(".tv-error, .tree, .tooltip, .zoom-opts, .sentence").length||(m.fadeOut(250,function(){$.find("a").removeClass("hovered"),h()}),z.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search))}),k.find("button").click(function(){var e=t(this);if(e.is(".close"))m.fadeOut(250,function(){$.find("a").removeClass("hovered"),h()}),z.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search);else{d(e.attr("class").match(/\b(zoom-[^\s]+)\b/)[0]),p();var a=$.find("a.hovered").css("transition-duration")||200;a=String(a).indexOf("ms")>-1?parseFloat(a):1e3*parseFloat(a),a+=50,setTimeout(function(){c(!0)},a)}}),z.fsView&&I.on("resize",p),y.on("click","a",function(e){var a=t(this),n=a.parent("li"),o=n.data(),s=a.closest(".tree"),i=s.find("a"),r=s.next(".tooltip").children("ul");r.empty(),i.removeClass("hovered"),a.addClass("hovered");var l;for(l in o)o.hasOwnProperty(l)&&t("<li>",{html:"<strong>"+l+"</strong>: "+o[l]}).prependTo(r);c(),e.preventDefault()}),y.on("mouseout","a.hovered",function(){var e=t(this);e.closest(".tree").hasClass("small")&&e.on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){c(!0)})}),C.find("button").click(function(){var e=t(this),a=e.parent(".tooltip"),n=a.prev(".tree"),o=n.find("a");a.fadeOut(250),o.removeClass("hovered")})}}(jQuery);
