!function(t){t.fn.treeVisualizer=function(e,a){function n(){V.initFSOnClick||I.find(".tv-show-fs").on("click",function(t){S.css("top","-100%").children("ul").empty(),"undefined"!=typeof C&&C.find("a").removeClass("hovered"),N.addClass("tv-fs-open"),g.fadeIn(250,function(){g.children("ol").is("[data-tv-fontsize]")||f()}),t.preventDefault()}),z.on("scroll",function(){h()}),g.on("click",function(e){var a=t(e.target);a.closest(".tv-error, .tv-content-wrapper").length||(N.removeClass("tv-fs-open"),g.fadeOut(250,function(){b.find("a").removeClass("hovered"),u()}),V.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search))}),k.find("button").on("click",function(){var e=t(this);if(e.is(".tv-close-fs"))N.removeClass("tv-fs-open"),g.fadeOut(250,function(){b.find("a").removeClass("hovered"),u()}),V.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search);else{clearTimeout($),p(e.attr("class").match(/\b(zoom-[^\s]+)\b/)[0]);var a=b.find("a.hovered").css("transition-duration")||200;a=String(a).indexOf("ms")>-1?parseFloat(a):1e3*parseFloat(a),a+=50,$=setTimeout(function(){h(!0)},a)}}),g.find(".tv-navigation-wrapper button").on("click",function(){var e=g.attr("data-tv-active-index"),a=t(".results-ajax-wrapper tbody:not(.empty)");b.find("a").removeClass("hovered"),y.hide(),t(this).is(".tv-prev-tree")?e>0&&e--:e<a.find("tr").length-1&&e++,i(),a.find("tr").eq(e).find("a").click()}),z.on("click","a",function(e){if(!t(this).hasClass("ignored")){var a,n=t(this),i=n.parent("li").data(),o=n.closest(".tv-tree"),s=o.next(".tv-tooltip").children("ul");s.empty(),o.find("a").removeClass("hovered"),n.addClass("hovered");for(a in i)i.hasOwnProperty(a)&&t("<li>",{html:"<strong>"+a+"</strong>: "+i[a]}).prependTo(s);h()}e.preventDefault()}),z.on("mouseout","a.hovered",function(){t(this).closest(".tv-tree").hasClass("small")&&t(this).on("transitionend",function(){h(!0)})}),S.children("button").on("click",function(){var e=t(this).parent(".tv-tooltip");e.fadeOut(250),e.prev(".tv-tree").find("a").removeClass("hovered")})}function i(){g.find(".tv-navigation-wrapper button").prop("disabled",!1);var e=g.attr("data-tv-active-index");0>=e?g.find(".tv-navigation-wrapper .tv-prev-tree").prop("disabled",!0):e>=t(".results-ajax-wrapper tbody:not(.empty)").find("tr").length-1&&g.find(".tv-navigation-wrapper .tv-next-tree").prop("disabled",!0)}function o(){var t=[],a=[],i=[];V.normalView&&(w=I.children("#tree-visualizer"),C=w.find(".tv-tree"),x=C.next(".tv-tooltip"),i.push(w),t.push(C),a.push(x)),g=I.children("#tree-visualizer-fs"),b=g.find(".tv-tree"),y=b.next(".tv-tooltip"),k=g.find(".tv-zoom-opts"),k.prev("a").attr("href",e),i.push(g),t.push(b),a.push(y),z=m(t),S=m(a),anyView=m(i),errorContainer=anyView.children(".tv-error"),""!=V.sentence&&anyView.find(".tv-sentence-wrapper").addClass("has-sentence").children("span").html(V.sentence),V.hasNavigation||g.find(".tv-navigation-wrapper").hide(),anyView.find("*").off(),n()}function s(e){N.addClass("tv-is-loading"),V.initFSOnClick&&N.addClass("tv-fs-open");var a=++T;t.ajax({type:"GET",url:e,dataType:"xml",cache:!1}).done(function(t){null==t||void 0==t?(N.addClass("tv-fail").removeClass("tv-success"),v("Your XML appears to be empty or not in a compatible format.")):(N.addClass("tv-success").removeClass("tv-fail"),a==T&&r(t))}).fail(function(t,e,a){N.addClass("tv-fail").removeClass("tv-success");var n="";0===t.status?n="Not connected to the Internet.<br>Verify your network connection.":404==t.status?n="Requested XML file not found.<br>Try again with another query.":500==t.status?n="Internal Server Error.<br>If the problem persists, contact us.":(n="Something went wrong.<br>Please try again at another time.<br>",n+=t.status+" "+e+" "+a),v(n)}).always(function(){a==T&&N.removeClass("tv-is-loading"),N.hasClass("tv-fail")?t(".continue-btn-wrapper [type='submit']").prop("disabled",!0):t(".continue-btn-wrapper [type='submit']").prop("disabled",!1),V.normalView&&N.addClass("tv-ns-open"),V.initFSOnClick&&g.fadeIn(250,function(){f()})})}function r(e){var a=t(e);u(),z.html(d(a.find("node").first())),S.children("ul").empty(),l()}function d(e){var a=t("<ol/>");return e.each(function(e,n){for(var i=t('<li><a href="#"></a></li>'),o=0,s=n.attributes.length,r=null;s>o;o++)r=n.attributes[o],"highlight"==r.nodeName?i.addClass("highlight"):"not"==r.nodeName?i.addClass("excluded"):"begin"!=r.nodeName&&"end"!=r.nodeName&&i.attr("data-"+r.nodeName,r.value.replace(/^\s(.+)/,"$1"));t(this).children("node").length&&i.append(d(t(this).children("node"))),a.append(i)}),a}function l(){z.find("a").each(function(){var e=t(this),a=e.parent("li");if(N.hasClass("matrix")&&a.data("word")&&(a.data("caseinsensitive")?(a.data("word",a.data("word").toLowerCase()),a.data("lemma",a.data("lemma").toLowerCase())):e.addClass("cs")),a.data("rel")&&(e.append("<span class='rel'>"+a.data("rel")+"</span>"),a.data("index")&&e.append("<span class='index'>"+a.data("index")+"</span>")),a.data("postag")&&V.extendedPOS?e.append("<span class='postag'>"+a.data("postag")+"</span>"):a.data("pt")?a.data("index")?e.children("span:last-child").append(":"+a.data("pt")):e.append("<span class='pt'>"+a.data("pt")+"</span>"):a.data("cat")&&(" "==a.data("cat")?(a.removeAttr("data-cat"),a.removeData("cat"),e.addClass("ignored").text("?").attr("title","Top node's properties will be ignored")):a.data("index")?e.children("span:last-child").append(":"+a.data("cat")):e.append("<span class='cat'>"+a.data("cat")+"</span>")),e.is(":only-child")){if(a.data("lemma")&&a.append("<span class='lemma'>"+a.data("lemma")+"</span>"),a.data("word")){var n=N.hasClass("matrix")&&!a.data("caseinsensitive")?' title="Case sensitive word"':"";a.append("<span class='word'><em"+n+">"+a.data("word")+"</em></span>")}e.addClass("only-child")}a.data("caseinsensitive")&&(a.removeAttr("data-caseinsensitive"),a.removeData("caseinsensitive"))}),z.find("li:only-child").addClass("only-child"),z.find("li:first-child").addClass("first-child"),z.find("li:last-child").addClass("last-child")}function c(){var t=parseInt(b.children("ol").css("fontSize"),10),e=b.children("ol").attr("data-tv-fontsize");k.find("button").prop("disabled",!1),b.removeClass("tv-small tv-x-small"),4>=t?(k.find("button.tv-zoom-out").prop("disabled",!0),b.children("ol").css("fontSize","4px")):t>=16&&k.find("button.tv-zoom-in").prop("disabled",!0),t==e&&k.find("button.tv-zoom-default").prop("disabled",!0),8>=t&&(b.addClass("tv-small"),4>=t&&b.addClass("tv-x-small"))}function p(t){if("zoom-default"==t)b.children("ol").is("[data-tv-fontsize]")?b.children("ol").css("fontSize",b.children("ol").attr("data-tv-fontsize")+"px"):f();else{var e=parseInt(b.children("ol").css("fontSize"),10);"zoom-in"==t?b.children("ol").css("fontSize",e+2+"px"):"zoom-out"==t&&b.children("ol").css("fontSize",e-2+"px")}c()}function f(){for(var t=parseInt(b.children("ol").css("fontSize"),10),e=b[0];t>4&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth);)t--,b.children("ol").css("fontSize",t+"px");for(;16>t&&e.scrollHeight<=e.clientHeight&&e.scrollWidth<=e.clientWidth;)if(t++,b.children("ol").css("fontSize",t+"px"),e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth){t--,b.children("ol").css("fontSize",t+"px");break}b.children("ol").attr("data-tv-fontsize",t),c()}function h(t){var e;if("undefined"!=typeof b&&N.hasClass("tv-fs-open")?e=b:"undefined"!=typeof C&&N.hasClass("tv-ns-open")&&(e=C),"undefined"!=typeof e){var a=e.find("a.hovered");if(a.length){var n=e.next(".tv-tooltip"),i=a[0].getBoundingClientRect(),o=e[0].getBoundingClientRect(),s={right:H.outerWidth()-i.right,bottom:H.outerHeight()-i.bottom},r={right:H.outerWidth()-o.right,bottom:H.outerHeight()-o.bottom},d={left:parseInt(i.left+i.width/2-n.outerWidth()/2+8,10)+"px",top:parseInt(i.top-n.outerHeight()-24,10)};t?n.stop(!0).animate({left:d.left,top:d.top},250):n.css({left:d.left,top:d.top}),i.left+i.width/2<o.left||s.right+i.width/2<r.right||i.top+i.height/2<o.top||s.bottom+i.height<r.bottom?n.fadeOut(400):n.fadeIn(250)}}}function v(t){errorContainer.children("p").html(t),V.normalView&&w.children(".tv-show-fs").prop("disabled",!0)}function u(){V.normalView&&w.children(".tv-show-fs").prop("disabled",!1)}function m(e){return t(t.map(e,function(t){return t.get()}))}var g,w,b,C,y,x,z,S,k,$,O={normalView:!0,sentence:"",initFSOnClick:!1,extendedPOS:!1,hasNavigation:!1},V=t.extend({},O,a),I=this,H=t(window),N=t("body"),T=0;o(),s(e),i(),H.on("scroll",function(){h()})}}(jQuery);
