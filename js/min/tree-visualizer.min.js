!function(t){t.fn.treeVisualizer=function(e,n){function i(){var t=[],n=[],i=[];if(F.normalView){T.append('<div class="tree-visualizer"></div>'),g=T.children(".tree-visualizer");var a='<div class="tv-error" style="display: none"><p></p></div><div class="tree" style="font-size: '+F.nvFontSize+'px;"></div><aside class="tooltip" style="display: none"><ul></ul><button><i class="fa fa-fw fa-times"></i></button></aside>';F.fsView&&(a+='<button class="tv-show-fs" title="Open the tree in full screen mode"><i class="fa fa-fw fa-arrows-alt"></i></button>'),g.append(a),b=g.children(".tree"),y=g.children(".tooltip"),i.push(g),t.push(b),n.push(y)}if(F.fsView){T.append('<div class="tree-visualizer-fs" style="display: none"></div>'),m=T.children(".tree-visualizer-fs");var o="";F.normalView||(o+='<div class="tv-error" style="display: none"><p></p></div>'),o+='<div class="tree" style="font-size: '+F.fsFontSize+'px;"></div><aside class="tooltip" style="display: none"><ul></ul><button><i class="fa fa-fw fa-times"></i></button></aside><div class="zoom-opts-wrapper"><a href="'+e+'" target="_blank" title="Show XML">Show XML</a><div class="zoom-opts"><button class="zoom-out"><i class="fa fa-fw fa-search-minus" aria-hidden="true"></i></button><button class="zoom-default">Default</button><button class="zoom-in"><i class="fa fa-fw fa-search-plus" aria-hidden="true"></i></button><button class="close"><i class="fa fa-fw fa-times"></i></button></div></div>',m.append(o),w=m.children(".tree"),z=m.children(".tooltip"),S=m.find(".zoom-opts"),""!=F.sentence&&(w.before('<div class="sentence">'+decodeURI(F.sentence)+"</div>"),V=m.children(".sentence")),i.push(m),t.push(w),n.push(z),m.css({"padding-top":E.top,"padding-right":E.right,"padding-bottom":E.bottom,"padding-left":E.left}),w.css({"padding-top":B.top,"padding-right":B.right,"padding-bottom":B.bottom,"padding-left":B.left})}C=v(t),x=v(n),anyView=v(i),errorContainer=anyView.children(".tv-error")}function a(e){t.ajax({type:"GET",url:e,dataType:"xml",cache:!1}).done(function(t){null==t?h("Your XML appears to be empty or not in a compatible format."):o(t)}).fail(function(t,e,n){var i="";0===t.status?i="Not connect to the Internet.<br>Verify your network connection.":404==t.status?i="Requested XML file not found.<br>Try again with another query.":500==t.status?i="Internal Server Error.<br>If the problem persists, contact us.":(i="Uncaught Error.<br>Please try again at another time.",i+=t.status+" "+e+" "+n),h(i)}).always(function(){F.normalView&&T.addClass("active"),F.initFSOnClick&&(t(".loading-wrapper.tv").removeClass("active"),m.fadeIn(250,function(){I=null,c()}))})}function o(e){var n=t(e);u(),C.html(s(n.find("node").first())),x.children("ul").empty(),l()}function s(e){var n=t("<ol/>");return e.each(function(e,i){for(var a=t('<li><a href="#"></a></li>'),o=0,l=i.attributes.length,d=null;l>o;o++)d=i.attributes[o],"highlight"==d.nodeName?a.addClass("highlight"):"begin"!=d.nodeName&&"end"!=d.nodeName&&a.attr("data-"+d.nodeName,d.value.replace(/^\s(.+)/g,"$1"));t(this).children("node").length&&a.append(s(t(this).children("node"))),n.append(a)}),n}function l(){C.find("a").each(function(){var e=t(this),n=e.parent("li");n.data("rel")&&(e.append("<span>"+n.data("rel")+"</span>"),n.data("index")&&e.append("<span>"+n.data("index")+"</span>")),n.data("postag")&&F.extendedPOS?e.append("<span>"+n.data("postag")+"</span>"):n.data("pt")?n.data("index")?e.children("span:last-child").append(":"+n.data("pt")):e.append("<span>"+n.data("pt")+"</span>"):n.data("cat")&&(n.data("index")?e.children("span:last-child").append(":"+n.data("cat")):e.append("<span>"+n.data("cat")+"</span>")),e.is(":only-child")&&(n.data("lemma")&&n.append("<span>"+n.data("lemma")+"</span>"),n.data("word")&&n.append("<span><em>"+n.data("word")+"</em></span>"),e.addClass("only-child"))}),C.find("li:only-child").addClass("only-child"),C.find("li:first-child").addClass("first-child"),C.find("li:last-child").addClass("last-child")}function d(){var t=parseInt(w.css("fontSize"),10);4>=t?S.find("button.zoom-out").prop("disabled",!0):t>=20?S.find("button.zoom-in").prop("disabled",!0):(S.find("button").prop("disabled",!1),w.removeClass("small x-small")),8>=t&&(w.addClass("small"),4>=t&&w.addClass("x-small"))}function r(t){if("zoom-default"==t){var e=T.find(".tv-fs-toggled");e.length&&e.data("tv-fontsize")>0?w.css("fontSize",e.data("tv-fontsize")+"px"):(I=null,c())}else{var n=parseInt(w.css("fontSize"),10);"zoom-in"==t?w.css("fontSize",n+2+"px"):"zoom-out"==t&&w.css("fontSize",n-2+"px")}d()}function c(){p();var t=parseInt(w.css("fontSize"),10),e=w[0],n=e.scrollWidth,i=e.scrollHeight,a=w.outerWidth(),o=w.outerHeight();(i>o||n>a)&&t>4?(null==I&&(I="large"),w.css("fontSize",t-1+"px"),p(),"large"==I&&c()):"large"!=I&&(null==I&&(I="small"),w.css("fontSize",t+1+"px"),p(),c()),T.find(".tv-fs-toggled").attr("data-tv-fontsize",parseInt(w.css("fontSize"),10)),d()}function f(t){var e;if("undefined"!=typeof w&&w.is(":visible")?e=w:"undefined"!=typeof b&&b.is(":visible")&&(e=b),"undefined"!=typeof e){var n=e.find("a.hovered");if(n.length){var i=e.next(".tooltip"),a=n[0].getBoundingClientRect(),o=e[0].getBoundingClientRect(),s={top:a.top,right:a.left+o.width,bottom:a.top+o.height,left:a.left,w:a.width,h:a.height},l={top:o.top,right:o.left+o.width,bottom:o.top+o.height,left:o.left,w:o.width,h:o.height};t?i.stop(!0).animate({left:parseInt(s.left+s.w/2-i.outerWidth()/2+7.5,10),top:parseInt(s.top-i.outerHeight()-24,10)},250):i.css({left:parseInt(s.left+s.w/2-i.outerWidth()/2+7.5,10),top:parseInt(s.top-i.outerHeight()-24,10)}),s.left+s.w/2<l.left||s.right+s.w/2<l.right||s.top+s.h/2<l.top||s.bottom+s.h<l.bottom?i.fadeOut(400):i.fadeIn(250)}}}function p(){var t=w.children("ol")[0].getBoundingClientRect();w.css({width:t.width+B.right+B.left,height:t.height+B.top+B.bottom,"max-width":R.width()-E.right-E.left,"max-height":R.height()-E.top-E.bottom}),""!=F.sentence&&(w.css("max-height",R.height()-E.top-E.bottom-2*V[0].getBoundingClientRect().height),V.css("max-width",w[0].getBoundingClientRect().width))}function h(t){errorContainer.children("p").html(t).parent().fadeIn(250),F.normalView&&(b.hide(),g.children(".tv-show-fs").prop("disabled",!0).hide()),F.fsView&&w.hide()}function u(){errorContainer.hide(),w.show(),F.normalView&&g.children(".tv-show-fs").prop("disabled",!1).show()}function v(e){return t(t.map(e,function(t){return t.get()}))}var m,g,w,b,z,y,C,x,S,V,I,k,O={normalView:!0,nvFontSize:12,fsView:!0,fsFontSize:14,sentence:"",initFSOnClick:!1,extendedPOS:!1},F=t.extend({},O,n),T=this,R=t(window),E={top:84,right:36,bottom:48,left:36},B={top:12,right:12,bottom:12,left:12};F.normalView||F.fsView?(T.children(".tree-visualizer, .tree-visualizer-fs").remove(),i(),a(e)):console.error("Cannot initialize Tree Visualizer: either the container does not exist, or you have set both normal and fullscreen view to false, which does not make sense."),F.initFSOnClick||T.find(".tv-show-fs").click(function(e){t(this);x.css("top","-100%").children("ul").empty(),"undefined"!=typeof b&&b.find("a").removeClass("hovered"),m.fadeIn(250,function(){I=null,c()}),e.preventDefault()}),C.add(R).scroll(function(){f()}),m.click(function(e){var n=t(e.target);n.closest(".tv-error, .tree, .tooltip, .zoom-opts-wrapper, .sentence").length||(m.fadeOut(250,function(){w.find("a").removeClass("hovered"),u()}),F.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search))}),S.find("button").click(function(){var e=t(this);if(e.is(".close"))m.fadeOut(250,function(){w.find("a").removeClass("hovered"),u()}),F.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search);else{clearTimeout(k),r(e.attr("class").match(/\b(zoom-[^\s]+)\b/)[0]),p();var n=w.find("a.hovered").css("transition-duration")||200;n=String(n).indexOf("ms")>-1?parseFloat(n):1e3*parseFloat(n),n+=50,k=setTimeout(function(){f(!0)},n)}}),F.fsView&&R.on("resize",function(){w.is(":visible")}),C.on("click","a",function(e){var n=t(this),i=n.parent("li"),a=i.data(),o=n.closest(".tree"),s=o.find("a"),l=o.next(".tooltip").children("ul");l.empty(),s.removeClass("hovered"),n.addClass("hovered");var d;for(d in a)a.hasOwnProperty(d)&&t("<li>",{html:"<strong>"+d+"</strong>: "+a[d]}).prependTo(l);f(),e.preventDefault()}),C.on("mouseout","a.hovered",function(){var e=t(this);e.closest(".tree").hasClass("small")&&e.on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){f(!0)})}),x.find("button").click(function(){var e=t(this),n=e.parent(".tooltip"),i=n.prev(".tree"),a=i.find("a");n.fadeOut(250),a.removeClass("hovered")})}}(jQuery);
