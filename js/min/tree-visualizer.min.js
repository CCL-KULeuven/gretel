!function(t){t.fn.treeVisualizer=function(e,a){function n(){var t=[],a=[],n=[];if(P.normalView){F.append('<div class="tree-visualizer"></div>'),g=F.children(".tree-visualizer");var i='<div class="tv-error" style="display: none"><p></p></div><div class="tree" style="font-size: '+P.nvFontSize+'px;"></div><aside class="tooltip" style="display: none"><ul></ul><button title="Close this tooltip" type="button"><i class="fa fa-fw fa-times fa-loaded"></i><span class="sr-only">Close this tooltip</span></button></aside>';P.fsView&&(i+='<button class="tv-show-fs" title="Open the tree in full screen mode" type="button"><i class="fa fa-fw fa-arrows-alt fa-loaded"></i><span class="sr-only">Open the tree in fullscreen mode</span></button>'),g.append(i),w=g.children(".tree"),C=g.children(".tooltip"),n.push(g),t.push(w),a.push(C)}if(P.fsView){F.append('<div class="tree-visualizer-fs" style="display: none"></div>'),m=F.children(".tree-visualizer-fs");var o="";P.normalView||(o+='<div class="tv-error" style="display: none"><p></p></div>'),o+='<div class="tree" style="font-size: '+P.fsFontSize+'px;"></div><aside class="tooltip" style="display: none"><ul></ul><button title="Close this tooltip" type="button"><i class="fa fa-fw fa-times fa-loaded"></i><span class="sr-only">Close this tooltip</span></button></aside><div class="zoom-opts-wrapper"><a href="'+e+'" target="_blank" title="Show XML">Show XML</a><div class="zoom-opts"><button class="zoom-out" type="button"><i class="fa fa-fw fa-search-minus fa-loaded" aria-hidden="true"></i></button><button class="zoom-default" type="button">Default</button><button class="zoom-in" type="button"><i class="fa fa-fw fa-search-plus fa-loaded" aria-hidden="true"></i></button><button title="Close fullscreen mode" type="button" class="close"><i class="fa fa-fw fa-times fa-loaded"></i><span class="sr-only">Closen fullscreen mode</span></button></div></div>',m.append(o),b=m.children(".tree"),y=m.children(".tooltip"),k=m.find(".zoom-opts"),""!=P.sentence&&(b.before('<div class="sentence">'+decodeURI(P.sentence)+"</div>"),z=m.children(".sentence")),n.push(m),t.push(b),a.push(y),m.css({"padding-top":T.top,"padding-right":T.right,"padding-bottom":T.bottom,"padding-left":T.left}),b.css({"padding-top":R.top,"padding-right":R.right,"padding-bottom":R.bottom,"padding-left":R.left})}x=v(t),$=v(a),anyView=v(n),errorContainer=anyView.children(".tv-error")}function i(e){t.ajax({type:"GET",url:e,dataType:"xml",cache:!1}).done(function(t){null==t?u("Your XML appears to be empty or not in a compatible format."):o(t)}).fail(function(t,e,a){var n="";0===t.status?n="Not connected to the Internet.<br>Verify your network connection.":404==t.status?n="Requested XML file not found.<br>Try again with another query.":500==t.status?n="Internal Server Error.<br>If the problem persists, contact us.":(n="Uncaught Error.<br>Please try again at another time.<br>",n+=t.status+" "+e+" "+a),u(n)}).always(function(){P.normalView&&F.addClass("active"),P.initFSOnClick&&(t(".loading-wrapper.tv").removeClass("active"),m.fadeIn(250,function(){S=null,p()}))})}function o(e){var a=t(e);f(),x.html(s(a.find("node").first())),$.children("ul").empty(),l()}function s(e){var a=t("<ol/>");return e.each(function(e,n){for(var i=t('<li><a href="#"></a></li>'),o=0,l=n.attributes.length,r=null;l>o;o++)r=n.attributes[o],"highlight"==r.nodeName?i.addClass("highlight"):"not"==r.nodeName?i.addClass("excluded"):"begin"!=r.nodeName&&"end"!=r.nodeName&&i.attr("data-"+r.nodeName,r.value.replace(/^\s(.+)/,"$1"));t(this).children("node").length&&i.append(s(t(this).children("node"))),a.append(i)}),a}function l(){x.find("a").each(function(){var e=t(this),a=e.parent("li");if(X.hasClass("matrix")&&a.data("word")&&(a.data("caseinsensitive")?(a.data("word",a.data("word").toLowerCase()),a.data("lemma",a.data("lemma").toLowerCase())):e.addClass("cs")),a.data("rel")&&(e.append("<span class='rel'>"+a.data("rel")+"</span>"),a.data("index")&&e.append("<span class='index'>"+a.data("index")+"</span>")),a.data("postag")&&P.extendedPOS?e.append("<span class='postag'>"+a.data("postag")+"</span>"):a.data("pt")?a.data("index")?e.children("span:last-child").append(":"+a.data("pt")):e.append("<span class='pt'>"+a.data("pt")+"</span>"):a.data("cat")&&(" "==a.data("cat")?(a.removeAttr("data-cat"),a.removeData("cat"),e.addClass("ignored").text("?").attr("title","Top node's properties will be ignored")):a.data("index")?e.children("span:last-child").append(":"+a.data("cat")):e.append("<span class='cat'>"+a.data("cat")+"</span>")),e.is(":only-child")){if(a.data("lemma")&&a.append("<span class='lemma'>"+a.data("lemma")+"</span>"),a.data("word")){var n=X.hasClass("matrix")&&!a.data("caseinsensitive")?' title="Case sensitive word"':"";a.append("<span class='word'><em"+n+">"+a.data("word")+"</em></span>")}e.addClass("only-child")}a.data("caseinsensitive")&&(a.removeAttr("data-caseinsensitive"),a.removeData("caseinsensitive"))}),x.find("li:only-child").addClass("only-child"),x.find("li:first-child").addClass("first-child"),x.find("li:last-child").addClass("last-child")}function r(){var t=parseInt(b.css("fontSize"),10);4>=t?(k.find("button.zoom-out").prop("disabled",!0),b.css("fontSize","4px")):t>=20?k.find("button.zoom-in").prop("disabled",!0):(k.find("button").prop("disabled",!1),b.removeClass("small x-small")),8>=t&&(b.addClass("small"),4>=t&&b.addClass("x-small"))}function d(t){if("zoom-default"==t){var e=F.find(".tv-fs-toggled");e.length&&e.data("tv-fontsize")>0?b.css("fontSize",e.data("tv-fontsize")+"px"):(S=null,p())}else{var a=parseInt(b.css("fontSize"),10);"zoom-in"==t?b.css("fontSize",a+2+"px"):"zoom-out"==t&&b.css("fontSize",a-2+"px")}r()}function p(){h();var t=parseInt(b.css("fontSize"),10),e=b[0],a=e.scrollWidth,n=e.scrollHeight,i=b.outerWidth(),o=b.outerHeight();(n>o||a>i)&&t>4?(null==S&&(S="large"),b.css("fontSize",t-1+"px"),h(),"large"==S&&p()):"large"!=S&&(null==S&&(S="small"),b.css("fontSize",t+1+"px"),h(),p()),F.find(".tv-fs-toggled").attr("data-tv-fontsize",parseInt(b.css("fontSize"),10)),r()}function c(t){var e;if("undefined"!=typeof b&&b.is(":visible")?e=b:"undefined"!=typeof w&&w.is(":visible")&&(e=w),"undefined"!=typeof e){var a=e.find("a.hovered");if(a.length){var n=e.next(".tooltip"),i=a[0].getBoundingClientRect(),o=e[0].getBoundingClientRect(),s={top:i.top,right:i.left+o.width,bottom:i.top+o.height,left:i.left,w:i.width,h:i.height},l={top:o.top,right:o.left+o.width,bottom:o.top+o.height,left:o.left,w:o.width,h:o.height};t?n.stop(!0).animate({left:parseInt(s.left+s.w/2-n.outerWidth()/2+7.5,10),top:parseInt(s.top-n.outerHeight()-24,10)},250):n.css({left:parseInt(s.left+s.w/2-n.outerWidth()/2+7.5,10),top:parseInt(s.top-n.outerHeight()-24,10)}),s.left+s.w/2<l.left||s.right+s.w/2<l.right||s.top+s.h/2<l.top||s.bottom+s.h<l.bottom?n.fadeOut(400):n.fadeIn(250)}}}function h(){var t=b.children("ol")[0].getBoundingClientRect();b.css({width:t.width+R.right+R.left,height:t.height+R.top+R.bottom,"max-width":I.width()-T.right-T.left,"max-height":I.height()-T.top-T.bottom}),""!=P.sentence&&(b.css("max-height",I.height()-T.top-T.bottom-2*z[0].getBoundingClientRect().height),z.css("max-width",b[0].getBoundingClientRect().width))}function u(t){errorContainer.children("p").html(t).parent().fadeIn(250),P.normalView&&(w.hide(),g.children(".tv-show-fs").prop("disabled",!0).hide()),P.fsView&&b.hide()}function f(){errorContainer.hide(),b.show(),P.normalView&&g.children(".tv-show-fs").prop("disabled",!1).show()}function v(e){return t(t.map(e,function(t){return t.get()}))}var m,g,b,w,y,C,x,$,k,z,S,V,O={normalView:!0,nvFontSize:12,fsView:!0,fsFontSize:14,sentence:"",initFSOnClick:!1,extendedPOS:!1},P=t.extend({},O,a),F=this,I=t(window),X=t("body"),T={top:84,right:36,bottom:48,left:36},R={top:12,right:12,bottom:12,left:12};P.normalView||P.fsView?(F.children(".tree-visualizer, .tree-visualizer-fs").remove(),n(),i(e)):console.error("Cannot initialize Tree Visualizer: either the container does not exist, or you have set both normal and fullscreen view to false, which does not make sense."),P.initFSOnClick||F.find(".tv-show-fs").click(function(e){t(this);$.css("top","-100%").children("ul").empty(),"undefined"!=typeof w&&w.find("a").removeClass("hovered"),m.fadeIn(250,function(){S=null,p()}),e.preventDefault()}),x.add(I).scroll(function(){c()}),m.click(function(e){var a=t(e.target);a.closest(".tv-error, .tree, .tooltip, .zoom-opts-wrapper, .sentence").length||(m.fadeOut(250,function(){b.find("a").removeClass("hovered"),f()}),P.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search))}),k.find("button").click(function(){var e=t(this);if(e.is(".close"))m.fadeOut(250,function(){b.find("a").removeClass("hovered"),f()}),P.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search);else{clearTimeout(V),d(e.attr("class").match(/\b(zoom-[^\s]+)\b/)[0]),h();var a=b.find("a.hovered").css("transition-duration")||200;a=String(a).indexOf("ms")>-1?parseFloat(a):1e3*parseFloat(a),a+=50,V=setTimeout(function(){c(!0)},a)}}),P.fsView&&I.on("resize",t.debounce(250,function(){b.is(":visible")&&h()})),x.on("click","a",function(e){if(!t(this).hasClass("ignored")){var a,n=t(this),i=n.parent("li"),o=i.data(),s=n.closest(".tree"),l=s.find("a"),r=s.next(".tooltip").children("ul");r.empty(),l.removeClass("hovered"),n.addClass("hovered");for(a in o)o.hasOwnProperty(a)&&t("<li>",{html:"<strong>"+a+"</strong>: "+o[a]}).prependTo(r);c()}e.preventDefault()}),x.on("mouseout","a.hovered",function(){var e=t(this);e.closest(".tree").hasClass("small")&&e.on("transitionend",function(){c(!0)})}),$.find("button").click(function(){var e=t(this),a=e.parent(".tooltip"),n=a.prev(".tree"),i=n.find("a");a.fadeOut(250),i.removeClass("hovered")})}}(jQuery);
