!function(t){t.fn.treeVisualizer=function(e,n){function a(){var t=[],n=[],a=[];k.normalView&&(g=P.children("#tree-visualizer"),C=g.find(".tv-tree"),C.css("fontSize",k.nvFontSize),S=C.children(".tv-tooltip"),a.push(g),t.push(C),n.push(S)),m=P.children("#tree-visualizer-fs"),w=m.find(".tv-tree"),w.css("fontSize",k.fsFontSize),w.find(".tv-zoom-wrapper > a").attr("href",e),b=w.children(".tv-tooltip"),y=m.find(".tv-zoom-opts"),a.push(m),t.push(w),n.push(b),""!=k.sentence&&w.find(".tv-sentence-wrapper").addClass("has-sentence").children("span").text(decodeURI(k.sentence)),z=v(t),x=v(n),anyView=v(a),errorContainer=anyView.children(".tv-error")}function i(e){N.removeClass("tv-active, tv-success, tv-fail"),t.ajax({type:"GET",url:e,dataType:"xml",cache:!1}).done(function(t){N.addClass("tv-success"),null==t?f("Your XML appears to be empty or not in a compatible format."):o(t)}).fail(function(t,e,n){N.addClass("tv-fail");var a="";0===t.status?a="Not connected to the Internet.<br>Verify your network connection.":404==t.status?a="Requested XML file not found.<br>Try again with another query.":500==t.status?a="Internal Server Error.<br>If the problem persists, contact us.":(a="Something went wrong.<br>Please try again at another time.<br>",a+=t.status+" "+e+" "+n),f(a)}).always(function(){k.normalView&&N.addClass("tv-active"),k.initFSOnClick&&(t(".loading-wrapper.tv").removeClass("active"),m.fadeIn(250,function(){I=null,c()}))})}function o(e){var n=t(e);u(),z.prepend(s(n.find("node").first())),x.children("ul").empty(),d()}function s(e){var n=t("<ol/>");return e.each(function(e,a){for(var i=t('<li><a href="#"></a></li>'),o=0,d=a.attributes.length,r=null;d>o;o++)r=a.attributes[o],"highlight"==r.nodeName?i.addClass("highlight"):"not"==r.nodeName?i.addClass("excluded"):"begin"!=r.nodeName&&"end"!=r.nodeName&&i.attr("data-"+r.nodeName,r.value.replace(/^\s(.+)/,"$1"));t(this).children("node").length&&i.append(s(t(this).children("node"))),n.append(i)}),n}function d(){z.find("a").each(function(){var e=t(this),n=e.parent("li");if(N.hasClass("matrix")&&n.data("word")&&(n.data("caseinsensitive")?(n.data("word",n.data("word").toLowerCase()),n.data("lemma",n.data("lemma").toLowerCase())):e.addClass("cs")),n.data("rel")&&(e.append("<span class='rel'>"+n.data("rel")+"</span>"),n.data("index")&&e.append("<span class='index'>"+n.data("index")+"</span>")),n.data("postag")&&k.extendedPOS?e.append("<span class='postag'>"+n.data("postag")+"</span>"):n.data("pt")?n.data("index")?e.children("span:last-child").append(":"+n.data("pt")):e.append("<span class='pt'>"+n.data("pt")+"</span>"):n.data("cat")&&(" "==n.data("cat")?(n.removeAttr("data-cat"),n.removeData("cat"),e.addClass("ignored").text("?").attr("title","Top node's properties will be ignored")):n.data("index")?e.children("span:last-child").append(":"+n.data("cat")):e.append("<span class='cat'>"+n.data("cat")+"</span>")),e.is(":only-child")){if(n.data("lemma")&&n.append("<span class='lemma'>"+n.data("lemma")+"</span>"),n.data("word")){var a=N.hasClass("matrix")&&!n.data("caseinsensitive")?' title="Case sensitive word"':"";n.append("<span class='word'><em"+a+">"+n.data("word")+"</em></span>")}e.addClass("only-child")}n.data("caseinsensitive")&&(n.removeAttr("data-caseinsensitive"),n.removeData("caseinsensitive"))}),z.find("li:only-child").addClass("only-child"),z.find("li:first-child").addClass("first-child"),z.find("li:last-child").addClass("last-child")}function r(){var t=parseInt(w.css("fontSize"),10);4>=t?(y.find("button.zoom-out").prop("disabled",!0),w.css("fontSize","4px")):t>=20?y.find("button.zoom-in").prop("disabled",!0):(y.find("button").prop("disabled",!1),w.removeClass("small x-small")),8>=t&&(w.addClass("small"),4>=t&&w.addClass("x-small"))}function l(t){if("zoom-default"==t){var e=P.find(".tv-fs-toggled");e.length&&e.data("tv-fontsize")>0?w.css("fontSize",e.data("tv-fontsize")+"px"):(I=null,c())}else{var n=parseInt(w.css("fontSize"),10);"zoom-in"==t?w.css("fontSize",n+2+"px"):"zoom-out"==t&&w.css("fontSize",n-2+"px")}r()}function c(){h();var t=parseInt(w.css("fontSize"),10),e=w[0];(e.scrollHeight>w.outerHeight()||e.scrollWidth>w.outerWidth())&&t>4?(null==I&&(I="large"),w.css("fontSize",t-1+"px"),h(),"large"==I&&c()):"large"!=I&&(null==I&&(I="small"),w.css("fontSize",t+1+"px"),h(),c()),P.find(".tv-fs-toggled").attr("data-tv-fontsize",parseInt(w.css("fontSize"),10)),r()}function p(t){var e;if("undefined"!=typeof w&&w.is(":visible")?e=w:"undefined"!=typeof C&&C.is(":visible")&&(e=C),"undefined"!=typeof e){var n=e.find("a.hovered");if(n.length){var a=e.next(".tv-tooltip"),i=n[0].getBoundingClientRect(),o=e[0].getBoundingClientRect(),s={top:i.top,right:i.left+o.width,bottom:i.top+o.height,left:i.left,w:i.width,h:i.height},d={top:o.top,right:o.left+o.width,bottom:o.top+o.height,left:o.left,w:o.width,h:o.height};t?a.stop(!0).animate({left:parseInt(s.left+s.w/2-a.outerWidth()/2+7.5,10),top:parseInt(s.top-a.outerHeight()-24,10)},250):a.css({left:parseInt(s.left+s.w/2-a.outerWidth()/2+7.5,10),top:parseInt(s.top-a.outerHeight()-24,10)}),s.left+s.w/2<d.left||s.right+s.w/2<d.right||s.top+s.h/2<d.top||s.bottom+s.h<d.bottom?a.fadeOut(400):a.fadeIn(250)}}}function h(){var t=w.children("ol")[0].getBoundingClientRect();w.css({width:t.width+FSTreePadding.right+FSTreePadding.left,height:t.height+FSTreePadding.top+FSTreePadding.bottom,"max-width":V.width()-FSPadding.right-FSPadding.left,"max-height":V.height()-FSPadding.top-FSPadding.bottom}),k.tv-sentence!=""&&(w.css("max-height",V.height()-FSPadding.top-FSPadding.bottom-2*F[0].getBoundingClientRect().height),F.css("max-width",w[0].getBoundingClientRect().width))}function f(t){errorContainer.children("p").html(t).parent().fadeIn(250),k.normalView&&(C.hide(),g.children(".tv-show-fs").prop("disabled",!0).hide()),w.hide()}function u(){errorContainer.hide(),w.show(),k.normalView&&g.children(".tv-show-fs").prop("disabled",!1).show()}function v(e){return t(t.map(e,function(t){return t.get()}))}var m,g,w,C,b,S,z,x,y,F,I,T,O={normalView:!0,nvFontSize:12,fsFontSize:14,sentence:"",initFSOnClick:!1,extendedPOS:!1,pathToHTML:""},k=t.extend({},O,n),P=this,V=t(window),N=t("body");a(),i(e),k.initFSOnClick||P.find(".tv-show-fs").click(function(t){x.css("top","-100%").children("ul").empty(),"undefined"!=typeof C&&C.find("a").removeClass("hovered"),N.addClass("tv-fs-open"),m.fadeIn(250,function(){I=null,c()}),t.preventDefault()}),z.add(V).scroll(function(){p()}),m.click(function(e){var n=t(e.target);!n.tv-closest(".tv-error, .tv-tree, .tv-tooltip, .tv-zoom-wrapper, .tv-sentence").length&&(N.removeClass("tv-fs-open"),m.fadeOut(250,function(){w.find("a").removeClass("hovered"),u()}),k.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search))}),y.find("button").click(function(){var e=t(this);if(e.is(".tv-close"))m.fadeOut(250,function(){w.find("a").removeClass("hovered"),u()}),k.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search);else{clearTimeout(T),l(e.attr("class").match(/\b(zoom-[^\s]+)\b/)[0]),h();var n=w.find("a.hovered").css("transition-duration")||200;n=String(n).indexOf("ms")>-1?parseFloat(n):1e3*parseFloat(n),n+=50,T=setTimeout(function(){p(!0)},n)}}),V.on("resize",t.debounce(250,function(){w.is(":visible")&&h()})),z.on("click","a",function(e){if(!t(this).hasClass("ignored")){var n,a=t(this),i=a.parent("li").data(),o=a.tv-closest(".tv-tree"),s=o.next(".tv-tooltip").children("ul");s.empty(),o.find("a").removeClass("hovered"),a.addClass("hovered");for(n in i)i.hasOwnProperty(n)&&t("<li>",{html:"<strong>"+n+"</strong>: "+i[n]}).prependTo(s);p()}e.preventDefault()}),z.on("mouseout","a.hovered",function(){t(this).tv-closest(".tv-tree").hasClass("small")&&t(this).on("transitionend",function(){p(!0)})}),x.find("button").click(function(){var e=t(this).parent(".tv-tooltip");e.fadeOut(250),e.prev(".tv-tree").find("a").removeClass("hovered")})}}(jQuery);
