!function(t){t.fn.treeVisualizer=function(e,a){function n(){O.initFSOnClick||P.find(".tv-show-fs").on("click",function(t){k.css("top","-100%").children("ul").empty(),"undefined"!=typeof y&&y.find("a").removeClass("hovered"),T.addClass("tv-fs-open"),b.fadeIn(250,function(){b.children("ol").is("[data-tv-fontsize]")||h()}),t.preventDefault()}),x.on("scroll",function(){u()}),b.on("click",function(e){var a=t(e.target);a.closest(".tv-error, .tv-content-wrapper").length||(T.removeClass("tv-fs-open"),b.fadeOut(250,function(){w.find("a").removeClass("hovered"),v()}),O.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search))}),S.find("button").on("click",function(){var e=t(this);if(e.is(".tv-close-fs"))T.removeClass("tv-fs-open"),b.fadeOut(250,function(){w.find("a").removeClass("hovered"),v()}),O.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search);else{clearTimeout(z),c(e.attr("class").match(/\b(zoom-[^\s]+)\b/)[0]);var a=w.find("a.hovered").css("transition-duration")||200;a=String(a).indexOf("ms")>-1?parseFloat(a):1e3*parseFloat(a),a+=50,z=setTimeout(function(){u(!0)},a)}}),b.find(".tv-navigation-wrapper button").on("click",function(){var e=b.attr("data-tv-active-index"),a=t(".results-ajax-wrapper tbody:not(.empty)");w.find("a").removeClass("hovered"),C.hide(),t(this).is(".tv-prev-tree")?e>0&&e--:e<a.find("tr").length-1&&e++,i(),a.find("tr").eq(e).find("a").click()}),x.on("click","a",function(e){if(!t(this).hasClass("ignored")){var a,n=t(this),i=n.parent("li").data(),o=n.closest(".tv-tree"),s=o.next(".tv-tooltip").children("ul");s.empty(),o.find("a").removeClass("hovered"),n.addClass("hovered");for(a in i)i.hasOwnProperty(a)&&t("<li>",{html:"<strong>"+a+"</strong>: "+i[a]}).prependTo(s);u()}e.preventDefault()}),x.on("mouseout","a.hovered",function(){t(this).closest(".tv-tree").hasClass("small")&&t(this).on("transitionend",function(){u(!0)})}),k.children("button").on("click",function(){var e=t(this).parent(".tv-tooltip");e.fadeOut(250),e.prev(".tv-tree").find("a").removeClass("hovered")})}function i(){b.find(".tv-navigation-wrapper button").prop("disabled",!1);var e=b.attr("data-tv-active-index");e<=0?b.find(".tv-navigation-wrapper .tv-prev-tree").prop("disabled",!0):e>=t(".results-ajax-wrapper tbody:not(.empty)").find("tr").length-1&&b.find(".tv-navigation-wrapper .tv-next-tree").prop("disabled",!0)}function o(){var t=[],a=[],i=[];O.normalView&&(g=P.children("#tree-visualizer"),y=g.find(".tv-tree"),$=y.next(".tv-tooltip"),i.push(g),t.push(y),a.push($)),b=P.children("#tree-visualizer-fs"),w=b.find(".tv-tree"),C=w.next(".tv-tooltip"),S=b.find(".tv-zoom-opts"),S.prev("a").attr("href",e),i.push(b),t.push(w),a.push(C),x=m(t),k=m(a),anyView=m(i),errorContainer=anyView.children(".tv-error"),""!=O.sentence&&anyView.find(".tv-sentence-wrapper").addClass("has-sentence").children("span").html(O.sentence),O.hasNavigation||b.find(".tv-navigation-wrapper").hide(),anyView.find("*").off(),n()}function s(e){T.addClass("tv-is-loading"),O.initFSOnClick&&T.addClass("tv-fs-open");var a=++N;t.ajax({type:"GET",url:e,dataType:"xml",cache:!1}).done(function(t){null==t||void 0==t?(T.addClass("tv-fail").removeClass("tv-success"),f("Your XML appears to be empty or not in a compatible format.")):(T.addClass("tv-success").removeClass("tv-fail"),a==N&&r(t))}).fail(function(t,e,a){T.addClass("tv-fail").removeClass("tv-success");var n="";0===t.status?n="Not connected to the Internet.<br>Verify your network connection.":404==t.status?n="Requested XML file not found.<br>Try again with another query.":500==t.status?n="Internal Server Error.<br>If the problem persists, contact us.":(n="Something went wrong.<br>Please try again at another time.<br>",n+=t.status+" "+e+" "+a),f(n)}).always(function(){a==N&&T.removeClass("tv-is-loading"),T.hasClass("tv-fail")?t(".continue-btn-wrapper [type='submit']").prop("disabled",!0):t(".continue-btn-wrapper [type='submit']").prop("disabled",!1),O.normalView&&T.addClass("tv-ns-open"),O.initFSOnClick&&b.fadeIn(250,function(){h()})})}function r(e){var a=t(e);v(),x.html(l(a.find("node").first())),k.children("ul").empty(),d()}function l(e){var a=t("<ol/>");return e.each(function(e,n){for(var i=t('<li><a href="#"></a></li>'),o=0,s=n.attributes.length,r=null;o<s;o++)r=n.attributes[o],"highlight"==r.nodeName?i.addClass("highlight"):"not"==r.nodeName?i.addClass("excluded"):"begin"!=r.nodeName&&"end"!=r.nodeName&&i.attr("data-"+r.nodeName,r.value.replace(/^\s(.+)/,"$1"));t(this).children("node").length&&i.append(l(t(this).children("node"))),a.append(i)}),a}function d(){x.find("a").each(function(){var e=t(this),a=e.parent("li");if(T.hasClass("matrix")&&a.data("word")&&(a.data("caseinsensitive")?(a.data("word",a.data("word").toLowerCase()),a.data("lemma",a.data("lemma").toLowerCase())):e.addClass("cs")),a.data("rel")&&(e.append("<span class='rel'>"+a.data("rel")+"</span>"),a.data("index")&&e.append("<span class='index'>"+a.data("index")+"</span>")),a.data("postag")&&O.extendedPOS?e.append("<span class='postag'>"+a.data("postag")+"</span>"):a.data("pt")?a.data("index")?e.children("span:last-child").append(":"+a.data("pt")):e.append("<span class='pt'>"+a.data("pt")+"</span>"):a.data("cat")&&(" "==a.data("cat")?(a.removeAttr("data-cat"),a.removeData("cat"),e.addClass("ignored").text("?").attr("title","Top node's properties will be ignored")):a.data("index")?e.children("span:last-child").append(":"+a.data("cat")):e.append("<span class='cat'>"+a.data("cat")+"</span>")),e.is(":only-child")){if(a.data("lemma")&&a.append("<span class='lemma'>"+a.data("lemma")+"</span>"),a.data("word")){var n=T.hasClass("matrix")&&!a.data("caseinsensitive")?' title="Case sensitive word"':"";a.append("<span class='word'><em"+n+">"+a.data("word")+"</em></span>")}e.addClass("only-child")}a.data("caseinsensitive")&&(a.removeAttr("data-caseinsensitive"),a.removeData("caseinsensitive"))}),x.find("li:only-child").addClass("only-child"),x.find("li:first-child").addClass("first-child"),x.find("li:last-child").addClass("last-child")}function p(){var t=parseInt(w.children("ol").css("fontSize"),10),e=w.children("ol").attr("data-tv-fontsize");S.find("button").prop("disabled",!1),w.removeClass("tv-small tv-x-small"),t<=4?(S.find("button.tv-zoom-out").prop("disabled",!0),w.children("ol").css("fontSize","4px")):t>=16&&S.find("button.tv-zoom-in").prop("disabled",!0),t==e&&S.find("button.tv-zoom-default").prop("disabled",!0),t<=8&&(w.addClass("tv-small"),t<=4&&w.addClass("tv-x-small"))}function c(t){if("zoom-default"==t)w.children("ol").is("[data-tv-fontsize]")?w.children("ol").css("fontSize",w.children("ol").attr("data-tv-fontsize")+"px"):h();else{var e=parseInt(w.children("ol").css("fontSize"),10);"zoom-in"==t?w.children("ol").css("fontSize",e+2+"px"):"zoom-out"==t&&w.children("ol").css("fontSize",e-2+"px")}p()}function h(){for(var t=parseInt(w.children("ol").css("fontSize"),10),e=w[0];t>4&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth);)t--,w.children("ol").css("fontSize",t+"px");for(;t<16&&e.scrollHeight<=e.clientHeight&&e.scrollWidth<=e.clientWidth;)if(t++,w.children("ol").css("fontSize",t+"px"),e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth){t--,w.children("ol").css("fontSize",t+"px");break}w.children("ol").attr("data-tv-fontsize",t),p()}function u(t){var e;if("undefined"!=typeof w&&T.hasClass("tv-fs-open")?e=w:"undefined"!=typeof y&&T.hasClass("tv-ns-open")&&(e=y),"undefined"!=typeof e){var a=e.find("a.hovered");if(a.length){var n=e.next(".tv-tooltip"),i=a[0].getBoundingClientRect(),o=e[0].getBoundingClientRect(),s={right:I.outerWidth()-i.right,bottom:I.outerHeight()-i.bottom},r={right:I.outerWidth()-o.right,bottom:I.outerHeight()-o.bottom},l={left:parseInt(i.left+i.width/2-n.outerWidth()/2+8,10)+"px",top:parseInt(i.top-n.outerHeight()-24,10)};t?n.stop(!0).animate({left:l.left,top:l.top},250):n.css({left:l.left,top:l.top}),i.left+i.width/2<o.left||s.right+i.width/2<r.right||i.top+i.height/2<o.top||s.bottom+i.height<r.bottom?n.fadeOut(400):n.fadeIn(250)}}}function f(t){errorContainer.children("p").html(t),O.normalView&&g.children(".tv-show-fs").prop("disabled",!0)}function v(){O.normalView&&g.children(".tv-show-fs").prop("disabled",!1)}function m(e){return t(t.map(e,function(t){return t.get()}))}var b,g,w,y,C,$,x,k,S,z,V={normalView:!0,sentence:"",initFSOnClick:!1,extendedPOS:!1,hasNavigation:!1},O=t.extend({},V,a),P=this,I=t(window),T=t("body"),N=0;o(),s(e),i(),I.on("scroll",function(){u()})}}(jQuery);