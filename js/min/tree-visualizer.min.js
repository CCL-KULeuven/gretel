!function(t){t.fn.treeVisualizer=function(e,a){function n(){var t=[],a=[],n=[];if($.normalView){F.append('<div class="tree-visualizer"></div>'),g=F.children(".tree-visualizer");var i='<div class="tv-error" style="display: none"><p></p></div><div class="tree" style="font-size: '+$.nvFontSize+'px;"></div><aside class="tooltip" style="display: none"><ul></ul><button title="Close this tooltip" type="button"><i class="fa fa-fw fa-times loaded"></i><span class="sr-only">Close this tooltip</span></button></aside>';$.fsView&&(i+='<button class="tv-show-fs" title="Open the tree in full screen mode" type="button"><i class="fa fa-fw fa-arrows-alt loaded"></i><span class="sr-only">Open the tree in fullscreen mode</span></button>'),g.append(i),b=g.children(".tree"),C=g.children(".tooltip"),n.push(g),t.push(b),a.push(C)}if($.fsView){F.append('<div class="tree-visualizer-fs" style="display: none"></div>'),v=F.children(".tree-visualizer-fs");var s="";$.normalView||(s+='<div class="tv-error" style="display: none"><p></p></div>'),s+='<div class="tree" style="font-size: '+$.fsFontSize+'px;"></div><aside class="tooltip" style="display: none"><ul></ul><button title="Close this tooltip" type="button"><i class="fa fa-fw fa-times loaded"></i><span class="sr-only">Close this tooltip</span></button></aside><div class="zoom-opts-wrapper"><a href="'+e+'" target="_blank" title="Show XML">Show XML</a><div class="zoom-opts"><button class="zoom-out" type="button"><i class="fa fa-fw fa-search-minus loaded" aria-hidden="true"></i></button><button class="zoom-default" type="button">Default</button><button class="zoom-in" type="button"><i class="fa fa-fw fa-search-plus loaded" aria-hidden="true"></i></button><button title="Close fullscreen mode" type="button" class="close"><i class="fa fa-fw fa-times loaded"></i><span class="sr-only">Closen fullscreen mode</span></button></div></div>',v.append(s),w=v.children(".tree"),y=v.children(".tooltip"),S=v.find(".zoom-opts"),""!=$.sentence&&(w.before('<div class="sentence">'+decodeURI($.sentence)+"</div>"),k=v.children(".sentence")),n.push(v),t.push(w),a.push(y),v.css({"padding-top":N.top,"padding-right":N.right,"padding-bottom":N.bottom,"padding-left":N.left}),w.css({"padding-top":L.top,"padding-right":L.right,"padding-bottom":L.bottom,"padding-left":L.left})}z=m(t),x=m(a),anyView=m(n),errorContainer=anyView.children(".tv-error")}function i(e){t.ajax({type:"GET",url:e,dataType:"xml",cache:!1}).done(function(t){null==t?f("Your XML appears to be empty or not in a compatible format."):s(t)}).fail(function(t,e,a){var n="";0===t.status?n="Not connected to the Internet.<br>Verify your network connection.":404==t.status?n="Requested XML file not found.<br>Try again with another query.":500==t.status?n="Internal Server Error.<br>If the problem persists, contact us.":(n="Uncaught Error.<br>Please try again at another time.<br>",n+=t.status+" "+e+" "+a),f(n)}).always(function(){$.normalView&&F.addClass("active"),$.initFSOnClick&&(t(".loading-wrapper.tv").removeClass("active"),v.fadeIn(250,function(){V=null,c()}))})}function s(e){var a=t(e);u(),z.html(o(a.find("node").first())),x.children("ul").empty(),l()}function o(e){var a=t("<ol/>");return e.each(function(e,n){for(var i=t('<li><a href="#"></a></li>'),s=0,l=n.attributes.length,r=null;l>s;s++)r=n.attributes[s],"highlight"==r.nodeName?i.addClass("highlight"):"not"==r.nodeName?i.addClass("excluded"):"begin"!=r.nodeName&&"end"!=r.nodeName&&i.attr("data-"+r.nodeName,r.value.replace(/^\s(.+)/,"$1"));t(this).children("node").length&&i.append(o(t(this).children("node"))),a.append(i)}),a}function l(){z.find("a").each(function(){var e=t(this),a=e.parent("li");if(R.hasClass("matrix")&&a.data("word")&&(a.data("caseinsensitive")?(a.data("word",a.data("word").toLowerCase()),a.data("lemma",a.data("lemma").toLowerCase())):e.addClass("cs")),a.data("rel")&&(e.append("<span class='rel'>"+a.data("rel")+"</span>"),a.data("index")&&e.append("<span class='index'>"+a.data("index")+"</span>")),a.data("postag")&&$.extendedPOS?e.append("<span class='postag'>"+a.data("postag")+"</span>"):a.data("pt")?a.data("index")?e.children("span:last-child").append(":"+a.data("pt")):e.append("<span class='pt'>"+a.data("pt")+"</span>"):a.data("cat")&&(" "==a.data("cat")?(a.removeAttr("data-cat"),a.removeData("cat"),e.addClass("ignored").text("?").attr("title","Top node's properties will be ignored")):a.data("index")?e.children("span:last-child").append(":"+a.data("cat")):e.append("<span class='cat'>"+a.data("cat")+"</span>")),e.is(":only-child")){if(a.data("lemma")&&a.append("<span class='lemma'>"+a.data("lemma")+"</span>"),a.data("word")){var n=R.hasClass("matrix")&&!a.data("caseinsensitive")?' title="Case sensitive word"':"";a.append("<span class='word'><em"+n+">"+a.data("word")+"</em></span>")}e.addClass("only-child")}a.data("caseinsensitive")&&(a.removeAttr("data-caseinsensitive"),a.removeData("caseinsensitive"))}),z.find("li:only-child").addClass("only-child"),z.find("li:first-child").addClass("first-child"),z.find("li:last-child").addClass("last-child")}function r(){var t=parseInt(w.css("fontSize"),10);4>=t?(S.find("button.zoom-out").prop("disabled",!0),w.css("fontSize","4px")):t>=20?S.find("button.zoom-in").prop("disabled",!0):(S.find("button").prop("disabled",!1),w.removeClass("small x-small")),8>=t&&(w.addClass("small"),4>=t&&w.addClass("x-small"))}function d(t){if("zoom-default"==t){var e=F.find(".tv-fs-toggled");e.length&&e.data("tv-fontsize")>0?w.css("fontSize",e.data("tv-fontsize")+"px"):(V=null,c())}else{var a=parseInt(w.css("fontSize"),10);"zoom-in"==t?w.css("fontSize",a+2+"px"):"zoom-out"==t&&w.css("fontSize",a-2+"px")}r()}function c(){h();var t=parseInt(w.css("fontSize"),10),e=w[0],a=e.scrollWidth,n=e.scrollHeight,i=w.outerWidth(),s=w.outerHeight();(n>s||a>i)&&t>4?(null==V&&(V="large"),w.css("fontSize",t-1+"px"),h(),"large"==V&&c()):"large"!=V&&(null==V&&(V="small"),w.css("fontSize",t+1+"px"),h(),c()),F.find(".tv-fs-toggled").attr("data-tv-fontsize",parseInt(w.css("fontSize"),10)),r()}function p(t){var e;if("undefined"!=typeof w&&w.is(":visible")?e=w:"undefined"!=typeof b&&b.is(":visible")&&(e=b),"undefined"!=typeof e){var a=e.find("a.hovered");if(a.length){var n=e.next(".tooltip"),i=a[0].getBoundingClientRect(),s=e[0].getBoundingClientRect(),o={top:i.top,right:i.left+s.width,bottom:i.top+s.height,left:i.left,w:i.width,h:i.height},l={top:s.top,right:s.left+s.width,bottom:s.top+s.height,left:s.left,w:s.width,h:s.height};t?n.stop(!0).animate({left:parseInt(o.left+o.w/2-n.outerWidth()/2+7.5,10),top:parseInt(o.top-n.outerHeight()-24,10)},250):n.css({left:parseInt(o.left+o.w/2-n.outerWidth()/2+7.5,10),top:parseInt(o.top-n.outerHeight()-24,10)}),o.left+o.w/2<l.left||o.right+o.w/2<l.right||o.top+o.h/2<l.top||o.bottom+o.h<l.bottom?n.fadeOut(400):n.fadeIn(250)}}}function h(){var t=w.children("ol")[0].getBoundingClientRect();w.css({width:t.width+L.right+L.left,height:t.height+L.top+L.bottom,"max-width":T.width()-N.right-N.left,"max-height":T.height()-N.top-N.bottom}),""!=$.sentence&&(w.css("max-height",T.height()-N.top-N.bottom-2*k[0].getBoundingClientRect().height),k.css("max-width",w[0].getBoundingClientRect().width))}function f(t){errorContainer.children("p").html(t).parent().fadeIn(250),$.normalView&&(b.hide(),g.children(".tv-show-fs").prop("disabled",!0).hide()),$.fsView&&w.hide()}function u(){errorContainer.hide(),w.show(),$.normalView&&g.children(".tv-show-fs").prop("disabled",!1).show()}function m(e){return t(t.map(e,function(t){return t.get()}))}var v,g,w,b,y,C,z,x,S,k,V,I,O={normalView:!0,nvFontSize:12,fsView:!0,fsFontSize:14,sentence:"",initFSOnClick:!1,extendedPOS:!1},$=t.extend({},O,a),F=this,T=t(window),R=t("body"),N={top:84,right:36,bottom:48,left:36},L={top:12,right:12,bottom:12,left:12};$.normalView||$.fsView?(F.children(".tree-visualizer, .tree-visualizer-fs").remove(),n(),i(e)):console.error("Cannot initialize Tree Visualizer: either the container does not exist, or you have set both normal and fullscreen view to false, which does not make sense."),$.initFSOnClick||F.find(".tv-show-fs").click(function(e){t(this);x.css("top","-100%").children("ul").empty(),"undefined"!=typeof b&&b.find("a").removeClass("hovered"),v.fadeIn(250,function(){V=null,c()}),e.preventDefault()}),z.add(T).scroll(function(){p()}),v.click(function(e){var a=t(e.target);a.closest(".tv-error, .tree, .tooltip, .zoom-opts-wrapper, .sentence").length||(v.fadeOut(250,function(){w.find("a").removeClass("hovered"),u()}),$.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search))}),S.find("button").click(function(){var e=t(this);if(e.is(".close"))v.fadeOut(250,function(){w.find("a").removeClass("hovered"),u()}),$.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search);else{clearTimeout(I),d(e.attr("class").match(/\b(zoom-[^\s]+)\b/)[0]),h();var a=w.find("a.hovered").css("transition-duration")||200;a=String(a).indexOf("ms")>-1?parseFloat(a):1e3*parseFloat(a),a+=50,I=setTimeout(function(){p(!0)},a)}}),$.fsView&&T.on("resize",t.debounce(250,function(){w.is(":visible")&&h()})),z.on("click","a",function(e){if(!t(this).hasClass("ignored")){var a,n=t(this),i=n.parent("li"),s=i.data(),o=n.closest(".tree"),l=o.find("a"),r=o.next(".tooltip").children("ul");r.empty(),l.removeClass("hovered"),n.addClass("hovered");for(a in s)s.hasOwnProperty(a)&&t("<li>",{html:"<strong>"+a+"</strong>: "+s[a]}).prependTo(r);p()}e.preventDefault()}),z.on("mouseout","a.hovered",function(){var e=t(this);e.closest(".tree").hasClass("small")&&e.on("transitionend",function(){p(!0)})}),x.find("button").click(function(){var e=t(this),a=e.parent(".tooltip"),n=a.prev(".tree"),i=n.find("a");a.fadeOut(250),i.removeClass("hovered")})}}(jQuery);
