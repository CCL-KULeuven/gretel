$(function(){function t(){!P&&S<=phpVars.resultsLimit&&($(".loading-wrapper.searching").addClass("active"),f=$.ajax(phpVars.fetchResultsPath).done(function(t){if(!P){var e=$.parseJSON(t);!e.error&&e.data?(C.find("tbody.empty").hide(),d(e.data,!1)):($(".loading-wrapper.searching").removeClass("active"),V.closest(".results-messages-wrapper").addClass("active"),x.addClass("active"),e.error?r(e.data):0==C.find("tbody:not(.empty)").children().length?s():o(),clearTimeout(A),P=!0,p&&p.abort())}}).fail(function(t,e,n){if("abort"!=n){var a="An error occurred";""!=n&&(a+=": "+n+"."),r(a)}}).always(function(){S!=v||P||e()}))}function e(){p||(clearTimeout(A),p=$.ajax(phpVars.getAllResultsPath).done(function(t){var e=$.parseJSON(t);!e.error&&e.data?(C.find("tbody.empty").hide(),d(e.data,!0)):($(".loading-wrapper.searching").removeClass("active"),V.children("div").removeClass("error notice").closest(".results-messages-wrapper").show(),x.addClass("active"),e.error?r(e.data):0==C.find("tbody:not(.empty)").children().length&&s())}).fail(function(t,e,n){if("abort"!=n){var a="An error occurred: "+n+".";r(a)}}).always(function(){P=!0,f&&f.abort()}))}function n(){h=$.ajax(phpVars.fetchCountsPath).done(function(t){var e=$.parseJSON(t),n=e[0],o=e[1];if(O=n,n=a(parseInt(n)),y.find(".count strong + span").text(n),V.find(".amount-hits").text(n),V.find(".is-still-counting").remove(),O>0){var s=Object.keys(o).length;if("undefined"!=typeof o&&s>0){var r=0,i=0;for(var d in o){var l=d.split("_")[2],c=a(parseInt(o[d][0])),p=a(parseInt(o[d][1]));r+=parseInt(o[d][0]),i+=parseInt(o[d][1]),x.find(".distribution-wrapper tbody").append("<tr><td>"+l+"</td><td>"+c+"</td><td>"+p+"</td></tr>")}x.find(".distribution-wrapper tbody").append("<tr><th>Total</th><th>"+a(r)+"</th><th>"+a(i)+"</th></tr>"),x.find(".distribution-wrapper").show()}O>phpVars.resultsLimit&&V.find(".is-restricted").show()}}).fail(function(t,e,n){if("abort"!=n){var a="An error occurred: "+n+".";r(a)}}).always(function(){D=!0})}function a(t){return Number.isInteger(t)&&t>999?t.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):t}function o(){l(),V.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php #results-found",function(){D&&(V.find(".amount-hits").html(a(parseInt(O))),V.find(".is-still-counting").remove()),S==phpVars.resultsLimit?n():(countString=y.find(".count strong").text(),y.find(".count strong + span").text(countString),V.find(".amount-hits").text(countString),V.find(".is-still-counting").remove()),V.children("div").removeClass("error").addClass("notice active").closest(".results-messages-wrapper").show(),x.addClass("active"),I.show()})}function s(){C.add(y).remove(),$("#download-overview .flex-content").addClass("no-results"),g.addClass("search-no-results"),V.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php #no-results-found",function(){V.children("div").removeClass("notice").addClass("error active").closest(".results-messages-wrapper").show()})}function r(t){C.add(y).remove(),$("#download-overview .flex-content").addClass("error"),g.addClass("search-error"),V.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php #error",function(){V.find(".error-msg").text(t),V.children("div").removeClass("notice").addClass("error active").closest(".results-messages-wrapper").show()})}function i(){var t=window.location.hash;if(!g.hasClass("tv-fs-open")&&1==t.indexOf("tv-")){var e=t.match(/\d+$/);b.eq(e[0]-1).click()}}function d(e,n){n&&(P=!0,S=0,C.find("tbody:not(.empty)").empty()),$.each(e,function(t,e){if(n||!n&&!P){S++;var a=e[0];a=a.replace(/\bhref=\"([^"]+)\"/,'href="#tv-'+S+'" data-tv-url="$1"'),C.find("tbody:not(.empty)").append('<tr data-result-id="'+S+'" data-component="'+e[2]+'"><td>'+S+"</td><td>"+a+"</td><td>"+e[2]+"</td><td>"+e[1]+"</td></tr>")}T&&i()}),resultIDString=a(parseInt(S)),y.find(".count strong").text(resultIDString),n||P?o():t()}function l(){$("[for='filter-components'], .filter-sel-wrapper label").removeClass("disabled").children("input").prop("disabled",!1),k.find("[type='checkbox'][name='component']").each(function(t,e){var n=$(e),a=n.val();0==C.find("tbody:not(.empty) tr[data-component^='"+a+"']").length&&(n.prop("disabled",!0),n.prop("checked",!1),n.parent("label").addClass("disabled"))})}function c(){p&&p.abort(),h&&h.abort(),f&&f.abort(),P=!0}var p,f,h,u=500,v=4,m=window.location.hash,g=($(window),$("body")),w=$(document),b=$("a.tv-show-fs"),y=$(".controls"),C=$(".results-ajax-wrapper"),k=$(".filter-sel-wrapper"),x=$("#download-overview .flex-content"),V=x.find(".messages"),I=$(".notification-wrapper"),S=0,O=0,P=!1,D=!1,N=0,T=window.location.hash;t();var A=setTimeout(function(){e()},u);w.click(function(t){if(y.find(".filter-wrapper").hasClass("active")){var e=$(t.target);e.closest(".filter-wrapper").length||y.find(".filter-wrapper").removeClass("active")}}),y.find("[for='filter-components']").click(function(){$(this).parent().addClass("active")}),k.find("[type='checkbox']").change(function(){var t=$(this),e=t.val();$("#all-components").prop("indeterminate",!1),t.is("[name='component']")?(t.is(":checked")?C.find("tbody:not(.empty) tr[data-component^='"+e+"']").show():C.find("tbody:not(.empty) tr[data-component^='"+e+"']").hide(),k.find("[name='component']").is(":checked")?(k.find("[name='component']:not(:disabled)").length==k.find("[name='component']:not(:disabled):checked").length?k.find("#all-components").prop("checked",!0).parent().addClass("active"):k.find("#all-components").prop("checked",!1).prop("indeterminate",!0).parent().removeClass("active"),C.find(".empty").hide()):(N=!1,C.find(".empty").css("display","table-row-group").find("td").text("No results matching the specified filters"),k.find("#all-components").prop("checked",!1).parent().removeClass("active"))):t.is("#all-components")&&(t.parent().toggleClass("active"),k.find("[type='checkbox'][name='component']:not(:disabled)").prop("checked",t.is(":checked")).change())}),window.addEventListener("beforeunload",function(){c()}),$(".secondary-navigation a").click(function(){c()}),C.find("tbody").on("click","a.tv-show-fs",function(t){var e=$(this),n=e.parent().nextAll("td:last-child").html(),a=$("#tree-visualizer-fs");C.find("tbody a").removeClass("tv-toggled-link"),this.hasAttribute("data-tv-fontsize")||e.attr("data-tv-fontsize",0),a.attr("data-tv-active-index",e.closest("tr").index()),e.addClass("tv-toggled-link"),g.treeVisualizer(e.data("tv-url"),{normalView:!1,initFSOnClick:!0,sentence:n,hasNavigation:!0}),t.preventDefault()}),m&&1==m.indexOf("tv-")&&V.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php #looking-for-tree",function(){V.children("div").removeClass("error").addClass("notice active").closest(".results-messages-wrapper").show(),x.addClass("active")}),I.find("button").click(function(){I.hide()}),I.find("a").click(function(t){t.preventDefault(),$("html, body").stop().animate({scrollTop:$("#download-overview").offset().top},150),I.fadeOut("fast")}),$("a.collapse").click(function(t){var e=$(this),n="hidden"==e.attr("data-collapse")?!0:!1;n?(e.attr("data-collapse","visible"),e.next("[data-target]").slideDown("fast")):(e.attr("data-collapse","hidden"),e.next("[data-target]").slideUp("fast")),t.preventDefault()}),$("#results-menu a").off("click").click(function(t){$("html, body").stop().animate({scrollTop:$($(this).attr("href")).offset().top},150),t.preventDefault()})});
