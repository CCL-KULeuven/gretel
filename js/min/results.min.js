$(function(){function e(){!O&&I<=phpVars.resultsLimit&&($(".loading-wrapper.searching").addClass("active"),f=$.ajax(phpVars.fetchResultsPath).done(function(e){if(!O){var t=$.parseJSON(e);!t.error&&t.data?(C.find("tbody.empty").hide(),d(t.data,!1)):($(".loading-wrapper.searching").removeClass("active"),x.closest(".results-messages-wrapper").addClass("active"),k.addClass("active"),t.error?o(t.data):0==C.find("tbody:not(.empty)").children().length?r():s(),clearTimeout(A),O=!0,p&&p.abort())}}).fail(function(e,t,n){if("abort"!=n){var a="An error occurred";""!=n&&(a+=": "+n+"."),o(a)}}).always(function(){I!=m||O||t()}))}function t(){p||(clearTimeout(A),p=$.ajax(phpVars.getAllResultsPath).done(function(e){var t=$.parseJSON(e);!t.error&&t.data?(C.find("tbody.empty").hide(),d(t.data,!0)):($(".loading-wrapper.searching").removeClass("active"),x.children("div").removeClass("error notice").closest(".results-messages-wrapper").show(),k.addClass("active"),t.error?o(t.data):0==C.find("tbody:not(.empty)").children().length&&r())}).fail(function(e,t,n){if("abort"!=n){var a="An error occurred: "+n+".";o(a)}}).always(function(){O=!0,f&&f.abort()}))}function n(){u=$.ajax(phpVars.fetchCountsPath).done(function(e){var t=$.parseJSON(e),n=t[0],s=t[1];if(S=n,n=a(parseInt(n)),w.find(".count strong + span").text(n),x.find(".amount-hits").text(n),x.find(".is-still-counting").remove(),b.removeClass("counts-loading"),b.addClass("counts-done"),S>0){var r=Object.keys(s).length;if("undefined"!=typeof s&&r>0){var o=0,i=0;for(var d in s){var l=d.split("_")[2],c=a(parseInt(s[d][0])),p=a(parseInt(s[d][1]));o+=parseInt(s[d][0]),i+=parseInt(s[d][1]),k.find(".distribution-wrapper tbody").append("<tr><td>"+l+"</td><td>"+c+"</td><td>"+p+"</td></tr>")}k.find(".distribution-wrapper tbody").append("<tr><th>Total</th><th>"+a(o)+"</th><th>"+a(i)+"</th></tr>"),k.find(".distribution-wrapper").show()}S>phpVars.resultsLimit&&x.find(".is-restricted").show()}}).fail(function(e,t,n){if("abort"!=n){var a="An error occurred: "+n+".";o(a)}}).always(function(){P=!0})}function a(e){return Number.isInteger(e)&&e>999?e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):e}function s(){l(),b.removeClass("results-loading").addClass("results-done"),x.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php #results-found",function(){P&&(x.find(".amount-hits").html(a(parseInt(S))),x.find(".is-still-counting").remove()),I<phpVars.resultsLimit&&(null!=u&&(u.abort(),u=null),countString=w.find(".count strong").text(),w.find(".count strong + span").text(countString),x.find(".amount-hits").text(countString),x.find(".is-still-counting").remove()),x.children("div").removeClass("error").addClass("notice active").closest(".results-messages-wrapper").show(),k.addClass("active"),V.show()})}function r(){b.removeClass("results-loading").addClass("results-none"),C.add(w).remove(),k.addClass("no-results"),b.addClass("search-no-results"),x.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php #no-results-found",function(){x.children("div").removeClass("notice").addClass("error active").closest(".results-messages-wrapper").show()})}function o(e){b.removeClass("results-loading").addClass("results-failed"),C.add(w).remove(),k.addClass("error"),b.addClass("search-error"),x.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php #error",function(){x.find(".error-msg").text(e),x.children("div").removeClass("notice").addClass("error active").closest(".results-messages-wrapper").show()})}function i(){if(!b.hasClass("tv-fs-open")&&1==v.indexOf("tv-")){var e=v.match(/\d+$/);$("a.tv-show-fs").eq(e[0]-1).click()}}function d(t,n){n&&(O=!0,I=0,C.find("tbody:not(.empty)").empty()),$.each(t,function(e,t){if(n||!n&&!O){I++;var a=t[0];a=a.replace(/\bhref=\"([^"]+)\"/,'href="#tv-'+I+'" data-tv-url="$1"'),C.find("tbody:not(.empty)").append('<tr data-result-id="'+I+'" data-component="'+t[2]+'"><td>'+I+"</td><td>"+a+"</td><td>"+t[2]+"</td><td>"+t[1]+"</td></tr>")}i()}),resultIDString=a(parseInt(I)),w.find(".count strong").text(resultIDString),n||O?s():e()}function l(){$("[for='filter-components'], .filter-sel-wrapper label").removeClass("disabled").children("input").prop("disabled",!1),y.find("[type='checkbox'][name='component']").each(function(e,t){var n=$(t),a=n.val();0==C.find("tbody:not(.empty) tr[data-component^='"+a+"']").length&&(n.prop("disabled",!0),n.prop("checked",!1),n.parent("label").addClass("disabled"))})}function c(){null!=p&&(p.abort(),p=null),null!=u&&(u.abort(),u=null),null!=f&&(f.abort(),f=null),O=!0}var p,f,u,h=500,m=4,v=window.location.hash,g=($(window),$(document)),b=$("body"),w=$(".controls"),C=$(".results-ajax-wrapper"),y=$(".filter-sel-wrapper"),k=$("#download-overview .flex-content"),x=k.find(".messages"),V=$(".notification-wrapper"),I=0,S=0,O=!1,P=!1;e(),n(),b.addClass("results-loading counts-loading");var A=setTimeout(function(){t()},h);v&&1==v.indexOf("tv-")&&x.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php #looking-for-tree",function(){x.children("div").removeClass("error").addClass("notice active").closest(".results-messages-wrapper").show(),k.addClass("active")}),g.click(function(e){if(w.find(".filter-wrapper").hasClass("active")){var t=$(e.target);t.closest(".filter-wrapper").length||w.find(".filter-wrapper").removeClass("active")}}),w.find("[for='filter-components']").click(function(){$(this).parent().addClass("active")}),y.find("[type='checkbox']").change(function(){var e=$(this),t=e.val();$("#all-components").prop("indeterminate",!1),e.is("[name='component']")?(e.is(":checked")?C.find("tbody:not(.empty) tr[data-component^='"+t+"']").show():C.find("tbody:not(.empty) tr[data-component^='"+t+"']").hide(),y.find("[name='component']").is(":checked")?(y.find("[name='component']:not(:disabled)").length==y.find("[name='component']:not(:disabled):checked").length?y.find("#all-components").prop("checked",!0).parent().addClass("active"):y.find("#all-components").prop("checked",!1).prop("indeterminate",!0).parent().removeClass("active"),C.find(".empty").hide()):(C.find(".empty").css("display","table-row-group").find("td").text("No results matching the specified filters"),y.find("#all-components").prop("checked",!1).parent().removeClass("active"))):e.is("#all-components")&&(e.parent().toggleClass("active"),y.find("[type='checkbox'][name='component']:not(:disabled)").prop("checked",e.is(":checked")).change())}),window.addEventListener("beforeunload",function(){c()}),$(".secondary-navigation a").click(function(){c()}),C.find("tbody").on("click","a.tv-show-fs",function(e){var t=$(this),n=t.parent().nextAll("td:last-child").html(),a=$("#tree-visualizer-fs");C.find("tbody a").removeClass("tv-toggled-link"),this.hasAttribute("data-tv-fontsize")||t.attr("data-tv-fontsize",0),a.attr("data-tv-active-index",t.closest("tr").index()),t.addClass("tv-toggled-link"),b.treeVisualizer(t.data("tv-url"),{normalView:!1,initFSOnClick:!0,sentence:n,hasNavigation:!0}),e.preventDefault()}),V.find("button").click(function(){V.hide()}),V.find("a").click(function(e){e.preventDefault(),$("html, body").stop().animate({scrollTop:$("#download-overview").offset().top},150),V.fadeOut("fast")}),$("#results-menu a").off("click").click(function(e){$("html, body").stop().animate({scrollTop:$($(this).attr("href")).offset().top},150),e.preventDefault()})});
