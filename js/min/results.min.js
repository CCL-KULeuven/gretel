$(document).ready(function(){function e(){!V&&w<=phpVars.resultsLimit&&($(".loading-wrapper.searching").addClass("active"),$.ajax(phpVars.fetchResultsPath).done(function(e){if(!V){var t=$.parseJSON(e);g.find("tbody:not(.empty) .added").removeClass("added"),!t.error&&t.data?i(t.data,!1):($(".loading-wrapper.searching").removeClass("active"),g.find("tbody:not(.empty) .added").removeClass("added"),$(".messages").addClass("active").children("div").removeClass("error notice"),t.error?r(t.data):0==g.find("tbody:not(.empty)").children().length?n():(a(),clearTimeout(I)),V=!0,p&&p.abort())}}).fail(function(e,t,o){if("abort"!=o){var a="An error occurred";""!=o&&(a+=": "+o+"."),r(a)}}).always(function(){w!=h||V||t()}))}function t(){p||(p=$.ajax(phpVars.getAllResultsPath).done(function(e){var t=$.parseJSON(e);g.find("tbody:not(.empty) .added").removeClass("added"),!t.error&&t.data?(i(t.data,!0),clearTimeout(I)):($(".loading-wrapper.searching").removeClass("active"),$(".messages").addClass("active").children("div").removeClass("error notice"),t.error?r(t.data):0==g.find("tbody:not(.empty)").children().length&&n())}).fail(function(e,t,o){if("abort"!=o){var a="An error occurred: "+o+".";r(a)}}).always(function(){V=!0}))}function o(e){return Number.isInteger(e)&&e>999?e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):e}function a(){d(),y.load(phpVars.fetchHomePath+"/php/results-messages.php #results-found",function(){x&&(y.find(".amount-hits").html(k),y.find(".is-still-counting").remove()),(k>phpVars.resultsLimit||w==phpVars.resultsLimit)&&y.find(".is-restricted").show(),y.addClass("active").children("div").removeClass("error").addClass("notice active"),y.find(".notice").one("transitionend",function(){l()}),$("html, body").stop().animate({scrollTop:$("#results-section").offset().top},250,function(){v.scroll()})})}function n(){g.children("p").add(u).add(C).remove(),y.load(phpVars.fetchHomePath+"/php/results-messages.php #no-results-found",function(){y.addClass("active").children("div").removeClass("notice").addClass("error active")})}function r(e){g.children("p").add(u).add(C).remove(),y.load(phpVars.fetchHomePath+"/php/results-messages.php #error",function(){y.find(".error-msg").text(e),y.addClass("active").children("div").removeClass("notice").addClass("error active")})}function s(){var e=$("a.tv-show-fs"),t=window.location.hash;if(t&&!$(".loading-wrapper.fullscreen").hasClass("active")&&!$(".tree-visualizer-fs").is(":visible")&&1==t.indexOf("tv-")){var o=t.match(/\d+$/);e.eq(o[0]-1).click()}}function i(t,n){n&&(V=!0,w=0,g.find("tbody:not(.empty)").empty(),$(".loading-wrapper.searching").removeClass("active")),$.each(t,function(e,t){if(n||!n&&!V){w++;var o=t[0];o=o.replace(/\bhref=\"([^"]+)\"/,'href="#tv-'+w+'" data-tv-url="$1"'),g.find("tbody:not(.empty)").append('<tr data-result-id="'+w+'" data-component="'+t[2]+'"><td>'+w+"</td><td>"+o+"</td><td>"+t[2]+"</td><td>"+t[1]+"</td></tr>")}s()}),g.find(".table-wrapper").fadeIn("fast"),resultIDString=o(w),u.find(".count strong").text(resultIDString),n?a():e()}function d(){$("[for='go-to'], [for='filter-components'], .filter-wrapper label").removeClass("disabled").children("input").prop("disabled",!1),b.find("[type='checkbox'][name='component']").each(function(){var e=$(this),t=e.val();0==g.find("tbody:not(.empty) tr[data-component='"+t+"']").length&&(e.prop("disabled",!0),e.prop("checked",!1),e.parent("label").addClass("disabled"))})}function l(){u.hasClass("scroll")?S=C.offset().top:(S=u.offset().top,T=u.outerHeight(),C.height(T))}function c(){v.scrollTop()>=S?(C.show(),u.addClass("scroll")):(C.hide(),u.removeClass("scroll"))}var p,f=500,h=4,m=window.location.hash,v=$(window),u=($("a.tv-show-fs"),$(".controls")),g=$(".results-wrapper"),b=$(".filter-wrapper"),y=$(".messages"),C=$(".dummy-controls"),w=0,k=0,V=!1,x=!1;e();var I=setTimeout(function(){t()},f);$.ajax(phpVars.fetchCountsPath).done(function(e){var t=$.parseJSON(e),a=t[0],n=t[1];if(k=a,a=o(parseInt(a)),u.find(".count strong + span").text(a),y.find(".amount-hits").text(a),y.find(".is-still-counting").remove(),k>0){var r=Object.keys(n).length;if("undefined"!=typeof n&&r>0){for(var s in n){var i=s.split("_")[2],d=o(parseInt(n[s][0])),l=o(parseInt(n[s][1]));$(".distribution-wrapper tbody").append("<tr><td>"+i+"</td><td>"+d+"</td><td>"+l+"</td></tr>")}$(".distribution-wrapper").show()}k>phpVars.resultsLimit&&y.find(".is-restricted").show()}}).fail(function(){if("abort"!=error){var e="An error occurred: "+error+".";r(e)}}).always(function(){x=!0}),u.find("[name='go-to']").keyup(function(e){var t=e.keyCode,o=$(this);(8==t||46==t||38==t||40==t)&&(this.setCustomValidity(""),38==t&&o.val()<w&&o.val(parseInt(o.val(),10)+1).change(),40==t&&o.val()>1&&o.val(parseInt(o.val(),10)-1).change())}).change(function(){var e=$(this).val(),t=g.find("tbody:not(.empty) tr[data-result-id='"+e+"']");if(t.is(":visible")){this.setCustomValidity("");var o=t.offset(),a=$(".controls").outerHeight();$("html, body").stop().animate({scrollTop:o.top-a},150)}else this.setCustomValidity("Please choose a row that is visible. Some rows are hidden depending on the filters you set.")}),$(".controls form").submit(function(e){e.preventDefault()}),$(".controls [name='filter-components']").change(function(){$(this).parent().toggleClass("active")}),$(document).click(function(e){if($(".controls [for='filter-components']").hasClass("active")){var t=$(e.target);t.closest(".filter-wrapper, .controls [for='filter-components']").length||$(".controls [for='filter-components']").removeClass("active")}}),$(".filter-wrapper [type='checkbox']").change(function(){var e=$(this),t=e.val();$("#all-components").prop("indeterminate",!1),e.is("[name='component']")?(e.is(":checked")?g.find("tbody:not(.empty) tr[data-component='"+t+"']").show():g.find("tbody:not(.empty) tr[data-component='"+t+"']").hide(),b.find("[name='component']").is(":checked")?(b.find("[name='component']:not(:disabled)").length==b.find("[name='component']:not(:disabled):checked").length?b.find("#all-components").prop("checked",!0).parent().addClass("active"):b.find("#all-components").prop("checked",!1).prop("indeterminate",!0).parent().removeClass("active"),g.find(".empty").hide(),$("[for='go-to']").removeClass("disabled").children("input").prop("disabled",!1)):(g.find(".empty").css("display","table-row-group"),b.find("#all-components").prop("checked",!1).parent().removeClass("active"),$("[for='go-to']").addClass("disabled").children("input").prop("disabled",!0))):e.is("#all-components")&&(e.parent().toggleClass("active"),b.find("[type='checkbox'][name='component']:not(:disabled)").prop("checked",e.is(":checked")).change()),$("#go-to").val(g.find("tbody:not(.empty) tr:visible").first().attr("data-result-id")||"--")});var S=u[0].getBoundingClientRect().top+u.scrollTop(),T=u[0].getBoundingClientRect().height;C.height(T),v.resize($.throttle(250,l)),v.scroll($.throttle(250,c)),window.addEventListener("beforeunload",function(){p&&p.abort()}),g.find("tbody").on("click","a.tv-show-fs",function(e){var t=$(this);$(".loading-wrapper.tv").addClass("active"),$("body").treeVisualizer(t.data("tv-url"),{normalView:!1,initFSOnClick:!0,fsFontSize:12}),e.preventDefault()}),m&&1==m.indexOf("tv-")&&y.load(phpVars.fetchHomePath+"/php/results-messages.php #looking-for-tree",function(){y.addClass("active").children("div").removeClass("error").addClass("notice active")})});
