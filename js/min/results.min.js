$(document).ready(function(){function t(){!C&&m<=phpVars.resultsLimit&&($(".loading-wrapper.searching").addClass("active"),$.ajax(phpVars.fetchResultsPath).done(function(t){if(!C){var e=$.parseJSON(t);$(".results-wrapper tbody .added").removeClass("added"),e.data?n(e.data,!1):($(".loading-wrapper.searching").removeClass("active"),$(".results-wrapper tbody .added").removeClass("added"),$(".messages").addClass("active"),e.error?s(e.error_msg):0==$(".results-wrapper tbody").children().length?o():(r(),clearTimeout(k)),C=!0,$(".stop").click(),d&&d.abort())}}).fail(function(t,e,a){var r="An error occurred: "+a+".";s(r)}).always(function(){m!=h||C||e()}))}function e(){d=$.ajax(phpVars.getAllResultsPath).done(function(t){var e=$.parseJSON(t);$(".results-wrapper tbody .added").removeClass("added"),e.data?(n(e.data,!0),r(),$(".stop").click(),clearTimeout(k)):($(".loading-wrapper.searching").removeClass("active"),$(".messages").addClass("active"),e.error?s(e.error_msg):0==$(".results-wrapper tbody").children().length&&o())}).fail(function(t,e,a){var r="An error occurred: "+a+".";s(r)}).always(function(){C=!0,$(".stop").click()})}function a(t){return t.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}function r(){$(".loading-wrapper.searching").removeClass("active"),$(".controls").find(".stop, .continue").prop("disabled",!0),i();var t=b?[g,""]:["--","<small>(still counting)</small>"];notice="<span>"+t[0]+"</span> result(s) have/has been found! "+t[1],m>=phpVars.resultsLimit&&(notice+='<br>We have restricted the output to 500 hits. You can find the reason for this <a href="'+phpVars.fetchHomePath+'/documentation.php#faq-1" title="Why is the output limited to 500 sentences?" target="_blank">in our FAQ</a>.'),$(".notice p").html(notice),$(".messages").addClass("active"),$(".notice").addClass("active"),$(".notice").one("transitionend",function(){l()})}function o(){$(".controls").remove(),$(".error p").text("No results found!"),$(".messages").addClass("active"),$(".error").addClass("active"),$(".error").one("transitionend",function(){l()})}function s(t){$(".controls").remove(),$(".error p").text("Error! "+t),$(".messages").addClass("active"),$(".error").addClass("active"),$(".error").one("transitionend",function(){l()})}function n(e,r){r&&(C=!0,m=0,$(".results-wrapper tbody").empty(),$(".loading-wrapper.searching").removeClass("active")),$.each(e,function(t,e){if(r||!r&&!C){m++;var a=e[0];a=a.replace(/\bhref=\"([^"]+)\"/,'href="#tv-'+m+'" data-tv-url="$1"');var o=a.match(/(?:&tb=)([^&"=]+)/)[1],s=a.match(/(?:>)([^<>]+)(?:<\/a>)/)[1],n="",i="";"lassy"==o?(n=s.match(/([^<>]+?)(?:-\d+(?:-|\.).*)/)[1],n=n.replace(/^((?:[a-zA-Z]{3,4})|(?:WR(?:-[a-zA-Z]){3}))-.*/,"$1"),i=n.replace(/-/g,""),i=i.slice(0,4)):"cgn"==o&&(n=s.match(/([^<>\d]+)/)[1],n=n.slice(1),i=n.replace(/-/g,"")),n=n.toUpperCase(),i=i.toUpperCase(),$(".results-wrapper tbody").append('<tr data-result-id="'+m+'" data-component="'+i+'"><td>'+m+"</td><td>"+a+"</td><td>"+n+"</td><td>"+e[1]+"</td></tr>")}}),$(".results-wrapper").fadeIn("fast"),resultIDString=a(m),$(".count strong").text(resultIDString),w||r||t()}function i(){$("[for='go-to'], [for='filter-components'], .filter-wrapper label").removeClass("disabled").children("input").prop("disabled",!1),$("#go-to").attr("max",m),$(".filter-wrapper [type='checkbox']").each(function(){var t=$(this).attr("name"),e=$(this);0==$(".results-wrapper tbody tr[data-component='"+t+"']").length&&(e.prop("disabled",!0),e.prop("checked",!1),e.parent("label").addClass("disabled"))}),console.log("called")}function l(){x.hasClass("scroll")?T=V.offset().top:(T=x.offset().top,S=x.outerHeight(),V.height(S))}function c(){var t=$(window);t.scrollTop()>=T?(V.show(),x.addClass("scroll")):(V.hide(),x.removeClass("scroll"))}var d,p=5e3,u=7e3,h=10,f=window.location.hash,v=$("a.tv-show-fs"),m=0,g=0,w=!1,C=!1,b=!1;if(t(),f&&1==f.indexOf("tv-")){var y=f.match(/\d+$/);v.eq(y[0]-1).click()}var k=setTimeout(function(){e()},u);setTimeout(function(){$.get(phpVars.fetchCountsPath,function(t){t&&($(".notice span small").remove(),g=a(t),$(".count strong + span").text(g),$(".notice span").text(g),b=!0)})},p),$(".stop").click(function(){w||(w=!0,$(".loading-wrapper.searching").removeClass("active"),$(this).prop("disabled",!0),$(".continue").prop("disabled",C))}),$(".continue").click(function(){w&&!C&&(w=!1,$(".stop").prop("disabled",!1),$(this).prop("disabled",!0),t())}),$(".controls [name='to-top']").click(function(){$("html, body").animate({scrollTop:0})}),$(".controls [name='go-to']").change(function(){var t=$(this).val(),e=$("tr[data-result-id='"+t+"']").offset(),a=$(".controls").outerHeight();$("html, body").stop().animate({scrollTop:e.top-a})}),$(".controls [name='filter-components']").change(function(){$(this).parent().toggleClass("active")}),$(document).click(function(t){if($(".controls [for='filter-components']").hasClass("active")){var e=$(t.target);e.closest(".filter-wrapper, .controls [for='filter-components']").length||$(".controls [for='filter-components']").removeClass("active")}}),$(".filter-wrapper [type='checkbox']").change(function(){var t=$(this),e=$(this).attr("name");$(".results-wrapper tbody tr.empty").remove(),t.is(":checked")?$(".results-wrapper tbody tr[data-component='"+e+"']").show():$(".results-wrapper tbody tr[data-component='"+e+"']").hide(),t.siblings().addBack().is(":checked")||$(".results-wrapper tbody").append('<tr class="empty"><td colspan="4">No results for the filters you specified.</td></tr>')});var x=$(".controls"),T=x[0].getBoundingClientRect().top+x.scrollTop(),S=x[0].getBoundingClientRect().height,V=$(".dummy-controls");V.height(S),$(window).resize($.throttle(250,l)),$(window).scroll($.throttle(250,c)),$(".results-wrapper tbody").on("click","a.tv-show-fs",function(t){var e=$(this);$(".loading-wrapper.tv").addClass("active"),window.history.replaceState("",document.title,window.location.pathname+e.attr("href")),body.treeVisualizer(e.data("tv-url"),{normalView:!1,initFSOnClick:!0,fsFontSize:12}),t.preventDefault()})});
