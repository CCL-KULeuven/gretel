$(document).ready(function(){function e(){!g&&m<=phpVars.resultsLimit&&($(".loading-wrapper.searching").addClass("active"),$.ajax(phpVars.fetchResultsPath).done(function(e){if(!g){var t=$.parseJSON(e);$(".results-wrapper tbody:not(.empty) .added").removeClass("added"),!t.error&&t.data?n(t.data,!1):($(".loading-wrapper.searching").removeClass("active"),$(".results-wrapper tbody:not(.empty) .added").removeClass("added"),$(".messages").addClass("active"),t.error?s(t.data):0==$(".results-wrapper tbody:not(.empty)").children().length?r():(a(),clearTimeout(b)),g=!0,$(".stop").click(),d&&d.abort())}}).fail(function(e,t,o){if("abort"!=o){var a="An error occurred: "+o+".";s(a)}}).always(function(){m!=h||g||t()}))}function t(){localStorage.removeItem("downloadresults"),d=$.ajax(phpVars.getAllResultsPath).done(function(e){var t=$.parseJSON(e);$(".results-wrapper tbody:not(.empty) .added").removeClass("added"),!t.error&&t.data?(n(t.data,!0),a(),$(".stop").click(),clearTimeout(b)):($(".loading-wrapper.searching").removeClass("active"),$(".messages").addClass("active"),t.error?s(t.data):0==$(".results-wrapper tbody:not(.empty)").children().length&&r()),t.download&&localStorage.setItem("downloadresults",JSON.stringify(t.download))}).fail(function(e,t,o){if("abort"!=o){var a="An error occurred: "+o+".";s(a)}}).always(function(){g=!0,$(".stop").click()})}function o(e){return Number.isInteger(e)&&e>999?e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):e}function a(){$(".loading-wrapper.searching").removeClass("active"),$(".controls").find(".stop, .continue").prop("disabled",!0),i();var e=w?[f,""]:["--","<small>(still counting)</small>"];notice="<strong>"+e[0]+"</strong> result(s) have/has been found! "+e[1],m>=phpVars.resultsLimit&&(notice+='<br>We have restricted the output to 500 hits. You can find the reason for this <a href="'+phpVars.fetchHomePath+'/documentation.php#faq-1" title="Why is the output limited to 500 sentences?" target="_blank">in our FAQ</a>.'),$(".notice p").html(notice),$(".messages").addClass("active"),$(".notice").addClass("active"),$(".notice").one("transitionend",function(){l()})}function r(){$(".controls").remove(),$(".error p").text("No results found!"),$(".messages").addClass("active"),$(".error").addClass("active"),$(".error").one("transitionend",function(){l()})}function s(e){$(".controls").remove(),$(".error p").text("Error! "+e),$(".messages").addClass("active"),$(".error").addClass("active"),$(".error").one("transitionend",function(){l()})}function n(t,a){a&&(g=!0,m=0,$(".results-wrapper tbody:not(.empty)").empty(),$(".loading-wrapper.searching").removeClass("active")),$.each(t,function(e,t){if(a||!a&&!g){m++;var o=t[0];o=o.replace(/\bhref=\"([^"]+)\"/,'href="#tv-'+m+'" data-tv-url="$1"');var r=o.match(/(?:&db=)([^&"=]+)/)[1],s=o.match(/(?:>)([^<>]+)(?:<\/a>)/)[1],n="",i="";"lassy"==r?(n=s.match(/([^<>]+?)(?:-\d+(?:-|\.).*)/)[1],n=n.replace(/^((?:[a-zA-Z]{3,4})|(?:WR(?:-[a-zA-Z]){3}))-.*/,"$1"),i=n.replace(/-/g,""),i=i.slice(0,4)):"cgn"==r?(n=s.match(/([^<>\d]+)/)[1],n=n.slice(1),i=n.replace(/-/g,"")):(n=s.match(/^([a-zA-Z]{2}(?:-[a-zA-Z]){3})/)[1],i=n.replace(/-/g,"")),n=n.toUpperCase(),i=i.toUpperCase(),$(".results-wrapper tbody:not(.empty)").append('<tr data-result-id="'+m+'" data-component="'+i+'"><td>'+m+"</td><td>"+o+"</td><td>"+n+"</td><td>"+t[1]+"</td></tr>")}}),$(".results-wrapper").fadeIn("fast"),resultIDString=o(m),$(".count strong").text(resultIDString),v||a||e()}function i(){$("[for='go-to'], [for='filter-components'], .filter-wrapper label").removeClass("disabled").children("input").prop("disabled",!1),$(".filter-wrapper [type='checkbox'][name='component']").each(function(){var e=$(this),t=e.val();0==$(".results-wrapper tbody:not(.empty) tr[data-component='"+t+"']").length&&(e.prop("disabled",!0),e.prop("checked",!1),e.parent("label").addClass("disabled"))})}function l(){y.hasClass("scroll")?C=V.offset().top:(C=y.offset().top,k=y.outerHeight(),V.height(k))}function c(){var e=$(window);e.scrollTop()>=C?(V.show(),y.addClass("scroll")):(V.hide(),y.removeClass("scroll"))}var d,p=500,u=700,h=4,m=(window.location.hash,$("a.tv-show-fs"),0),f=0,v=!1,g=!1,w=!1;e();var b=setTimeout(function(){t()},u);setTimeout(function(){$.get(phpVars.fetchCountsPath,function(e){e&&(e=parseInt(e),$(".notice small").remove(),f=o(e),$(".count strong + span").text(f),$(".notice strong").text(f),w=!0)})},p),$(".stop").click(function(){v||(v=!0,$(".loading-wrapper.searching").removeClass("active"),$(this).prop("disabled",!0),$(".continue").prop("disabled",g))}),$(".continue").click(function(){v&&!g&&(v=!1,$(".stop").prop("disabled",!1),$(this).prop("disabled",!0),e())}),$(".controls [name='to-top']").click(function(){$("html, body").animate({scrollTop:0})}),$(".controls [name='go-to']").keyup(function(e){var t=e.keyCode,o=$(this);(8==t||46==t||38==t||40==t)&&(this.setCustomValidity(""),38==t&&o.val()<m&&o.val(parseInt(o.val(),10)+1).change(),40==t&&o.val()>1&&o.val(parseInt(o.val(),10)-1).change())}).change(function(){var e=$(this).val(),t=$(".results-wrapper tbody:not(.empty) tr[data-result-id='"+e+"']");if(t.is(":visible")){this.setCustomValidity("");var o=t.offset(),a=$(".controls").outerHeight();$("html, body").stop().animate({scrollTop:o.top-a})}else this.setCustomValidity("Please choose a row that is visible. Some rows are hidden depending on the filters you set.")}),$(".controls form").submit(function(e){e.preventDefault()}),$(".controls [name='filter-components']").change(function(){$(this).parent().toggleClass("active")}),$(document).click(function(e){if($(".controls [for='filter-components']").hasClass("active")){var t=$(e.target);t.closest(".filter-wrapper, .controls [for='filter-components']").length||$(".controls [for='filter-components']").removeClass("active")}}),$(".filter-wrapper [type='checkbox']").change(function(){var e=$(this),t=e.val();e.is("[name='component']")?(e.is(":checked")?$(".results-wrapper tbody:not(.empty) tr[data-component='"+t+"']").show():$(".results-wrapper tbody:not(.empty) tr[data-component='"+t+"']").hide(),e.closest(".filter-wrapper").find("[name='component']").addBack().is(":checked")?($(".filter-wrapper [name='component']:not([disabled])").length==$(".filter-wrapper [name='component']:not([disabled]):checked").length?$("#all-components").prop("checked",!0).parent().addClass("active"):$("#all-components").prop("checked",!1).parent().removeClass("active"),$(".results-wrapper .empty").hide(),$("[for='go-to']").removeClass("disabled").children("input").prop("disabled",!1)):($(".results-wrapper .empty").css("display","table-row-group"),$("#all-components").prop("checked",!1).parent().removeClass("active"),$("[for='go-to']").addClass("disabled").children("input").prop("disabled",!0))):e.is("#all-components")&&(e.parent().toggleClass("active"),$(".filter-wrapper [type='checkbox'][name='component']:not([disabled])").prop("checked",e.is(":checked")).change()),$("#go-to").val($(".results-wrapper tbody:not(.empty) tr:visible").first().attr("data-result-id")||"--")});var y=$(".controls"),C=y[0].getBoundingClientRect().top+y.scrollTop(),k=y[0].getBoundingClientRect().height,V=$(".dummy-controls");V.height(k),$(window).resize($.throttle(250,l)),$(window).scroll($.throttle(250,c)),$(".results-wrapper tbody:not(.empty)").on("click","a.tv-show-fs",function(e){var t=$(this);$(".loading-wrapper.tv").addClass("active"),window.history.replaceState("",document.title,window.location.pathname+t.attr("href")),body.treeVisualizer(t.data("tv-url"),{normalView:!1,initFSOnClick:!0,fsFontSize:12}),e.preventDefault()})});
