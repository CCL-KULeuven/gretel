$(function(){function e(){!k&&C<=phpVars.resultsLimit&&($(".loading-wrapper.searching").addClass("active"),d=$.ajax(phpVars.fetchResultsPath).done(function(t){if(!k&&!V){var e=$.parseJSON(t);!e.error&&e.data?(m.find("tbody.empty").hide(),r(e.data,!1)):($(".loading-wrapper.searching").removeClass("active"),b.closest(".results-messages-wrapper").addClass("active"),g.addClass("active"),e.error?s(e.data):0==m.find("tbody:not(.empty)").children().length?a():n(),clearTimeout(I),V=k=!0,i&&i.abort(),l&&l.abort())}}).fail(function(t,e,n){if("abort"!=n){var a="An error occurred";""!=n&&(a+=": "+n+"."),s(a)}}).always(function(){C!=c||k||V||t()}))}function t(){i||(clearTimeout(I),i=$.ajax(phpVars.getAllResultsPath).done(function(t){var e=$.parseJSON(t);!e.error&&e.data?(m.find("tbody.empty").hide(),r(e.data,!0)):($(".loading-wrapper.searching").removeClass("active"),b.children("div").removeClass("error notice").closest(".results-messages-wrapper").show(),g.addClass("active"),e.error?s(e.data):0==m.find("tbody:not(.empty)").children().length&&a())}).fail(function(t,e,n){"abort"!=n&&s("An error occurred: "+n+".")}).always(function(){k=!0,d&&d.abort()}))}function p(t){return Number.isInteger(t)&&999<t?t.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):t}function n(){$("[for='filter-components'], .filter-sel-wrapper label").removeClass("disabled").children("input").prop("disabled",!1),v.find("[type='checkbox'][name='component']").each(function(t,e){var n=$(e),a=n.val();0==m.find("tbody:not(.empty) tr[data-component^='"+a+"']").length&&(n.prop("disabled",!0),n.prop("checked",!1),n.parent("label").addClass("disabled"))}),u.removeClass("results-loading").addClass("results-done"),b.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php?sid="+phpVars.sid+" #results-found",function(){x&&(b.find(".amount-hits").html(p(parseInt(y))),b.find(".is-still-counting").remove()),C<phpVars.resultsLimit&&(null!=l&&(l.abort(),l=null),countString=h.find(".count strong").text(),h.find(".count strong + span").text(countString),b.find(".amount-hits").text(countString),b.find(".is-still-counting").remove()),b.children("div").removeClass("error").addClass("notice active").closest(".results-messages-wrapper").show(),g.addClass("active"),w.show()})}function a(){u.removeClass("results-loading").addClass("results-none"),m.add(h).remove(),g.addClass("no-results"),u.addClass("search-no-results"),b.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php?sid="+phpVars.sid+" #no-results-found",function(){b.children("div").removeClass("notice").addClass("error active").closest(".results-messages-wrapper").show()})}function s(t){u.removeClass("results-loading").addClass("results-failed"),m.add(h).remove(),g.addClass("error"),u.addClass("search-error"),b.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php?sid="+phpVars.sid+" #error",function(){b.find(".error-msg").text(t).after('<p>If this error persists, please do not hesitate to <a href="documentation.php#faq-4" title="How can you contact us?">contact us</a>!</p>'),b.children("div").removeClass("notice").addClass("error active").closest(".results-messages-wrapper").show()})}function r(t,a){a&&(k=!0,C=0,m.find("tbody:not(.empty)").empty()),$.each(t,function(t,e){if(a||!a&&!k){C++;var n=e[0];n=n.replace(/\bhref=\"([^"]+)\"/,'href="#tv-'+C+'" data-tv-url="$1"'),m.find("tbody:not(.empty)").append('<tr data-result-id="'+C+'" data-component="'+e[2]+'"><td>'+C+"</td><td>"+n+"</td><td>"+e[2]+"</td><td>"+e[1]+"</td></tr>")}}),resultIDString=p(parseInt(C)),h.find(".count strong").text(resultIDString),a||k?n():setTimeout(e(),0)}function o(){null!=i&&(i.abort(),i=null),null!=l&&(l.abort(),l=null),null!=d&&(d.abort(),d=null),k=!0}var i,d,l,c=4,f=(window.location.hash,$(window),$(document)),u=$("body"),h=$(".controls"),m=$(".results-ajax-wrapper"),v=$(".filter-sel-wrapper"),g=$("#download-overview .flex-content"),b=g.find(".messages"),w=$(".notification-wrapper"),C=0,y=0,k=!1,x=!1,V=!1;e(),l=$.ajax(phpVars.fetchCountsPath).done(function(t){var e=$.parseJSON(t);if(!e.error&&e.sum&&e.counts){var n=e.sum,a=e.counts;if(y=n,n=p(parseInt(n)),h.find(".count strong + span").text(n),b.find(".amount-hits").text(n),b.find(".is-still-counting").remove(),u.removeClass("counts-loading"),u.addClass("counts-done"),0<y){var s=Object.keys(a).length;if(void 0!==a&&0<s){var r=0,o=0;for(var i in a){var d=i.split("_")[2],l=p(parseInt(a[i][0])),c=p(parseInt(a[i][1]));r+=parseInt(a[i][0]),o+=parseInt(a[i][1]),g.find(".distribution-wrapper tbody").append("<tr><td>"+d+"</td><td>"+l+"</td><td>"+c+"</td></tr>")}g.find(".distribution-wrapper tbody").append("<tr><th>Total</th><th>"+p(r)+"</th><th>"+p(o)+"</th></tr>"),g.find(".distribution-wrapper").show()}y>phpVars.resultsLimit&&b.find(".is-restricted").show()}}}).fail(function(t,e,n){"abort"!=n&&s("An error occurred: "+n+".")}).always(function(){x=!0}),u.addClass("results-loading counts-loading");var I=setTimeout(function(){t()},500);f.click(function(t){h.find(".filter-wrapper").hasClass("active")&&($(t.target).closest(".filter-wrapper").length||h.find(".filter-wrapper").removeClass("active"))}),h.find("[for='filter-components']").click(function(){$(this).parent().addClass("active")}),v.find("[type='checkbox']").change(function(){var t=$(this),e=t.val();$("#all-components").prop("indeterminate",!1),t.is("[name='component']")?(t.is(":checked")?m.find("tbody:not(.empty) tr[data-component^='"+e+"']").show():m.find("tbody:not(.empty) tr[data-component^='"+e+"']").hide(),v.find("[name='component']").is(":checked")?(v.find("[name='component']:not(:disabled)").length==v.find("[name='component']:not(:disabled):checked").length?v.find("#all-components").prop("checked",!0).parent().addClass("active"):v.find("#all-components").prop("checked",!1).prop("indeterminate",!0).parent().removeClass("active"),m.find(".empty").hide()):(m.find(".empty").css("display","table-row-group").find("td").text("No results matching the specified filters"),v.find("#all-components").prop("checked",!1).parent().removeClass("active"))):t.is("#all-components")&&(t.parent().toggleClass("active"),v.find("[type='checkbox'][name='component']:not(:disabled)").prop("checked",t.is(":checked")).change())}),window.addEventListener("beforeunload",function(){o()}),$(".secondary-navigation a").click(function(){o()}),m.find("tbody").on("click","a.tv-show-fs",function(t){var e=$(this),n=e.parent().nextAll("td:last-child").html(),a=$("#tree-visualizer-fs");m.find("tbody a").removeClass("tv-toggled-link"),this.hasAttribute("data-tv-fontsize")||e.attr("data-tv-fontsize",0),a.attr("data-tv-active-index",e.closest("tr").index()),e.addClass("tv-toggled-link"),u.treeVisualizer(e.data("tv-url"),{normalView:!1,initFSOnClick:!0,sentence:n,hasNavigation:!0}),t.preventDefault()}),w.find("button").click(function(){w.hide()}),w.find("a").click(function(t){t.preventDefault(),$("html, body").stop().animate({scrollTop:$("#download-overview").offset().top},150),w.fadeOut("fast")}),$("#results-menu a").off("click").click(function(t){$("html, body").stop().animate({scrollTop:$($(this).attr("href")).offset().top},150),t.preventDefault()})});