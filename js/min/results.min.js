$(document).ready(function(){function e(){!H&&P<=phpVars.resultsLimit&&($(".loading-wrapper.searching").addClass("active"),u=$.ajax(phpVars.fetchResultsPath).done(function(e){if(!H){var t=$.parseJSON(e);k.find("tbody:not(.empty) .added").removeClass("added"),!t.error&&t.data?d(t.data,!1):($(".loading-wrapper.searching").removeClass("active"),k.find("tbody:not(.empty) .added").removeClass("added"),S.children("div").removeClass("error notice").closest(".results-messages-wrapper").addClass("active"),x.addClass("active"),t.error?r(t.data):0==k.find("tbody:not(.empty)").children().length?s():n(),clearTimeout(j),H=!0,h&&h.abort())}}).fail(function(e,t,o){if("abort"!=o){var a="An error occurred";""!=o&&(a+=": "+o+"."),r(a)}}).always(function(){P!=g||H||t()}))}function t(){h||(clearTimeout(j),h=$.ajax(phpVars.getAllResultsPath).done(function(e){var t=$.parseJSON(e);k.find("tbody:not(.empty) .added").removeClass("added"),!t.error&&t.data?d(t.data,!0):($(".loading-wrapper.searching").removeClass("active"),S.children("div").removeClass("error notice").closest(".results-messages-wrapper").show(),x.addClass("active"),t.error?r(t.data):0==k.find("tbody:not(.empty)").children().length&&s())}).fail(function(e,t,o){if("abort"!=o){var a="An error occurred: "+o+".";r(a)}}).always(function(){H=!0,u&&u.abort()}))}function o(){m=$.ajax(phpVars.fetchCountsPath).done(function(e){var t=$.parseJSON(e),o=t[0],n=t[1];if(T=o,o=a(parseInt(o)),C.find(".count strong + span").text(o),S.find(".amount-hits").text(o),S.find(".is-still-counting").remove(),T>0){var s=Object.keys(n).length;if("undefined"!=typeof n&&s>0){for(var r in n){var i=r.split("_")[2],d=a(parseInt(n[r][0])),l=a(parseInt(n[r][1]));x.find(".distribution-wrapper tbody").append("<tr><td>"+i+"</td><td>"+d+"</td><td>"+l+"</td></tr>")}x.find(".distribution-wrapper").show()}T>phpVars.resultsLimit&&S.find(".is-restricted").show()}}).fail(function(e,t,o){if("abort"!=o){var a="An error occurred: "+o+".";r(a)}}).always(function(){L=!0})}function a(e){return Number.isInteger(e)&&e>999?e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):e}function n(){l(),S.load(phpVars.fetchHomePath+"/php/results-messages.php #results-found",function(){L&&(S.find(".amount-hits").html(a(parseInt(T))),S.find(".is-still-counting").remove()),T>phpVars.resultsLimit||P==phpVars.resultsLimit?(S.find(".is-restricted").show(),o()):(countString=C.find(".count strong").text(),C.find(".count strong + span").text(countString),S.find(".amount-hits").text(countString),S.find(".is-still-counting").remove()),S.children("div").removeClass("error").addClass("notice active").closest(".results-messages-wrapper").show(),x.addClass("active"),I.show()})}function s(){k.children("p").add(C).add(O).remove(),S.load(phpVars.fetchHomePath+"/php/results-messages.php #no-results-found",function(){S.children("div").removeClass("notice").addClass("error active").closest(".results-messages-wrapper").show()})}function r(e){k.add(C).add(O).remove(),S.load(phpVars.fetchHomePath+"/php/results-messages.php #error",function(){S.find(".error-msg").text(e),S.children("div").removeClass("notice").addClass("error active").closest(".results-messages-wrapper").show(),x.addClass("active")})}function i(){var e=$("a.tv-show-fs"),t=window.location.hash;if(!$(".loading-wrapper.fullscreen").hasClass("active")&&!$(".tree-visualizer-fs").is(":visible")&&1==t.indexOf("tv-")){var o=t.match(/\d+$/);e.eq(o[0]-1).click()}}function d(t,o){o&&(H=!0,P=0,k.find("tbody:not(.empty)").empty(),$(".loading-wrapper.searching").removeClass("active")),$.each(t,function(e,t){if(o||!o&&!H){P++;var a=t[0];a=a.replace(/\bhref=\"([^"]+)\"/,'href="#tv-'+P+'" data-tv-url="$1"'),k.find("tbody:not(.empty)").append('<tr data-result-id="'+P+'" data-component="'+t[2]+'"><td>'+P+"</td><td>"+a+"</td><td>"+t[2]+"</td><td>"+t[1]+"</td></tr>")}D&&i()}),resultIDString=a(parseInt(P)),C.find(".count strong").text(resultIDString),o||H?n():e()}function l(){$("[for='go-to'], [for='filter-components'], .filter-wrapper label").removeClass("disabled").children("input").prop("disabled",!1),V.find("[type='checkbox'][name='component']").each(function(){var e=$(this),t=e.val();0==k.find("tbody:not(.empty) tr[data-component='"+t+"']").length&&(e.prop("disabled",!0),e.prop("checked",!1),e.parent("label").addClass("disabled"))})}function c(){h&&h.abort(),m&&m.abort(),u&&u.abort(),H=!0}function p(){C.hasClass("scroll")?z=O.offset().top:(z=C.offset().top,R=C.outerHeight(),O.height(R))}function f(){w.scrollTop()>=z?(O.show(),C.addClass("scroll")):(O.hide(),C.removeClass("scroll"))}var h,u,m,v=500,g=4,b=window.location.hash,w=$(window),y=$(document),C=($("a.tv-show-fs"),$(".controls")),k=$(".results-ajax-wrapper"),V=$(".filter-wrapper"),x=$(".results-download-wrapper"),S=x.find(".messages"),I=$(".notification-wrapper"),O=$(".dummy-controls"),P=0,T=0,H=!1,L=!1,D=window.location.hash;e();var j=setTimeout(function(){t()},v);C.find("[name='go-to']").keyup(function(e){var t=e.keyCode,o=$(this);(8==t||46==t||38==t||40==t)&&(this.setCustomValidity(""),38==t&&o.val()<P&&o.val(parseInt(o.val(),10)+1).change(),40==t&&o.val()>1&&o.val(parseInt(o.val(),10)-1).change())}).change(function(){var e=$(this).val(),t=k.find("tbody:not(.empty) tr[data-result-id='"+e+"']");if(t.is(":visible")){this.setCustomValidity("");var o=t.offset(),a=C.outerHeight();$("html, body").stop().animate({scrollTop:o.top-a},150)}else this.setCustomValidity("Please choose a row that is visible. Some rows are hidden depending on the filters you set.")}),$(".controls form").submit(function(e){e.preventDefault()}),$(".controls [name='filter-components']").change(function(){$(this).parent().toggleClass("active")}),y.click(function(e){if($(".controls [for='filter-components']").hasClass("active")){var t=$(e.target);t.closest(".filter-wrapper, .controls [for='filter-components']").length||$(".controls [for='filter-components']").removeClass("active")}}),$(".filter-wrapper [type='checkbox']").change(function(){var e=$(this),t=e.val();$("#all-components").prop("indeterminate",!1),e.is("[name='component']")?(e.is(":checked")?k.find("tbody:not(.empty) tr[data-component='"+t+"']").show():k.find("tbody:not(.empty) tr[data-component='"+t+"']").hide(),V.find("[name='component']").is(":checked")?(V.find("[name='component']:not(:disabled)").length==V.find("[name='component']:not(:disabled):checked").length?V.find("#all-components").prop("checked",!0).parent().addClass("active"):V.find("#all-components").prop("checked",!1).prop("indeterminate",!0).parent().removeClass("active"),k.find(".empty").hide(),$("[for='go-to']").removeClass("disabled").children("input").prop("disabled",!1)):(k.find(".empty").css("display","table-row-group"),V.find("#all-components").prop("checked",!1).parent().removeClass("active"),$("[for='go-to']").addClass("disabled").children("input").prop("disabled",!0))):e.is("#all-components")&&(e.parent().toggleClass("active"),V.find("[type='checkbox'][name='component']:not(:disabled)").prop("checked",e.is(":checked")).change()),$("#go-to").val(k.find("tbody:not(.empty) tr:visible").first().attr("data-result-id")||"--")});var z=C[0].getBoundingClientRect().top+C.scrollTop(),R=C[0].getBoundingClientRect().height;O.height(R),function(){var e,t=$("#results .results-download-wrapper")[0],o=new MutationObserver(function(t){t.forEach(function(){clearTimeout(e),e=setTimeout(function(){p()},500)})}),a={attributes:!0,childList:!0,characterData:!0,subtree:!0};o.observe(t,a)}(),w.resize($.throttle(250,p)),w.scroll($.throttle(250,f)),window.addEventListener("beforeunload",function(){c()}),w.unload(function(){c()}),$(".secondary-navigation a").click(function(){c()}),k.find("tbody").on("click","a.tv-show-fs",function(e){var t=$(this);$(".loading-wrapper.tv").addClass("active"),$("body").treeVisualizer(t.data("tv-url"),{normalView:!1,initFSOnClick:!0,fsFontSize:12}),e.preventDefault()}),b&&1==b.indexOf("tv-")&&S.load(phpVars.fetchHomePath+"/php/results-messages.php #looking-for-tree",function(){S.children("div").removeClass("error").addClass("notice active").closest(".results-messages-wrapper").show(),x.addClass("active")}),I.find("button").click(function(){I.hide()}),I.find("a").click(function(e){e.preventDefault(),$("html, body").stop().animate({scrollTop:$("#results").offset().top},150),I.fadeOut("fast")})});
