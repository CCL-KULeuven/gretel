$(document).ready(function(){function e(){!O&&S<=phpVars.resultsLimit&&($(".loading-wrapper.searching").addClass("active"),h=$.ajax(phpVars.fetchResultsPath).done(function(e){if(!O){var t=$.parseJSON(e);y.find("tbody:not(.empty) .added").removeClass("added"),!t.error&&t.data?i(t.data,!1):($(".loading-wrapper.searching").removeClass("active"),y.find("tbody:not(.empty) .added").removeClass("added"),V.children("div").removeClass("error notice").closest(".results-messages-wrapper").addClass("active"),k.addClass("active"),t.error?n(t.data):0==y.find("tbody:not(.empty)").children().length?s():(o(),clearTimeout(H)),O=!0,f&&f.abort())}}).fail(function(e,t,a){if("abort"!=a){var o="An error occurred";""!=a&&(o+=": "+a+"."),n(o)}}).always(function(){S!=m||O||t()}))}function t(){f||(f=$.ajax(phpVars.getAllResultsPath).done(function(e){var t=$.parseJSON(e);y.find("tbody:not(.empty) .added").removeClass("added"),!t.error&&t.data?(i(t.data,!0),clearTimeout(H)):($(".loading-wrapper.searching").removeClass("active"),V.children("div").removeClass("error notice").closest(".results-messages-wrapper").show(),k.addClass("active"),t.error?n(t.data):0==y.find("tbody:not(.empty)").children().length&&s())}).fail(function(e,t,a){if("abort"!=a){var o="An error occurred: "+a+".";n(o)}}).always(function(){O=!0,h&&h.abort()}))}function a(e){return Number.isInteger(e)&&e>999?e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):e}function o(){d(),V.load(phpVars.fetchHomePath+"/php/results-messages.php #results-found",function(){T&&(V.find(".amount-hits").html(a(parseInt(P))),V.find(".is-still-counting").remove()),(P>phpVars.resultsLimit||S==phpVars.resultsLimit)&&V.find(".is-restricted").show(),V.children("div").removeClass("error").addClass("notice active").closest(".results-messages-wrapper").show(),k.addClass("active"),x.show()})}function s(){y.children("p").add(w).add(I).remove(),V.load(phpVars.fetchHomePath+"/php/results-messages.php #no-results-found",function(){V.children("div").removeClass("notice").addClass("error active").closest(".results-messages-wrapper").show()})}function n(e){y.add(w).add(I).remove(),V.load(phpVars.fetchHomePath+"/php/results-messages.php #error",function(){V.find(".error-msg").text(e),V.children("div").removeClass("notice").addClass("error active").closest(".results-messages-wrapper").show(),k.addClass("active")})}function r(){var e=$("a.tv-show-fs"),t=window.location.hash;if(t&&!$(".loading-wrapper.fullscreen").hasClass("active")&&!$(".tree-visualizer-fs").is(":visible")&&1==t.indexOf("tv-")){var a=t.match(/\d+$/);e.eq(a[0]-1).click()}}function i(t,s){s&&(O=!0,S=0,y.find("tbody:not(.empty)").empty(),$(".loading-wrapper.searching").removeClass("active")),$.each(t,function(e,t){if(s||!s&&!O){S++;var a=t[0];a=a.replace(/\bhref=\"([^"]+)\"/,'href="#tv-'+S+'" data-tv-url="$1"'),y.find("tbody:not(.empty)").append('<tr data-result-id="'+S+'" data-component="'+t[2]+'"><td>'+S+"</td><td>"+a+"</td><td>"+t[2]+"</td><td>"+t[1]+"</td></tr>")}r()}),resultIDString=a(S),w.find(".count strong").text(resultIDString),s||O?o():e()}function d(){$("[for='go-to'], [for='filter-components'], .filter-wrapper label").removeClass("disabled").children("input").prop("disabled",!1),C.find("[type='checkbox'][name='component']").each(function(){var e=$(this),t=e.val();0==y.find("tbody:not(.empty) tr[data-component='"+t+"']").length&&(e.prop("disabled",!0),e.prop("checked",!1),e.parent("label").addClass("disabled"))})}function l(){f&&f.abort(),j&&j.abort(),h&&h.abort(),O=!0}function c(){w.hasClass("scroll")?L=I.offset().top:(L=w.offset().top,D=w.outerHeight(),I.height(D))}function p(){g.scrollTop()>=L?(I.show(),w.addClass("scroll")):(I.hide(),w.removeClass("scroll"))}var f,h,u=500,m=4,v=window.location.hash,g=$(window),b=$(document),w=($("a.tv-show-fs"),$(".controls")),y=$(".results-ajax-wrapper"),C=$(".filter-wrapper"),k=$(".results-download-wrapper"),V=k.find(".messages"),x=$(".notification-wrapper"),I=$(".dummy-controls"),S=0,P=0,O=!1,T=!1;e();var H=setTimeout(function(){t()},u),j=$.ajax(phpVars.fetchCountsPath).done(function(e){var t=$.parseJSON(e),o=t[0],s=t[1];if(P=o,o=a(parseInt(o)),w.find(".count strong + span").text(o),V.find(".amount-hits").text(o),V.find(".is-still-counting").remove(),P>0){var n=Object.keys(s).length;if("undefined"!=typeof s&&n>0){for(var r in s){var i=r.split("_")[2],d=a(parseInt(s[r][0])),l=a(parseInt(s[r][1]));k.find(".distribution-wrapper tbody").append("<tr><td>"+i+"</td><td>"+d+"</td><td>"+l+"</td></tr>")}k.find(".distribution-wrapper").show()}P>phpVars.resultsLimit&&V.find(".is-restricted").show()}}).fail(function(e,t,a){if("abort"!=a){var o="An error occurred: "+a+".";n(o)}}).always(function(){T=!0});w.find("[name='go-to']").keyup(function(e){var t=e.keyCode,a=$(this);(8==t||46==t||38==t||40==t)&&(this.setCustomValidity(""),38==t&&a.val()<S&&a.val(parseInt(a.val(),10)+1).change(),40==t&&a.val()>1&&a.val(parseInt(a.val(),10)-1).change())}).change(function(){var e=$(this).val(),t=y.find("tbody:not(.empty) tr[data-result-id='"+e+"']");if(t.is(":visible")){this.setCustomValidity("");var a=t.offset(),o=w.outerHeight();$("html, body").stop().animate({scrollTop:a.top-o},150)}else this.setCustomValidity("Please choose a row that is visible. Some rows are hidden depending on the filters you set.")}),$(".controls form").submit(function(e){e.preventDefault()}),$(".controls [name='filter-components']").change(function(){$(this).parent().toggleClass("active")}),b.click(function(e){if($(".controls [for='filter-components']").hasClass("active")){var t=$(e.target);t.closest(".filter-wrapper, .controls [for='filter-components']").length||$(".controls [for='filter-components']").removeClass("active")}}),$(".filter-wrapper [type='checkbox']").change(function(){var e=$(this),t=e.val();$("#all-components").prop("indeterminate",!1),e.is("[name='component']")?(e.is(":checked")?y.find("tbody:not(.empty) tr[data-component='"+t+"']").show():y.find("tbody:not(.empty) tr[data-component='"+t+"']").hide(),C.find("[name='component']").is(":checked")?(C.find("[name='component']:not(:disabled)").length==C.find("[name='component']:not(:disabled):checked").length?C.find("#all-components").prop("checked",!0).parent().addClass("active"):C.find("#all-components").prop("checked",!1).prop("indeterminate",!0).parent().removeClass("active"),y.find(".empty").hide(),$("[for='go-to']").removeClass("disabled").children("input").prop("disabled",!1)):(y.find(".empty").css("display","table-row-group"),C.find("#all-components").prop("checked",!1).parent().removeClass("active"),$("[for='go-to']").addClass("disabled").children("input").prop("disabled",!0))):e.is("#all-components")&&(e.parent().toggleClass("active"),C.find("[type='checkbox'][name='component']:not(:disabled)").prop("checked",e.is(":checked")).change()),$("#go-to").val(y.find("tbody:not(.empty) tr:visible").first().attr("data-result-id")||"--")});var L=w[0].getBoundingClientRect().top+w.scrollTop(),D=w[0].getBoundingClientRect().height;I.height(D),g.resize($.throttle(250,c)),g.scroll($.throttle(250,p)),window.addEventListener("beforeunload",function(){l()}),g.unload(function(){l()}),$(".secondary-navigation a").click(function(){l()}),y.find("tbody").on("click","a.tv-show-fs",function(e){var t=$(this);$(".loading-wrapper.tv").addClass("active"),$("body").treeVisualizer(t.data("tv-url"),{normalView:!1,initFSOnClick:!0,fsFontSize:12}),e.preventDefault()}),v&&1==v.indexOf("tv-")&&V.load(phpVars.fetchHomePath+"/php/results-messages.php #looking-for-tree",function(){V.children("div").removeClass("error").addClass("notice active").closest(".results-messages-wrapper").show(),k.addClass("active")}),x.find("button").click(function(){x.hide()}),x.find("a").click(function(e){e.preventDefault(),$("html, body").stop().animate({scrollTop:$("#results").offset().top},150),x.hide()})});
