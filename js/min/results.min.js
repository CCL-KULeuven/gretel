$(function(){function t(){!T&&S<=phpVars.resultsLimit&&($(".loading-wrapper.searching").addClass("active"),u=$.ajax(phpVars.fetchResultsPath).done(function(t){if(!T){var e=$.parseJSON(t);!e.error&&e.data?(l(e.data,!1),C.find("tbody.empty").hide()):($(".loading-wrapper.searching").removeClass("active"),P.closest(".results-messages-wrapper").addClass("active"),x.addClass("active"),e.error?s(e.data):0==C.find("tbody:not(.empty)").children().length?o():i(),clearTimeout(F),T=!0,h&&h.abort())}}).fail(function(t,e,a){if("abort"!=a){var n="An error occurred";""!=a&&(n+=": "+a+"."),s(n)}}).always(function(){S!=m||T||e()}))}function e(){h||(clearTimeout(F),h=$.ajax(phpVars.getAllResultsPath).done(function(t){var e=$.parseJSON(t);!e.error&&e.data?l(e.data,!0):($(".loading-wrapper.searching").removeClass("active"),P.children("div").removeClass("error notice").closest(".results-messages-wrapper").show(),x.addClass("active"),e.error?s(e.data):0==C.find("tbody:not(.empty)").children().length&&o())}).fail(function(t,e,a){if("abort"!=a){var n="An error occurred: "+a+".";s(n)}}).always(function(){T=!0,u&&u.abort()}))}function a(){f=$.ajax(phpVars.fetchCountsPath).done(function(t){var e=$.parseJSON(t),a=e[0],i=e[1];if(O=a,a=n(parseInt(a)),y.find(".count strong + span").text(a),P.find(".amount-hits").text(a),P.find(".is-still-counting").remove(),O>0){var o=Object.keys(i).length;if("undefined"!=typeof i&&o>0){var s=0,r=0;for(var l in i){var d=l.split("_")[2],p=n(parseInt(i[l][0])),c=n(parseInt(i[l][1]));s+=parseInt(i[l][0]),r+=parseInt(i[l][1]),x.find(".distribution-wrapper tbody").append("<tr><td>"+d+"</td><td>"+p+"</td><td>"+c+"</td></tr>")}x.find(".distribution-wrapper tbody").append("<tr><th>Total</th><th>"+n(s)+"</th><th>"+n(r)+"</th></tr>"),x.find(".distribution-wrapper").show()}O>phpVars.resultsLimit&&P.find(".is-restricted").show()}}).fail(function(t,e,a){if("abort"!=a){var n="An error occurred: "+a+".";s(n)}}).always(function(){D=!0})}function n(t){return Number.isInteger(t)&&t>999?t.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):t}function i(){p(),d(),P.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php #results-found",function(){D&&(P.find(".amount-hits").html(n(parseInt(O))),P.find(".is-still-counting").remove()),S==phpVars.resultsLimit?a():(countString=y.find(".count strong").text(),y.find(".count strong + span").text(countString),P.find(".amount-hits").text(countString),P.find(".is-still-counting").remove()),P.children("div").removeClass("error").addClass("notice active").closest(".results-messages-wrapper").show(),x.addClass("active"),V.show()})}function o(){C.add(y).remove(),$("#results .content").addClass("no-results"),P.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php #no-results-found",function(){P.children("div").removeClass("notice").addClass("error active").closest(".results-messages-wrapper").show()})}function s(t){C.add(y).remove(),$("#results .content").addClass("error"),P.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php #error",function(){P.find(".error-msg").text(t),P.children("div").removeClass("notice").addClass("error active").closest(".results-messages-wrapper").show()})}function r(){var t=$("a.tv-show-fs"),e=window.location.hash;if(!$(".loading-wrapper.fullscreen").hasClass("active")&&!$(".tree-visualizer-fs").is(":visible")&&1==e.indexOf("tv-")){var a=e.match(/\d+$/);t.eq(a[0]-1).click()}}function l(e,a){a&&(T=!0,S=0,C.find("tbody:not(.empty)").empty(),$(".loading-wrapper.searching").removeClass("active")),$.each(e,function(t,e){if(a||!a&&!T){S++;var n=e[0];n=n.replace(/\bhref=\"([^"]+)\"/,'href="#tv-'+S+'" data-tv-url="$1"'),C.find("tbody:not(.empty)").append('<tr data-result-id="'+S+'" data-component="'+e[2]+'"><td>'+S+"</td><td>"+n+"</td><td>"+e[2]+"</td><td>"+e[1]+"</td></tr>")}I&&r()}),resultIDString=n(parseInt(S)),y.find(".count strong").text(resultIDString),a||T?i():t()}function d(){z=[],C.find("tbody:not(.empty) tr:visible").each(function(t,e){z.push(parseInt($(e).data("result-id"),10))}),0!=X&&(X=0,$("#go-to").val(z[0]||"--").change())}function p(){$("[for='go-to'], [for='filter-components'], .filter-wrapper label").removeClass("disabled").children("input").prop("disabled",!1),k.find("[type='checkbox'][name='component']").each(function(t,e){var a=$(e),n=a.val();0==C.find("tbody:not(.empty) tr[data-component='"+n+"']").length&&(a.prop("disabled",!0),a.prop("checked",!1),a.parent("label").addClass("disabled"))})}function c(){h&&h.abort(),f&&f.abort(),u&&u.abort(),T=!0}var h,u,f,v=500,m=4,g=window.location.hash,b=$(window),w=$(document),y=($("a.tv-show-fs"),$(".controls")),C=$(".results-ajax-wrapper"),k=$(".filter-wrapper"),x=$("#download-overview .flex-content"),P=x.find(".messages"),V=$(".notification-wrapper"),S=0,O=0,T=!1,D=!1,X=0,I=window.location.hash,z=[];t();var F=setTimeout(function(){e()},v);y.find("[name='go-to']").keyup(function(t){var e=t.keyCode,a=$(this);(8==e||46==e||38==e||40==e)&&(this.setCustomValidity(""),38==e&&a.val()<z[z.length-1]?(X++,a.val(z[X]).change(),y.find("form").submit()):40==e&&a.val()>z[0]&&(X--,a.val(z[X]).change(),y.find("form").submit()))}).change(function(){var t=$(this).val(),e=C.find("tbody:not(.empty) tr[data-result-id='"+t+"']");if(e.is(":visible")){this.setCustomValidity("");var a=e.offset(),n=y.outerHeight();$("html, body").stop().animate({scrollTop:a.top-n},150),X=X.indexOf(t)}else this.setCustomValidity("Please choose a row that is visible. Some rows are hidden depending on the filters you set.")}),y.find("form").submit(function(t){t.preventDefault(),$("#go-to").change()}),y.find("[name='filter-components']").change(function(){$(this).parent().toggleClass("active")}),w.click(function(t){if($(".controls [for='filter-components']").hasClass("active")){var e=$(t.target);e.closest(".filter-wrapper, .controls [for='filter-components']").length||$(".controls [for='filter-components']").removeClass("active")}}),$(".filter-wrapper [type='checkbox']").change(function(){var t=$(this),e=t.val();$("#all-components").prop("indeterminate",!1),t.is("[name='component']")?(t.is(":checked")?C.find("tbody:not(.empty) tr[data-component='"+e+"']").show():C.find("tbody:not(.empty) tr[data-component='"+e+"']").hide(),k.find("[name='component']").is(":checked")?(k.find("[name='component']:not(:disabled)").length==k.find("[name='component']:not(:disabled):checked").length?k.find("#all-components").prop("checked",!0).parent().addClass("active"):k.find("#all-components").prop("checked",!1).prop("indeterminate",!0).parent().removeClass("active"),C.find(".empty").hide(),$("[for='go-to']").removeClass("disabled").children("input").prop("disabled",!1)):(X=!1,C.find(".empty").css("display","table-row-group").find("td").text("No results matching the specified filters"),k.find("#all-components").prop("checked",!1).parent().removeClass("active"),$("[for='go-to']").addClass("disabled").children("input").prop("disabled",!0))):t.is("#all-components")&&(t.parent().toggleClass("active"),k.find("[type='checkbox'][name='component']:not(:disabled)").prop("checked",t.is(":checked")).change()),d()}),window.addEventListener("beforeunload",function(){c()}),b.unload(function(){c()}),$(".secondary-navigation a").click(function(){c()}),C.find("tbody").on("click","a.tv-show-fs",function(t){var e=$(this);C.find("tbody a.tv-show-fs").removeClass("tv-fs-toggled"),e.addClass("tv-fs-toggled"),this.hasAttribute("data-tv-fontsize")||e.attr("data-tv-fontsize",0),$(".loading-wrapper.tv").addClass("active"),$("body").treeVisualizer(e.data("tv-url"),{normalView:!1,initFSOnClick:!0,fsFontSize:12}),t.preventDefault()}),g&&1==g.indexOf("tv-")&&P.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php #looking-for-tree",function(){P.children("div").removeClass("error").addClass("notice active").closest(".results-messages-wrapper").show(),x.addClass("active")}),V.find("button").click(function(){V.hide()}),V.find("a").click(function(t){t.preventDefault(),$("html, body").stop().animate({scrollTop:$("#download-overview").offset().top},150),V.fadeOut("fast")}),$(".btn-wrapper.collapse button").click(function(){var t=$(this),e="hidden"==t.attr("data-collapse")?!0:!1;e?(t.attr("data-collapse","visible"),t.parent().nextAll("[data-target]").slideDown("fast")):(t.attr("data-collapse","hidden"),t.parent().nextAll("[data-target]").slideUp("fast"))}),$("#results-menu a").off("click").click(function(t){$("html, body").stop().animate({scrollTop:$($(this).attr("href")).offset().top},150),t.preventDefault()})});
