$(document).ready(function(){function e(){!V&&C<=phpVars.resultsLimit&&($(".loading-wrapper.searching").addClass("active"),$.ajax(phpVars.fetchResultsPath).done(function(e){if(!V){var a=$.parseJSON(e);$(".results-wrapper tbody:not(.empty) .added").removeClass("added"),!a.error&&a.data?l(a.data,!1):($(".loading-wrapper.searching").removeClass("active"),$(".results-wrapper tbody:not(.empty) .added").removeClass("added"),$(".messages").addClass("active"),a.error?s(a.data):0==$(".results-wrapper tbody:not(.empty)").children().length?i():(n(),clearTimeout(F)),V=!0,$(".stop").click(),p&&p.abort())}}).fail(function(e,a,t){if("abort"!=t){var n="An error occurred: "+t+".";s(n)}}).always(function(){C!=m||V||a()}))}function a(){p=$.ajax(phpVars.getAllResultsPath).done(function(e){var a=$.parseJSON(e);$(".results-wrapper tbody:not(.empty) .added").removeClass("added"),!a.error&&a.data?(l(a.data,!0),n(),$(".stop").click(),clearTimeout(F)):($(".loading-wrapper.searching").removeClass("active"),$(".messages").addClass("active"),a.error?s(a.data):0==$(".results-wrapper tbody:not(.empty)").children().length&&i())}).fail(function(e,a,t){if("abort"!=t){var n="An error occurred: "+t+".";s(n)}}).always(function(){V=!0,$(".stop").click()})}function t(e){return Number.isInteger(e)&&e>999?e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):e}function n(){$(".loading-wrapper.searching").removeClass("active"),$(".controls").find(".stop, .continue").prop("disabled",!0),$(".notice").html("<p></p>"),r();var e=D?[w,""]:["--",'<small class="still-counting">(still counting, can take a while)</small>'];notice="<strong>"+e[0]+"</strong> result(s) have/has been found! "+e[1],C>=phpVars.resultsLimit&&(notice+='<br>We have restricted the output to 500 hits. You can find the reason for this <a href="'+phpVars.fetchHomePath+'/documentation.php#faq-1" title="Why is the output limited to 500 sentences?" target="_blank">in our FAQ</a>.'),notice+='<br><a href="'+phpVars.downloadPath+'"title="Download results" class="download-link" target="_blank" download="gretel-results.txt"><i class="fa fa-arrow-down"></i> Download results</a>',$(".notice p").html(notice).after('<small><a href="'+phpVars.fetchHomePath+'/documentation.php#faq-6" style="float: right;" title="FAQ: what is inside the download file" target="_blank">What is inside this file?</a></small>'),$(".messages").addClass("active"),$(".notice").addClass("active"),$(".notice").one("transitionend",function(){c()})}function i(){$(".controls").remove(),$(".error p").text("No results found!"),$(".messages").addClass("active"),$(".error").addClass("active"),$(".error").one("transitionend",function(){c()})}function s(e){$(".controls").remove(),$(".error p").text("Error! "+e),$(".messages").addClass("active"),$(".error").addClass("active"),$(".error").one("transitionend",function(){c()})}function o(){var e=$("a.tv-show-fs"),a=window.location.hash;if(a&&!$(".loading-wrapper.fullscreen").hasClass("active")&&!$(".tree-visualizer-fs").is(":visible")&&1==a.indexOf("tv-")){var t=a.match(/\d+$/);e.eq(t[0]-1).click()}}function l(a,n){n&&(V=!0,C=0,$(".results-wrapper tbody:not(.empty)").empty(),$(".loading-wrapper.searching").removeClass("active")),$.each(a,function(e,a){if(n||!n&&!V){C++;var t=a[0];t=t.replace(/\bhref=\"([^"]+)\"/,'href="#tv-'+C+'" data-tv-url="$1"'),$(".results-wrapper tbody:not(.empty)").append('<tr data-result-id="'+C+'" data-component="'+a[2]+'"><td>'+C+"</td><td>"+t+"</td><td>"+a[2]+"</td><td>"+a[1]+"</td></tr>")}o()}),$(".results-wrapper").fadeIn("fast"),resultIDString=t(C),$(".count strong").text(resultIDString),x||n||e()}function r(){$("[for='go-to'], [for='filter-components'], .filter-wrapper label").removeClass("disabled").children("input").prop("disabled",!1),y.find("[type='checkbox'][name='component']").each(function(){var e=$(this),a=e.val();0==g.find("tbody:not(.empty) tr[data-component='"+a+"']").length&&(e.prop("disabled",!0),e.prop("checked",!1),e.parent("label").addClass("disabled"))})}function c(){b.hasClass("scroll")?S=k.offset().top:(S=b.offset().top,z=b.outerHeight(),k.height(z))}function d(){f.scrollTop()>=S?(k.show(),b.addClass("scroll")):(k.hide(),b.removeClass("scroll"))}var p,h=500,v=700,m=4,u=window.location.hash,f=$(window),b=($("a.tv-show-fs"),$(".controls")),g=$(".results-wrapper"),y=$(".filter-wrapper"),b=$(".controls"),k=$(".dummy-controls"),C=0,w=0,x=!1,V=!1,D=!1;e();var F=setTimeout(function(){a()},v);setTimeout(function(){$.get(phpVars.fetchCountsPath,function(e){e&&(e=parseInt(e),$(".notice .still-counting").remove(),w=t(e),$(".count strong + span").text(w),$(".notice strong").text(w),D=!0)})},h),$(".stop").click(function(){x||(x=!0,$(".loading-wrapper.searching").removeClass("active"),$(this).prop("disabled",!0),$(".continue").prop("disabled",V))}),$(".continue").click(function(){x&&!V&&(x=!1,$(".stop").prop("disabled",!1),$(this).prop("disabled",!0),e())}),$(".controls [name='go-to']").keyup(function(e){var a=e.keyCode,t=$(this);(8==a||46==a||38==a||40==a)&&(this.setCustomValidity(""),38==a&&t.val()<C&&t.val(parseInt(t.val(),10)+1).change(),40==a&&t.val()>1&&t.val(parseInt(t.val(),10)-1).change())}).change(function(){var e=$(this).val(),a=$(".results-wrapper tbody:not(.empty) tr[data-result-id='"+e+"']");if(a.is(":visible")){this.setCustomValidity("");var t=a.offset(),n=$(".controls").outerHeight();$("html, body").stop().animate({scrollTop:t.top-n})}else this.setCustomValidity("Please choose a row that is visible. Some rows are hidden depending on the filters you set.")}),$(".controls form").submit(function(e){e.preventDefault()}),$(".controls [name='filter-components']").change(function(){$(this).parent().toggleClass("active")}),$(document).click(function(e){if($(".controls [for='filter-components']").hasClass("active")){var a=$(e.target);a.closest(".filter-wrapper, .controls [for='filter-components']").length||$(".controls [for='filter-components']").removeClass("active")}}),$(".filter-wrapper [type='checkbox']").change(function(){var e=$(this),a=e.val();$("#all-components").prop("indeterminate",!1),e.is("[name='component']")?(e.is(":checked")?g.find("tbody:not(.empty) tr[data-component='"+a+"']").show():g.find("tbody:not(.empty) tr[data-component='"+a+"']").hide(),y.find("[name='component']").is(":checked")?(y.find("[name='component']:not(:disabled)").length==y.find("[name='component']:not(:disabled):checked").length?y.find("#all-components").prop("checked",!0).parent().addClass("active"):y.find("#all-components").prop("checked",!1).prop("indeterminate",!0).parent().removeClass("active"),g.find(".empty").hide(),$("[for='go-to']").removeClass("disabled").children("input").prop("disabled",!1)):(g.find(".empty").css("display","table-row-group"),y.find("#all-components").prop("checked",!1).parent().removeClass("active"),$("[for='go-to']").addClass("disabled").children("input").prop("disabled",!0))):e.is("#all-components")&&(e.parent().toggleClass("active"),y.find("[type='checkbox'][name='component']:not(:disabled)").prop("checked",e.is(":checked")).change()),$("#go-to").val(g.find("tbody:not(.empty) tr:visible").first().attr("data-result-id")||"--")});var S=b[0].getBoundingClientRect().top+b.scrollTop(),z=b[0].getBoundingClientRect().height;k.height(z),f.resize($.throttle(250,c)),f.scroll($.throttle(250,d)),g.find("tbody").on("click","a.tv-show-fs",function(e){var a=$(this);$(".loading-wrapper.tv").addClass("active"),$("body").treeVisualizer(a.data("tv-url"),{normalView:!1,initFSOnClick:!0,fsFontSize:12}),e.preventDefault()}),u&&1==u.indexOf("tv-")&&($(".messages").addClass("active"),$(".notice").html("<p>It seems that you want to open a tree in a new window. The tree first needs to be found again, but as soon as it is found it will pop up.</p>").addClass("active"))});
