$(document).ready(function(){function t(){!v&&h<=phpVars.resultsLimit&&($(".loading-wrapper.searching").addClass("active"),$.ajax(phpVars.fetchResultsPath).done(function(t){if(!v){var e=$.parseJSON(t);$(".results-wrapper tbody:not(.empty) .added").removeClass("added"),e.data?n(e.data,!1):($(".loading-wrapper.searching").removeClass("active"),$(".results-wrapper tbody:not(.empty) .added").removeClass("added"),$(".messages").addClass("active"),e.error?s(e.error_msg):0==$(".results-wrapper tbody:not(.empty)").children().length?a():(r(),clearTimeout(y)),v=!0,$(".stop").click(),i&&i.abort())}}).fail(function(t,e,o){if("abort"!=o){var r="An error occurred: "+o+".";s(r)}}).always(function(){h!=d||v||e()}))}function e(){i=$.ajax(phpVars.getAllResultsPath).done(function(t){var e=$.parseJSON(t);$(".results-wrapper tbody:not(.empty) .added").removeClass("added"),e.data?(n(e.data,!0),r(),$(".stop").click(),clearTimeout(y)):($(".loading-wrapper.searching").removeClass("active"),$(".messages").addClass("active"),e.error?s(e.error_msg):0==$(".results-wrapper tbody:not(.empty)").children().length&&a())}).fail(function(t,e,o){if("abort"!=o){var r="An error occurred: "+o+".";s(r)}}).always(function(){v=!0,$(".stop").click()})}function o(t){return Number.isInteger(t)&&t>999?t.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):t}function r(){$(".loading-wrapper.searching").removeClass("active"),$(".controls").find(".stop, .continue").prop("disabled",!0),disableAndEnableInputs();var t=g?[m,""]:["--","<small>(still counting)</small>"];notice="<strong>"+t[0]+"</strong> result(s) have/has been found! "+t[1],h>=phpVars.resultsLimit&&(notice+='<br>We have restricted the output to 500 hits. You can find the reason for this <a href="'+phpVars.fetchHomePath+'/documentation.php#faq-1" title="Why is the output limited to 500 sentences?" target="_blank">in our FAQ</a>.'),$(".notice p").html(notice),$(".messages").addClass("active"),$(".notice").addClass("active"),$(".notice").one("transitionend",function(){setDummyVariables()})}function a(){$(".controls").remove(),$(".error p").text("No results found!"),$(".messages").addClass("active"),$(".error").addClass("active"),$(".error").one("transitionend",function(){setDummyVariables()})}function s(t){$(".controls").remove(),$(".error p").text("Error! "+t),$(".messages").addClass("active"),$(".error").addClass("active"),$(".error").one("transitionend",function(){setDummyVariables()})}function n(e,r){r&&(v=!0,h=0,$(".results-wrapper tbody:not(.empty)").empty(),$(".loading-wrapper.searching").removeClass("active")),$.each(e,function(t,e){if(r||!r&&!v){h++;var o=e[0];o=o.replace(/\bhref=\"([^"]+)\"/,'href="#tv-'+h+'" data-tv-url="$1"');var a=o.match(/(?:&tb=)([^&"=]+)/)[1],s=o.match(/(?:>)([^<>]+)(?:<\/a>)/)[1],n="",i="";"lassy"==a?(n=s.match(/([^<>]+?)(?:-\d+(?:-|\.).*)/)[1],n=n.replace(/^((?:[a-zA-Z]{3,4})|(?:WR(?:-[a-zA-Z]){3}))-.*/,"$1"),i=n.replace(/-/g,""),i=i.slice(0,4)):"cgn"==a&&(n=s.match(/([^<>\d]+)/)[1],n=n.slice(1),i=n.replace(/-/g,"")),n=n.toUpperCase(),i=i.toUpperCase(),$(".results-wrapper tbody:not(.empty)").append('<tr data-result-id="'+h+'" data-component="'+i+'"><td>'+h+"</td><td>"+o+"</td><td>"+n+"</td><td>"+e[1]+"</td></tr>")}}),$(".results-wrapper").fadeIn("fast"),resultIDString=o(h),$(".count strong").text(resultIDString),f||r||t()}var i,l=5e3,c=7e3,d=10,p=window.location.hash,u=$("a.tv-show-fs"),h=0,m=0,f=!1,v=!1,g=!1;if(t(),p&&1==p.indexOf("tv-")){var w=p.match(/\d+$/);u.eq(w[0]-1).click()}var y=setTimeout(function(){e()},c);setTimeout(function(){$.get(phpVars.fetchCountsPath,function(t){t&&(t=parseInt(t),$(".notice small").remove(),m=o(t),$(".count strong + span").text(m),$(".notice strong").text(m),g=!0)})},l),$(".stop").click(function(){f||(f=!0,$(".loading-wrapper.searching").removeClass("active"),$(this).prop("disabled",!0),$(".continue").prop("disabled",v))}),$(".continue").click(function(){f&&!v&&(f=!1,$(".stop").prop("disabled",!1),$(this).prop("disabled",!0),t())}),$(".controls [name='to-top']").click(function(){$("html, body").animate({scrollTop:0})}),$(".controls [name='go-to']").keyup(function(t){var e=t.keyCode;(8==e||46==e)&&this.setCustomValidity("")}).change(function(){var t=$(this).val(),e=$(".results-wrapper tbody:not(.empty) tr[data-result-id='"+t+"']");if(e.is(":visible")){this.setCustomValidity("");var o=e.offset(),r=$(".controls").outerHeight();$("html, body").stop().animate({scrollTop:o.top-r})}else this.setCustomValidity("Please choose a row that is visible. Some rows are hidden depending on the filters you set.")}),$(".controls form").submit(function(t){t.preventDefault()}),$(".controls [name='filter-components']").change(function(){$(this).parent().toggleClass("active")}),$(document).click(function(t){if($(".controls [for='filter-components']").hasClass("active")){var e=$(t.target);e.closest(".filter-wrapper, .controls [for='filter-components']").length||$(".controls [for='filter-components']").removeClass("active")}}),$(".results-wrapper tbody:not(.empty)").on("click","a.tv-show-fs",function(t){var e=$(this);$(".loading-wrapper.tv").addClass("active"),window.history.replaceState("",document.title,window.location.pathname+e.attr("href")),body.treeVisualizer(e.data("tv-url"),{normalView:!1,initFSOnClick:!0,fsFontSize:12}),t.preventDefault()})});
