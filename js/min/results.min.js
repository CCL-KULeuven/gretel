$(document).ready(function(){function t(){!k&&y<=phpVars.resultsLimit&&($(".loading-wrapper.searching").addClass("active"),$.ajax(phpVars.fetchResultsPath).done(function(t){if(!k){var e=$.parseJSON(t);g.find("tbody:not(.empty) .added").removeClass("added"),!e.error&&e.data?i(e.data,!1):($(".loading-wrapper.searching").removeClass("active"),g.find("tbody:not(.empty) .added").removeClass("added"),$(".messages").addClass("active"),e.error?r(e.data):0==g.find("tbody:not(.empty)").children().length?n():(o(),clearTimeout(V)),k=!0,p&&p.abort())}}).fail(function(t,e,a){if("abort"!=a){var o="An error occurred";""!=a&&(o+=": "+a+"."),r(o)}}).always(function(){y!=h||k||e()}))}function e(){p=$.ajax(phpVars.getAllResultsPath).done(function(t){var e=$.parseJSON(t);g.find("tbody:not(.empty) .added").removeClass("added"),!e.error&&e.data?(i(e.data,!0),o(),clearTimeout(V)):($(".loading-wrapper.searching").removeClass("active"),$(".messages").addClass("active"),e.error?r(e.data):0==g.find("tbody:not(.empty)").children().length&&n())}).fail(function(t,e,a){if("abort"!=a){var o="An error occurred: "+a+".";r(o)}}).always(function(){k=!0})}function a(t){return Number.isInteger(t)&&t>999?t.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):t}function o(){$(".loading-wrapper.searching").removeClass("active"),$(".notice").html("<p></p>"),l();var t=x?[C,""]:["--",'<small class="still-counting">(still counting, can take a while)</small>'];notice="<strong>"+t[0]+"</strong> result(s) have/has been found! "+t[1],y>=phpVars.resultsLimit&&(notice+='<br>We have restricted the output to 500 hits. You can find the reason for this <a href="'+phpVars.fetchHomePath+'/documentation.php#faq-1" title="Why is the output limited to 500 sentences?" target="_blank">in our FAQ</a>.'),notice+='<br><a href="'+phpVars.downloadPath+'"title="Download results" class="download-link" target="_blank" download="gretel-results.txt"><i class="fa fa-arrow-down"></i> Save results</a>',$(".notice p").html(notice).after('<small><a href="'+phpVars.fetchHomePath+'/documentation.php#faq-6" style="float: right;" title="FAQ: what is inside the download file" target="_blank">What is inside this file?</a></small>'),$(".messages").addClass("active"),$(".notice").addClass("active"),$(".notice").one("transitionend",function(){d()}),$("html, body").stop().animate({scrollTop:$("#results-section").offset().top},250,function(){m.scroll()})}function n(){g.children("p").add(".controls").remove(),$(".error p").text("No results found!"),$(".messages").addClass("active"),$(".error").addClass("active")}function r(t){g.children("p").add(".controls").remove(),$(".error p").text("Error! "+t),$(".messages").addClass("active"),$(".error").addClass("active")}function s(){var t=$("a.tv-show-fs"),e=window.location.hash;if(e&&!$(".loading-wrapper.fullscreen").hasClass("active")&&!$(".tree-visualizer-fs").is(":visible")&&1==e.indexOf("tv-")){var a=e.match(/\d+$/);t.eq(a[0]-1).click()}}function i(e,o){o&&(k=!0,y=0,g.find("tbody:not(.empty)").empty(),$(".loading-wrapper.searching").removeClass("active")),$.each(e,function(t,e){if(o||!o&&!k){y++;var a=e[0];a=a.replace(/\bhref=\"([^"]+)\"/,'href="#tv-'+y+'" data-tv-url="$1"'),g.find("tbody:not(.empty)").append('<tr data-result-id="'+y+'" data-component="'+e[2]+'"><td>'+y+"</td><td>"+a+"</td><td>"+e[2]+"</td><td>"+e[1]+"</td></tr>")}s()}),g.find(".table-wrapper").fadeIn("fast"),resultIDString=a(y),$(".count strong").text(resultIDString),o||t()}function l(){$("[for='go-to'], [for='filter-components'], .filter-wrapper label").removeClass("disabled").children("input").prop("disabled",!1),b.find("[type='checkbox'][name='component']").each(function(){var t=$(this),e=t.val();0==g.find("tbody:not(.empty) tr[data-component='"+e+"']").length&&(t.prop("disabled",!0),t.prop("checked",!1),t.parent("label").addClass("disabled"))})}function d(){v.hasClass("scroll")?S=w.offset().top:(S=v.offset().top,I=v.outerHeight(),w.height(I))}function c(){m.scrollTop()>=S?(w.show(),v.addClass("scroll")):(w.hide(),v.removeClass("scroll"))}var p,f=500,h=4,u=window.location.hash,m=$(window),v=($("a.tv-show-fs"),$(".controls")),g=$(".results-wrapper"),b=$(".filter-wrapper"),v=$(".controls"),w=$(".dummy-controls"),y=0,C=0,k=!1,x=!1;t();var V=setTimeout(function(){e()},f);$.ajax(phpVars.fetchCountsPath).done(function(t){var e=$.parseJSON(t),o=e[0],n=e[1];if($(".notice .still-counting").remove(),o=a(parseInt(o)),$(".count strong + span, .notice strong").text(o),C=o,o>0){var r=Object.keys(n).length;if("undefined"!=typeof n&&r>0){for(var s in n){var i=s.split("_")[2],l=a(parseInt(n[s][0])),d=a(parseInt(n[s][1]));$(".distribution-wrapper tbody").append("<tr><td>"+i+"</td><td>"+l+"</td><td>"+d+"</td></tr>")}$(".distribution-wrapper").show()}}}).fail(function(){if("abort"!=error){var t="An error occurred: "+error+".";r(t)}}).always(function(){x=!0}),$(".controls [name='go-to']").keyup(function(t){var e=t.keyCode,a=$(this);(8==e||46==e||38==e||40==e)&&(this.setCustomValidity(""),38==e&&a.val()<y&&a.val(parseInt(a.val(),10)+1).change(),40==e&&a.val()>1&&a.val(parseInt(a.val(),10)-1).change())}).change(function(){var t=$(this).val(),e=g.find("tbody:not(.empty) tr[data-result-id='"+t+"']");if(e.is(":visible")){this.setCustomValidity("");var a=e.offset(),o=$(".controls").outerHeight();$("html, body").stop().animate({scrollTop:a.top-o},150)}else this.setCustomValidity("Please choose a row that is visible. Some rows are hidden depending on the filters you set.")}),$(".controls form").submit(function(t){t.preventDefault()}),$(".controls [name='filter-components']").change(function(){$(this).parent().toggleClass("active")}),$(document).click(function(t){if($(".controls [for='filter-components']").hasClass("active")){var e=$(t.target);e.closest(".filter-wrapper, .controls [for='filter-components']").length||$(".controls [for='filter-components']").removeClass("active")}}),$(".filter-wrapper [type='checkbox']").change(function(){var t=$(this),e=t.val();$("#all-components").prop("indeterminate",!1),t.is("[name='component']")?(t.is(":checked")?g.find("tbody:not(.empty) tr[data-component='"+e+"']").show():g.find("tbody:not(.empty) tr[data-component='"+e+"']").hide(),b.find("[name='component']").is(":checked")?(b.find("[name='component']:not(:disabled)").length==b.find("[name='component']:not(:disabled):checked").length?b.find("#all-components").prop("checked",!0).parent().addClass("active"):b.find("#all-components").prop("checked",!1).prop("indeterminate",!0).parent().removeClass("active"),g.find(".empty").hide(),$("[for='go-to']").removeClass("disabled").children("input").prop("disabled",!1)):(g.find(".empty").css("display","table-row-group"),b.find("#all-components").prop("checked",!1).parent().removeClass("active"),$("[for='go-to']").addClass("disabled").children("input").prop("disabled",!0))):t.is("#all-components")&&(t.parent().toggleClass("active"),b.find("[type='checkbox'][name='component']:not(:disabled)").prop("checked",t.is(":checked")).change()),$("#go-to").val(g.find("tbody:not(.empty) tr:visible").first().attr("data-result-id")||"--")});var S=v[0].getBoundingClientRect().top+v.scrollTop(),I=v[0].getBoundingClientRect().height;w.height(I),m.resize($.throttle(250,d)),m.scroll($.throttle(250,c)),window.addEventListener("beforeunload",function(){p&&p.abort()}),g.find("tbody").on("click","a.tv-show-fs",function(t){var e=$(this);$(".loading-wrapper.tv").addClass("active"),$("body").treeVisualizer(e.data("tv-url"),{normalView:!1,initFSOnClick:!0,fsFontSize:12}),t.preventDefault()}),u&&1==u.indexOf("tv-")&&($(".messages").addClass("active"),$(".notice").html("<p>It seems that you want to open a tree in a new window. The tree first needs to be found again, but as soon as it is found it will pop up.</p>").addClass("active"))});
