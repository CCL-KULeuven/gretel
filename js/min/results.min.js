$(document).ready(function(){function t(){!H&&T<=phpVars.resultsLimit&&($(".loading-wrapper.searching").addClass("active"),m=$.ajax(phpVars.fetchResultsPath).done(function(t){if(!H){var e=$.parseJSON(t);x.find("tbody:not(.empty) .added").removeClass("added"),!e.error&&e.data?d(e.data,!1):($(".loading-wrapper.searching").removeClass("active"),x.find("tbody:not(.empty) .added").removeClass("added"),z.children("div").removeClass("error notice").closest(".results-messages-wrapper").addClass("active"),V.addClass("active"),e.error?s(e.data):0==x.find("tbody:not(.empty)").children().length?i():a(),clearTimeout(N),H=!0,u&&u.abort())}}).fail(function(t,e,n){if("abort"!=n){var o="An error occurred";""!=n&&(o+=": "+n+"."),s(o)}}).always(function(){T!=w||H||e()}))}function e(){u||(clearTimeout(N),u=$.ajax(phpVars.getAllResultsPath).done(function(t){var e=$.parseJSON(t);x.find("tbody:not(.empty) .added").removeClass("added"),!e.error&&e.data?d(e.data,!0):($(".loading-wrapper.searching").removeClass("active"),z.children("div").removeClass("error notice").closest(".results-messages-wrapper").show(),V.addClass("active"),e.error?s(e.data):0==x.find("tbody:not(.empty)").children().length&&i())}).fail(function(t,e,n){if("abort"!=n){var o="An error occurred: "+n+".";s(o)}}).always(function(){H=!0,m&&m.abort()}))}function n(){v=$.ajax(phpVars.fetchCountsPath).done(function(t){var e=$.parseJSON(t),n=e[0],a=e[1];if(P=n,n=o(parseInt(n)),k.find(".count strong + span").text(n),z.find(".amount-hits").text(n),z.find(".is-still-counting").remove(),P>0){var i=Object.keys(a).length;if("undefined"!=typeof a&&i>0){for(var s in a){var r=s.split("_")[2],d=o(parseInt(a[s][0])),l=o(parseInt(a[s][1]));V.find(".distribution-wrapper tbody").append("<tr><td>"+r+"</td><td>"+d+"</td><td>"+l+"</td></tr>")}V.find(".distribution-wrapper").show()}P>phpVars.resultsLimit&&z.find(".is-restricted").show()}}).fail(function(t,e,n){if("abort"!=n){var o="An error occurred: "+n+".";s(o)}}).always(function(){F=!0})}function o(t){return Number.isInteger(t)&&t>999?t.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):t}function a(){c(),l(),z.load(phpVars.fetchHomePath+"/php/results-messages.php #results-found",function(){F&&(z.find(".amount-hits").html(o(parseInt(P))),z.find(".is-still-counting").remove()),T==phpVars.resultsLimit?n():(countString=k.find(".count strong").text(),k.find(".count strong + span").text(countString),z.find(".amount-hits").text(countString),z.find(".is-still-counting").remove()),z.children("div").removeClass("error").addClass("notice active").closest(".results-messages-wrapper").show(),V.addClass("active"),I.show()})}function i(){x.add(k).add(O).remove(),$("#results .content").addClass("no-results"),z.load(phpVars.fetchHomePath+"/php/results-messages.php #no-results-found",function(){z.children("div").removeClass("notice").addClass("error active").closest(".results-messages-wrapper").show()})}function s(t){x.add(k).add(O).remove(),$("#results .content").addClass("error"),z.load(phpVars.fetchHomePath+"/php/results-messages.php #error",function(){z.find(".error-msg").text(t),z.children("div").removeClass("notice").addClass("error active").closest(".results-messages-wrapper").show()})}function r(){var t=$("a.tv-show-fs"),e=window.location.hash;if(!$(".loading-wrapper.fullscreen").hasClass("active")&&!$(".tree-visualizer-fs").is(":visible")&&1==e.indexOf("tv-")){var n=e.match(/\d+$/);t.eq(n[0]-1).click()}}function d(e,n){n&&(H=!0,T=0,x.find("tbody:not(.empty)").empty(),$(".loading-wrapper.searching").removeClass("active")),$.each(e,function(t,e){if(n||!n&&!H){T++;var o=e[0];o=o.replace(/\bhref=\"([^"]+)\"/,'href="#tv-'+T+'" data-tv-url="$1"'),x.find("tbody:not(.empty)").append('<tr data-result-id="'+T+'" data-component="'+e[2]+'"><td>'+T+"</td><td>"+o+"</td><td>"+e[2]+"</td><td>"+e[1]+"</td></tr>")}R&&r()}),resultIDString=o(parseInt(T)),k.find(".count strong").text(resultIDString),n||H?a():t()}function l(){L=[],x.find("tbody:not(.empty) tr:visible").each(function(t,e){L.push(parseInt($(e).data("result-id"),10))}),0!=D&&(D=0,$("#go-to").val(L[0]||"--").change())}function c(){$("[for='go-to'], [for='filter-components'], .filter-wrapper label").removeClass("disabled").children("input").prop("disabled",!1),S.find("[type='checkbox'][name='component']").each(function(t,e){var n=$(e),o=n.val();0==x.find("tbody:not(.empty) tr[data-component='"+o+"']").length&&(n.prop("disabled",!0),n.prop("checked",!1),n.parent("label").addClass("disabled"))})}function p(){u&&u.abort(),v&&v.abort(),m&&m.abort(),H=!0}function f(){k.hasClass("scroll")?j=O.offset().top:(j=k.offset().top,E=k.outerHeight(),O.height(E))}function h(){y.scrollTop()>=j?(O.show(),k.addClass("scroll")):(O.hide(),k.removeClass("scroll"))}var u,m,v,g=500,w=4,b=window.location.hash,y=$(window),C=$(document),k=($("a.tv-show-fs"),$(".controls")),x=$(".results-ajax-wrapper"),S=$(".filter-wrapper"),V=$(".results-download-wrapper"),z=V.find(".messages"),I=$(".notification-wrapper"),O=$(".dummy-controls"),T=0,P=0,H=!1,F=!1,D=0,R=window.location.hash,L=[];t();var N=setTimeout(function(){e()},g);k.find("[name='go-to']").keyup(function(t){var e=t.keyCode,n=$(this);(8==e||46==e||38==e||40==e)&&(this.setCustomValidity(""),38==e&&n.val()<L[L.length-1]?(D++,n.val(L[D]).change(),k.find("form").submit()):40==e&&n.val()>L[0]&&(D--,n.val(L[D]).change(),k.find("form").submit()))}).change(function(){var t=$(this).val(),e=x.find("tbody:not(.empty) tr[data-result-id='"+t+"']");if(e.is(":visible")){this.setCustomValidity("");var n=e.offset(),o=k.outerHeight();$("html, body").stop().animate({scrollTop:n.top-o},150),D=D.indexOf(t)}else this.setCustomValidity("Please choose a row that is visible. Some rows are hidden depending on the filters you set.")}),k.find("form").submit(function(t){t.preventDefault(),$("#go-to").change()}),k.find("[name='filter-components']").change(function(){$(this).parent().toggleClass("active")}),C.click(function(t){if($(".controls [for='filter-components']").hasClass("active")){var e=$(t.target);e.closest(".filter-wrapper, .controls [for='filter-components']").length||$(".controls [for='filter-components']").removeClass("active")}}),$(".filter-wrapper [type='checkbox']").change(function(){var t=$(this),e=t.val();$("#all-components").prop("indeterminate",!1),t.is("[name='component']")?(t.is(":checked")?x.find("tbody:not(.empty) tr[data-component='"+e+"']").show():x.find("tbody:not(.empty) tr[data-component='"+e+"']").hide(),S.find("[name='component']").is(":checked")?(S.find("[name='component']:not(:disabled)").length==S.find("[name='component']:not(:disabled):checked").length?S.find("#all-components").prop("checked",!0).parent().addClass("active"):S.find("#all-components").prop("checked",!1).prop("indeterminate",!0).parent().removeClass("active"),x.find(".empty").hide(),$("[for='go-to']").removeClass("disabled").children("input").prop("disabled",!1)):(D=!1,x.find(".empty").css("display","table-row-group"),S.find("#all-components").prop("checked",!1).parent().removeClass("active"),$("[for='go-to']").addClass("disabled").children("input").prop("disabled",!0))):t.is("#all-components")&&(t.parent().toggleClass("active"),S.find("[type='checkbox'][name='component']:not(:disabled)").prop("checked",t.is(":checked")).change()),l()});var j=k[0].getBoundingClientRect().top+k.scrollTop(),E=k[0].getBoundingClientRect().height;O.height(E),function(){var t,e=$("#results .results-download-wrapper")[0],n=new MutationObserver(function(e){e.forEach(function(){clearTimeout(t),t=setTimeout(function(){f()},500)})}),o={attributes:!0,childList:!0,characterData:!0,subtree:!0};n.observe(e,o)}(),y.resize($.throttle(250,f)),y.scroll($.throttle(250,h)),window.addEventListener("beforeunload",function(){p()}),y.unload(function(){p()}),$(".secondary-navigation a").click(function(){p()}),x.find("tbody").on("click","a.tv-show-fs",function(t){var e=$(this);x.find("tbody a.tv-show-fs").removeClass("tv-fs-toggled"),e.addClass("tv-fs-toggled"),this.hasAttribute("data-tv-fontsize")||e.attr("data-tv-fontsize",0),$(".loading-wrapper.tv").addClass("active"),$("body").treeVisualizer(e.data("tv-url"),{normalView:!1,initFSOnClick:!0,fsFontSize:12}),t.preventDefault()}),b&&1==b.indexOf("tv-")&&z.load(phpVars.fetchHomePath+"/php/results-messages.php #looking-for-tree",function(){z.children("div").removeClass("error").addClass("notice active").closest(".results-messages-wrapper").show(),V.addClass("active")}),I.find("button").click(function(){I.hide()}),I.find("a").click(function(t){t.preventDefault(),$("html, body").stop().animate({scrollTop:$("#results").offset().top},150),I.fadeOut("fast")})});
