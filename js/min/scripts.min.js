$(function(){function t(){p.width()<721?(c.addClass("small"),c.find("button").addClass("active")):(c.removeClass("active small"),c.find("button").removeClass("active"))}function e(){$(".help-tooltip[data-title]").each(function(t,e){var a=$(e),n=e.getBoundingClientRect(),o=p.width(),i=p.height();a.addClass("hang-right hang-left hang-bottom hang-top"),(o-n.right<=320||n.top<=160||i-n.bottom<=160)&&a.removeClass("hang-right"),(n.left<=320||n.top<=160||i-n.bottom<=160)&&a.removeClass("hang-left"),(i-n.bottom<=320||o-n.right<=160||n.left<=160)&&a.removeClass("hang-bottom"),(n.top<=320||o-n.right<=160||n.left<=160)&&a.removeClass("hang-top")})}function a(){var t="edit-warning";if(0==$("."+t).length){var e="<p>Editing the XPath will disable all options including the selection table and the tree representation. Furthermore, you will <strong>not</strong> be able to select SoNaR as the corpus of interest.</p><p><strong>Only edit this code if you know what you are doing!</strong></p>";e+="<small>You can re-enable all options and reset XPath to the last unmodified structure by pressing the button <em>Reset XPath</em></small>",s(e,!0,t)}var a=$("."+t),n=a.data("popup-id");Cookies.get("popup-continue-"+n)?($(".input-wrapper, .xpath-wrapper > div:first-child, #tree-output, .guidelines").addClass("advanced-mode-active").find(":not(.disabled) > input, :not(.disabled) > button").prop("disabled",!0),$('[name="manualMode"]').val("true"),$(".xpath-wrapper textarea").off("mousedown")):(r(a,$("#xpath")),a.find("button.continue").click(function(){$(".input-wrapper, .xpath-wrapper > div:first-child, #tree-output, .guidelines").addClass("advanced-mode-active").find(":not(.disabled) > input, :not(.disabled) > button").prop("disabled",!0),$('[name="manualMode"]').val("true"),$(".xpath-wrapper textarea").off("mousedown")}))}function n(t,e){$.ajax({type:"POST",url:"http://bramvanroy.be/projects/xpath-beautifier/php/receive-post.php",crossDomain:!0,data:t,headers:{"cache-control":"no-cache"},xhrFields:{withCredentials:!0}}).done(function(){}).fail(function(){}).always(function(){var t=window.open(e,"_blank");t?t.focus():alert("Your browser blocked opening a new window. Please allow pop-ups for this website. We will never show advertisements.")})}function o(){m&&m.abort(),m=$.ajax({url:getTreePathScript,method:"POST",data:$("main form").serialize()}).done(function(t){var e=$.parseJSON(t);e.location&&$("#tree-output").treeVisualizer(e.location,{extendedPOS:!0}),e.xpath&&($("#xpath, .xpath-wrapper input[name='originalXp']").val(e.xpath),i($("#xpath")))}).fail(function(t,e,a){}).always(function(){})}function i(t){t.height(0).outerHeight(t[0].scrollHeight+2)}function s(t,e,a){for(var n=1;;){if(!$("[data-popup-id='"+n+"'").length){var o=document.createElement("aside");$(o).html(t).attr({"data-popup-id":n,"class":"popup"}).hide().appendTo("#popup-wrapper"),$(o).append('<div class="btn-wrapper"><button title="Continue editing XPath" type="button" class="continue">Continue</button></div>'),e&&$(o).children(".btn-wrapper").prepend('<button title="Close this pop-up" type="button" class="cancel">Cancel</button>'),a&&$(o).addClass(a);break}n++}if(0==$("#popup-overlay").length){var i=document.createElement("div");$(i).attr("id","popup-overlay").hide().appendTo("#popup-wrapper")}}function r(t,e){t.css({visibility:"hidden",display:"block"});var a=p.width(),n=p.height(),o=e[0].getBoundingClientRect(),i=e.offset(),s=a-o.right,r=n-o.bottom,d=t[0].getBoundingClientRect(),l=(o.width-d.width)/2,c=(o.height-d.height)/2,f=16;t.removeClass("hang-right hang-left hang-bottom hang-top"),o.top>d.height+f&&s>d.width/2&&o.left>d.width/2?(t.addClass("hang-top"),t.css({left:i.left+l,top:i.top-d.height-f})):o.left>d.width+f&&o.top>d.height/2&&r>d.height/2?(t.addClass("hang-left"),t.css({left:i.left-d.width-f,top:i.top+c})):s>d.width+f&&o.top>d.height/2&&r>d.height/2?(t.addClass("hang-right"),t.css({left:i.left+o.width+f,top:i.top+c})):(t.addClass("hang-bottom"),t.css({left:i.left+l,top:i.top+o.height+f})),t.css("visibility","visible"),$("#popup-overlay").show()}function d(t){t.fadeOut("fast"),$("#popup-overlay").hide()}var l=$("body"),c=$(".primary-navigation"),p=$(window),f=$(document);if($("#old-ie-script").remove(),p.resize($.throttle(500,function(){t(),e()})).resize(),p.scroll($.throttle(500,e)).scroll(),$("[name='to-top']").click(function(){$("html, body").animate({scrollTop:0})}),c.find("button").click(function(){c.toggleClass("active")}),f.click(function(t){c.hasClass("active")&&($(t.target).closest(c.find("button"),c.find("ul")).length||c.removeClass("active"))}),l.hasClass("step-1")){var h=$("[name='clear']");if(h.click(function(t){var e=$(this);e.prev("[name='input'], textarea").val("").addClass("no-content").focus(),e.prop("disabled",!0),t.preventDefault()}),$("[name='input'], textarea").keyup(function(){var t=$(this);t.val()?(t.removeClass("no-content"),h.prop("disabled",!1)):(t.addClass("no-content"),h.prop("disabled",!0))}).keyup(),taalPortaalFiller(),l.hasClass("xps")){var u=$("[name='xpath']");$("[type='submit']").click(function(){var t=(u.val().match(/\[/g)||"").length,e=(u.val().match(/\]/g)||"").length;t==e?u[0].setCustomValidity(""):(t>e&&u[0].setCustomValidity("Fix XPath inconsistency: missing ] or unnecessary [ (x"+(t-e)+")"),e>t&&u[0].setCustomValidity("Fix XPath inconsistency: missing [ or unnecessary ] (x"+(e-t)+")"))}),u.keyup(function(){this.setCustomValidity("")})}}else if(l.hasClass("matrix")){var u=$("[name='xpath']");$("[type='submit']").click(function(){var t=(u.val().match(/\[/g)||"").length,e=(u.val().match(/\]/g)||"").length;t==e?u[0].setCustomValidity(""):(t>e&&u[0].setCustomValidity("Fix XPath inconsistency: missing ] or unnecessary [ (x"+(t-e)+")"),e>t&&u[0].setCustomValidity("Fix XPath inconsistency: missing [ or unnecessary ] (x"+(e-t)+")"))}),u.keyup(function(){this.setCustomValidity("")});var m;o(),$("main form input[type='radio'], main form input[type='checkbox']:not([name='ct'])").change(function(){o()}),$("form").submit(o()),$("tbody td").click(function(){$(this).find("input").click()}).find("input").click(function(t){t.stopPropagation()}),$(".table-wrapper .case-sensitive input[type='checkbox']").each(function(t,e){var a=$(e);a.is(":checked")&&a.prop("disabled",!1).parent("td:not(.punctuation)").removeClass("disabled")}),$(".table-wrapper input[type='radio']").click(function(){var t=$(this),e=t.parent("td:not(.punctuation)"),a=$(".table-wrapper .case-sensitive td:nth-child("+(e.index()+1)+")");e.length&&("token"==t.val()?a.removeClass("disabled").children("input[type='checkbox']").prop("disabled",!1):a.addClass("disabled").children("input[type='checkbox']").prop("checked",!1).prop("disabled",!0))});var v=$(".advanced-btn-wrapper button"),g=$(".table-wrapper tr.advanced-option");v.click(function(){$(".advanced-option:not(tr)").toggle(),g.toggleClass("visible-row");var t;g.hasClass("visible-row")?(t="Hide advanced options",i($("#xpath")),e()):t="Show advanced options",v.attr("title",t).children("span").text(t)}),$(".xpath-wrapper a").click(function(t){t.preventDefault();var e=$(this).attr("href");n($("#xpath").serialize(),e)}),$(".xpath-wrapper input[type='reset']").click(function(t){t.preventDefault(),$("#xpath").val($(".xpath-wrapper input[name='originalXp']").val()).change(),$(".input-wrapper, .xpath-wrapper > div:first-child, #tree-output, .guidelines").removeClass("advanced-mode-active").find(":not(.disabled) > input, :not(.disabled) > button").prop("disabled",!1),$('[name="manualMode"]').val("false"),$(".xpath-wrapper textarea").on("mousedown",a)}),$(".xpath-wrapper textarea").on("mousedown",a)}else(l.hasClass("ebs")&&l.hasClass("step-4")||l.hasClass("xps")&&l.hasClass("step-2"))&&($("[type='radio']").change(function(){var t=$(this),e=t.val();t.is("[name='treebank']")&&($(".cgn, .lassy, .sonar").hide(),$(".cgn, .lassy, .sonar").find("[type='checkbox'], [type='radio']").prop("disabled",!0),$("."+e).show().find("label:not(.disabled)").find("[type='checkbox'], [type='radio']").prop("disabled",!1))}),$("[type='checkbox']").change(function(){var t=$(this);if(t.is("[data-check^='all']")){var e=t.prop("checked");t.is("[data-check='all-cgn-vl']")?$(".cgn label:not(.disabled) [type='checkbox'][value^='v']").prop("checked",e):t.is("[data-check='all-cgn-nl']")?$(".cgn label:not(.disabled) [type='checkbox'][value^='n']").prop("checked",e):$(".lassy label:not(.disabled) [type='checkbox']").prop("checked",e)}else if(t.is("[name='subtreebank[]']")){var a,n=t.attr("data-treebank"),o=t.closest(".table-wrapper"),i=t.val(),s=i.substring(0,1);a="n"==s?o.find("[data-check='all-cgn-nl']"):"v"==s?o.find("[data-check='all-cgn-vl']"):o.find("[data-check='all-lassy']");var r=o.find("[name='subtreebank[]']"),d="cgn"==n?"[value^='"+s+"']":"";r.filter(d+":not(:disabled)").length==r.filter(d+":not(:disabled):checked").length?(a.prop("indeterminate",!1),a.prop("checked",!0)):0==r.filter(d+":checked").length?(a.prop("indeterminate",!1),a.prop("checked",!1)):a.prop("indeterminate",!0)}}),0==$("[type='radio'][name='treebank']:checked").length?$("[type='radio'][name='treebank'][value='lassy']").click().change():$("[type='radio'][name='treebank']:checked").click().change());$("#popup-wrapper").on("click","button.cancel, button.continue",function(){var t=$(this),e=t.closest(".popup"),a=e.data("popup-id");t.hasClass("continue")&&Cookies.set("popup-continue-"+a,"true"),d(e)})});
